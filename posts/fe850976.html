<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/css/index.css" rel="stylesheet"><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SaToken鉴权框架-基础 | Violet博客屋</title><meta name="keywords" content="SaToken"><meta name="author" content="violet"><meta name="copyright" content="violet"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SaToken鉴权框架-基础"><meta name="application-name" content="SaToken鉴权框架-基础"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SaToken鉴权框架-基础"><meta property="og:url" content="http://example.com/posts/fe850976.html"><meta property="og:site_name" content="Violet博客屋"><meta property="og:description" content="SaToken鉴权框架-基础"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b"><meta property="article:author" content="violet"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b"><meta name="description" content="SaToken鉴权框架-基础"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/posts/fe850976"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":1500,"languages":{"author":"作者: violet","link":"链接: ","source":"来源: Violet博客屋","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Violet博客屋',
  title: 'SaToken鉴权框架-基础',
  postAI: '',
  pageFillDescription: 'Sa-Token 介绍, Sa-Token 功能预览, 在 SpringBoot 中集成, 1、创建项目, 2、添加依赖, 3、设置配置文件, 4、创建启动类, 5、创建测试 Controller, 6、运行, 登录认证, 1、设计思路, 2、登录与注销, 3、会话查询, 4、Token 查询, 5、来个小测试加深一下理解, 权限认证, 1、设计思路, 2、获取当前账号权限码集合, 3、权限校验, 4、角色校验, 5、拦截全局异常, 6、权限通配符, 7、如何把权限精确到按钮级？, 8、示例代码, 踢人下线, 1、强制注销, 2、踢人下线, 注解鉴权, 注解鉴权, 1、注册拦截器, 2、使用注解鉴权, 3、设定校验模式, 4、角色权限双重校验 or 校验, 5、忽略认证, 6、批量注解鉴权, 7、扩展阅读, 路由拦截鉴权, 1、注册 Sa-Token 路由拦截器, 2、校验函数详解, 3、匹配特征详解, 4、提前退出匹配链, 5、使用 free 打开一个独立的作用域, 6、使用注解忽略掉路由拦截校验, 7、关闭注解校验, Session 会话, 1、Session 会话是什么？, 2、Account-Session, 3、Token-Session, 4、Custom-Session, 5、在 Session 上存取值, 6、其他操作, 7、避免与 HttpSession 混淆使用, 8、未登录场景下获取 Token-Session, 框架配置, 1、配置方式, 2、核心包所有可配置项, 3、单点登录相关配置, 4、OAuth2.0相关配置, 5、部分配置项详解介绍是一个轻量级权限认证框架主要解决登录认证权限认证单点登录分布式会话微服务网关鉴权等一系列权限相关问题旨在以简单优雅的方式完成系统的权限认证部分以登录认证为例你只需要会话登录参数填登录人的账号无需实现任何接口无需创建任何配置文件只需要这一句静态代码的调用便可以完成会话登录认证如果一个接口需要登陆后才能访问我们只需要调用以下代码校验当前客户端是否已经登录如果未登录则抛出异常在中大多数功能都可以一行代码解决踢人下线将账号为的会话踢下线权限认证注解鉴权只有具备权限的会话才可以进入方法用户增加路由拦截鉴权根据路由划分模块不同模块不同鉴权更多模块当你受够了等框架的三拜九叩之后你就会明白相对于这些传统老牌框架的设计是多么的简单优雅功能预览目前主要五大功能模块登录认证权限认证单点登录微服务鉴权登录认证单端登录多端登录同端互斥登录七天免登录权限认证权限认证角色认证会话二级认证踢人下线根据账号踢人下线根据值踢人下线注解式鉴权优雅的将鉴权与业务代码分离路由拦截式鉴权根据项目路由拦截鉴权可适配模式会话全端共享单端独享自定义方便的存取值持久层扩展可集成重启数据不丢失前后台分离小程序等不支持的终端也可以轻松鉴权风格定制内置流中风格还可自定义生成策略记住我模式适配记住我模式重启浏览器免验证二级认证在已登录的基础上再次认证保证安全性模拟他人账号实时操作任意用户状态数据临时身份切换将会话身份临时切换为其他账号同端互斥登录像一样手机电脑同时在线但是两个手机上互斥登录账号封禁登录封禁按照业务分类封禁按照处罚阶梯封禁密码加密提供基础加密算法可快速加密会话查询提供方便灵活的会话查询接口认证一行代码接入认证全局侦听器在用户登录注销被踢下线等关键性操作时进行一些操作全局过滤器方便的处理跨域全局设置安全响应头等操作多账号体系认证一个系统多套账号分开鉴权比如商城的表和表单点登录内置三种单点登录模式同城跨域同跨前后端分离等架构都可以搞定单点注销任意子系统内发起注销即可全端下线认证轻松搭建服务支持模式分布式会话提供共享数据中心分布式会话方案微服务网关鉴权适配等常见网关的路由拦截认证调用鉴权网关转发鉴权调用鉴权让服务调用不再裸奔临时认证解决短时间的授权问题独立将权限缓存与业务缓存分离快速登录认证为项目零代码注入一个登录页面标签方言提供标签方言集成包提供集成示例集成提供三种模式的集成方案提供扩展参数能力调用状态传递提供等集成包在调用时登陆状态不丢失参数签名提供跨系统调用签名校验模块防止参数篡改防止请求重放自动续签提供两种过期策略灵活搭配使用还可以自动续签开箱即用提供等常见框架集成包开箱即用最新技术栈适配最新技术栈支持功能结构图在中集成创建项目在中新建一个项目例如添加依赖在项目中添加依赖方式注如果你使用的是只需要将修改为即可权限认证在线文档设置配置文件你可以零配置启动项目但同时你也可以在中增加如下配置定制性使用框架端口配置文档名称同时也是名称有效期单位秒默认天代表永久有效最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结是否允许同一账号多地同时登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个风格默认可取值是否输出操作日志创建启动类在项目中新建包在此包内新建主类复制以下代码启动成功配置如下创建测试测试登录浏览器访问此处仅作模拟示例真实项目需要从数据库中查询数据进行比对登录成功登录失败查询登录状态浏览器访问当前会话是否登录运行启动代码依次运行上述接口登录认证设计思路对于一些登录之后才能访问的接口例如查询我的账号资料我们通常的做法是增加一层接口校验如果校验通过则正常返回数据如果校验未通过则抛出异常告知其需要先进性登录那么判断会话是否登录的依据是什么我们先来简单分析一下登录访问流程用户提交参数调用登录接口登录成功返回这个用户的会话凭证用户后续的每次请求都携带上这个服务器根据判断此会话是否登录成功所谓登录认证指的就是服务器校验账号密码为用户颁发会话凭证的过程这个也是我们后续判断会话是否登录的关键所在加载动态演示图登录与注销根据以上思路我们需要一个会话登录的函数会话登录参数填写要登录的账号建议的数据类型不可以传入复杂类型如等等只此一句代码便可以使会话登录成功实际上在背后做了大量的工作包括但不限于检查此账号是否之前已有登录为账号生成凭证与会话记录活跃时间通知全局侦听器账号登录成功将注入到请求上下问你暂时不需要完整了解整个登录过程你只需要记住关键一点为这个账号创建了一个凭证且通过上下文返回给了前端所以一般情况下我们的登录接口代码会大致类似如下会话登录接口第一步比对前端提交的账号名称密码第二步根据账号进行登录登录成功登录失败如果你对以上代码阅读没有压力你可能会注意到略显奇怪的一点此处仅仅做了会话登录但并没有主动向前端返回信息是因为不需要吗严格来讲是需要的只不过方法利用了自动注入的特性省略了你手写返回的代码是什么如果你对功能还不太了解也不用担心我们会在之后的前后端分离章节中详细的阐述功能现在你只需要了解最基本的两点可以从后端控制往浏览器中写入值会在前端每次发起请求时自动提交值因此在功能的加持下我们可以仅靠一句代码就完成登录认证除了登录方法我们还需要当前会话注销登录获取当前会话是否已经登录返回已登录未登录检验当前会话是否已经登录如果未登录则抛出异常异常代表当前会话暂未登录可能的原因有很多前端没有提交前端提交的是无效的前端提交的已经过期等等可参照未登录场景值了解如何获取未登录的场景值会话查询获取当前会话账号如果未登录则抛出异常类似查询还有获取当前会话账号并转化为类型获取当前会话账号并转化为类型获取当前会话账号并转化为类型指定未登录情形下返回的默认值获取当前会话账号如果未登录则返回获取当前会话账号如果未登录则返回默认值可以为任意类型查询获取当前会话的值获取当前的名称获取指定对应的账号如果未登录则返回获取当前会话剩余有效期单位返回代表永久有效获取当前会话的信息参数有关参数详解请参考参数详解来个小测试加深一下理解登录测试测试登录此处仅作模拟示例真实项目需要从数据库中查询数据进行比对登录成功登录失败查询登录状态是否登录查询信息测试注销本章代码示例登录认证权限认证设计思路所谓权限认证核心逻辑就是判断一个账号是否拥有指定权限有就让你通过没有那么禁止访问深入到底层数据中就是每个账号都会拥有一组权限码集合框架来校验这个集合中是否包含指定的权限码例如当前账号哦拥有权限码集合这时候我来校验权限则其结果就是验证失败禁止访问加载动态演示图所以现在问题的核心就是两个如何获取一个账号所拥有的权限码集合本次操作需要验证的权限码是哪个获取当前账号权限码集合因为每个项目的需求不同其权限设计也千变万化因此获取当前账号权限码集合这一操作不可能内置到框架中所以将此操作以接口的方式暴露给你以方便你根据自己的业务逻辑进行重写你需要做的是新建一个类实现接口例如以下代码自定义权限加载接口实现类保证此类被扫描完成的自定义权限验证扩展返回一个账号所拥有的权限码集合本仅做模拟实际项目中要根据具体业务逻辑来查询权限返回一个账号所拥有的角色标识集合权限与角色可分开校验本仅做模拟实际项目中要根据具体业务逻辑来查询角色参数解释账号即你在调用时写入的标识值账号体系标识此处可以暂时忽略在多账户认证章节下会对这个概念做详细的解释有同学会产生疑问我实现了此接口但是程序启动时好像并没有执行是不是我写错了答不执行是正常现象程序启动时不会执行这个接口的方法在每次调用鉴权代码时才会执行到此权限校验然后就可以用以下来鉴权了获取当前账号所拥有的权限集合判断当前账号是否含有指定权限返回或校验当前账号是否含有指定权限如果验证未通过则抛出异常校验当前账号是否含有指定权限指定多个必须全部验证通过校验当前账号是否含有指定权限指定多个只要其一验证通过即可扩展对象可通过方法获取具体是哪个抛出的异常角色校验在中角色和权限可以分开独立验证获取当前账号所拥有的角色集合判断当前账号是否拥有指定角色返回或校验当前账号是否含有指定角色标识如果验证未通过则抛出异常校验当前账号是否含有指定角色标识指定多个必须全部验证通过校验当前账号是否含有指定角色标识指定多个只要其一验证通过即可扩展对象可通过方法获取具体是哪个抛出的异常拦截全局异常有同学要问鉴权失败抛出异常然后呢要把异常显示给用户看吗当然不可以你可以创建一个全局异常拦截器统一返回给前端的格式参考全局异常拦截可参考码云权限通配符允许你根据通配符指定泛权限例如当一个账号拥有的权限时都将匹配通过当拥有权限时当拥有权限时当拥有权限时上帝权限当一个账号拥有权限时他可以验证通过任何权限码角色认证同理如何把权限精确到按钮级权限精确到按钮级的意思就是指权限范围可以控制到页面上的每一个按钮是否显示思路如此精确的范围控制只依赖后端已经难以完成此时需要前端进行一定的逻辑判断如果是前后端一体项目可以参考标签方言如果是前后端分离项目则在登录时把当前账号拥有的所有权限码一次性返回给前端前端将权限码集合保存在或其他全局状态管理对象中在需要权限控制的按钮上使用进行逻辑判断例如在框架中我们可以使用如下写法是当前用户拥有的权限码数组是显示按钮需要拥有的权限码删除按钮是用户拥有权限码才可以看到的内容删除按钮以上写法只为提供一个参考示例不同框架有不同写法大家可根据项目技术栈灵活封装进行调用前端有了鉴权后端还需要鉴权吗需要前端的鉴权只是一个辅助功能对于专业人员这些限制都是可以轻松绕过的为保证服务器安全无论前端是否进行了权限校验后端接口都需要对会话请求再次进行权限校验示例代码权限认证示例前提首先调用登录接口进行登录代码在中有详细解释此处不再赘述前提项目实现接口代码在将从此实现类获取每个账号拥有哪些权限然后我们就可以使用以下示例中的代码进行鉴权了查询权限查询权限信息如果当前会话未登录会返回一个空集合当前登录账号拥有的所有权限查询角色信息如果当前会话未登录会返回一个空集合当前登录账号拥有的所有角色返回给前端权限校验判断当前账号是否拥有一个权限返回或如果当前账号未登录则永远返回指定多个必须全部拥有才会返回指定多个只要拥有一个就会返回校验当前账号是否拥有一个权限校验不通过时会抛出异常如果当前账号未登录则永远校验失败指定多个必须全部拥有才会校验通过指定多个只要拥有一个就会校验通过角色校验判断当前账号是否拥有一个角色返回或如果当前账号未登录则永远返回指定多个必须全部拥有才会返回指定多个只要拥有一个就会返回校验当前账号是否拥有一个角色校验不通过时会抛出异常如果当前账号未登录则永远校验失败指定多个必须全部拥有才会校验通过指定多个只要拥有一个就会校验通过权限通配符前提条件在实现类中为账号返回了泛权限返回返回返回因为前缀不符合符合可以出现在任意位置比如权限码的开头当账号拥有时也可以出现在权限码的中间比如当账号拥有时因为后缀不符合注意点上帝权限当一个账号拥有权限时他可以验证通过任何权限码角色校验也可以加指定泛角色例如暂不赘述本章代码示例权限认证踢人下线所谓踢人下线核心操作就是找到指定对应的并设置其失效强制注销强制指定账号注销下线强制指定账号指定端注销下线强制指定注销下线踢人下线将指定账号踢下线将指定账号指定端踢下线将指定踢下线强制注销和踢人下线的区别在于强制注销等价于对方主动调用了注销方法再次访问会提示无效踢人下线不会清除信息而是将其打上特定标记再次访问会提示已被踢下线加载动态演示图本章代码示例踢人下线注解鉴权注解鉴权有同学表示尽管使用代码鉴权非常方便但是我们仍希望把鉴权逻辑和业务逻辑分离出来我们可以使用注解鉴权吗当然可以注解鉴权优雅的将鉴权与业务代码分离登录校验只有登录之后才能够进入该方法角色校验必须具有指定角色标识才能进入该方法权限校验必须具有指定权限才能进入该方法二级认证校验必须二级认证之后才能进入该方法校验只有通过认证后才能进入该方法校验只有通过认证后才能进入该方法忽略校验表示被修饰的方法或类无需进行注解鉴权和路由拦截器鉴权账号服务封禁校验校验当前账号指定服务是否被封禁使用全局拦截器完成注解鉴权功能为了不为项目带来不必要的性能负担拦截器默认处于关闭状态因此为了使用注解鉴权你必须手动将的全局拦截器注册到你项目中注册拦截器以为例新建配置类注册拦截器打开注解式鉴权功能注册拦截器打开注解式鉴权功能保证此类被启动类扫描到即可使用注解鉴权然后我们就可以愉快的使用注解鉴权了登录校验只有登录之后才能进入该方法查询用户信息角色校验必须具有指定角色才能进入该方法用户增加权限校验必须具有指定权限才能进入该方法用户增加二级认证校验必须二级认证之后才能进入该方法用户增加校验只有通过认证后才能进入该方法用户增加校验只有通过认证后才能进入该方法用户增加校验当前账号是否被封禁服务如果已被封禁会抛出异常无法进入方法查询用户信息注以上注解都可以加在类上代表为这个类所有方法进行鉴权设定校验模式与注解可设置校验模式例如注解式鉴权只要具有其中一个权限即可通过校验用户信息有两种取值标注一组权限会话必须全部具有才可通过校验标注一组权限会话只要具有其一即可通过校验角色权限双重校验校验假设有以下业务场景一个接口在具有权限或角色时可以调通怎么写角色权限双重校验具备指定权限或者指定角色即可通过校验用户信息字段代表权限校验未通过时的次要选择两者只要一校验成功即可进入请求方法其有三种写法写法一代表需要拥有角色写法二代表具有三个角色其一即可写法三代表必须同时具有三个角色忽略认证使用可表示一个接口忽略认证其它方法此接口加上了可以游客访问如上代码表示中的所有方法都需要登录后才可以访问但是接口可以匿名游客访问修饰方法时代表这个方法可以被游客访问修饰类时代表这个类中的所有接口都可以游客访问具有最高优先级当和其它鉴权注解一起出现时其它鉴权注解都将被忽略同样可以忽略掉拦截器中的路由鉴权在下面的路由拦截鉴权章节中我们会讲到批量注解鉴权使用表示批量注解鉴权在中可以指定多个注解只要当前会话满足其中一个注解即可通过验证进入方法每一项属性都可以写成数组形式例如当前客户端只要有账号登录或者账号登录其一就可以通过验证进入方法注意和是多账号模式章节的扩展属性此处你可以先略过这个知识点疑问既然有了为什么没有与之对应的呢因为当你写多个注解时其天然就是校验关系例如当你在一个方法上写多个注解鉴权时其默认就是要满足所有注解规则后才可以进入方法只要有一个不满足就会抛出异常扩展阅读在业务逻辑层使用鉴权注解注解鉴权制作自定义鉴权注解注入到框架自定义注解本章代码示例注解鉴权路由拦截鉴权假设我们有如下需求需求场景项目中的所有接口均需要登录认证只有登录接口本身对外开放我们怎么实现呢给每个接口加上鉴权注解手写全局拦截器似乎都不是非常方便在这个需求中我们真正需要的是一种基于路由拦截的鉴权模式那么在怎么实现路由拦截鉴权呢注册路由拦截器以为例新建配置类注册拦截器注册拦截器校验规则为登录校验以上代码我们注册了一个基于的登录校验拦截器并且排除了接口用来开放登录除了以外的所有接口都需要登录才能访问版本升级是新版本提供的拦截器点此查看旧版本代码迁移示例校验函数详解自定义认证规则是最简单的写法代表只进行登录校验功能我们可以往构造函数塞一个完整的表达式来定义详细的校验规则例如注册拦截器定义详细认证规则指定一条规则拦截的列表可以写多个排除掉的列表可以写多个要执行的校验动作可以写完整的表达式根据路由划分模块不同模块不同鉴权匹配函数有两个参数参数一要匹配的路由参数二要执行的校验参数在校验函数内不只可以使用进行权限校验你还可以写任意代码例如注册的拦截器注册路由拦截器自定义认证规则登录校验拦截所有路由并排除用于开放登录角色校验拦截以开头的路由必须具备角色或者角色才可以通过认证权限校验不同模块校验不同权限甚至你可以随意的写一个打印语句啦啦啦连缀写法啦啦啦匹配特征详解除了上述示例的路由匹配还可以根据很多其它特征进行匹配以下是所有可匹配的特征基础写法样例匹配一个执行一个校验函数根据路由匹配支持写多个支持写风格路由功能说明使用或者开头的任意路由都将进入方法要执行的校验函数根据路由排除匹配功能说明使用或者结尾的任意路由都将跳过不会进入方法要执行的校验函数根据请求类型匹配要执行的校验函数根据一个条件进行匹配要执行的校验函数根据一个返回结果的表达式匹配要执行的校验函数多个条件一起使用功能说明必须是请求并且请求路径以开头要执行的校验函数可以无限连缀下去功能说明同时满足方式请求且路由以开头路由中间带有字符串路由结尾不能是和只有上述所有条件都匹配成功才会执行最后的校验函数提前退出匹配链使用可以提前退出匹配链例进入进入进入进入进入如上示例代码运行至第条匹配链时会在函数处提前退出整个匹配函数从而忽略掉剩余的所有匹配除了函数还提供了函数用于停止匹配结束执行直接向前端返回结果执行函数后将停止匹配也不会进入而是直接将参数作为返回值输出到前端要返回到前端的内容与函数的区别在于会停止匹配进入会停止匹配直接返回结果到前端使用打开一个独立的作用域进入独立作用域执行函数跳出后继续执行下面的匹配的作用是打开一个独立的作用域使内部的不再一次性跳出整个函数而是仅仅跳出当前作用域使用注解忽略掉路由拦截校验我们可以使用注解忽略掉路由拦截认证先配置好拦截规则根据路由划分模块不同模块不同鉴权然后在里又添加忽略校验的注解访问进来方法请求将会跳过拦截器的校验直接进入方法中注意点注解的忽略效果只针对拦截器和注解鉴权生效对自定义拦截器与过滤器不生效关闭注解校验只要注册到项目中默认就会打开注解校验如果要关闭此能力需要指定关闭掉注解鉴权能力这样框架就只会做路由拦截校验了本章代码示例路由拦截鉴权会话会话是什么是会话中专业的数据缓存组件通过我们可以很方便的缓存一些高频读写数据提高程序性能例如在登录时缓存对象然后我们就可以在任意处使用这个对象在中分为三种分别是指的是框架为每个账号分配的指的是框架为每个分配的指的是以一个特定的值作为来分配的有关与的详细区别可参考模型详解有关账号的如下获取当前账号的必须是登录后才能调用获取当前账号的并决定在尚未创建时是否新建并返回获取账号为的获取账号为的并决定在尚未创建时是否新建并返回获取为的在尚未创建时返回有关令牌的如下获取当前的对象获取指定的对象自定义指的是一个特定的值作为来分配的借助自定义你可以为系统中的任意元素分配相应的例如以商品作为为每个商品分配一个以便于缓存和商品相关的数据其相关如下查询指定的是否存在获取指定的如果没有则新建并返回获取指定的如果没有第二个参数决定是否新建并返回删除指定的在上存取值以上三种均为框架设计概念上的区分实际上在获取它们时返回的都是对象你可以使用在对象上存取值写值写值只有在此原本无值的时候才会写入取值取值指定默认值取值若无值则执行参数方法之后将结果保存到此键名下并返回此结果若有值则直接返回无需执行参数方法数据类型转换取值转类型取值转类型取值转类型取值转类型取值转类型取值指定转换类型取值指定转换类型并指定值为时返回的默认值是否含有某个返回或删值清空所有值获取此的所有返回其他操作返回此的返回此的创建时间时间戳返回此会话上的底层数据对象如果更新里的值请调用方法避免产生脏数据将这个从持久库更新一下注销此会话从持久库删除此避免与混淆使用经常有同学会把与进行混淆例如在上写入一个值在进行取值输出要点与没有任何关系在上写入的值在中无法取出并未被框架接管在使用时请在任何情况下均使用不要使用未登录场景下获取默认场景下只有登录后才能通过获取如果想要在未登录场景下获取有两种方法方法一将全局配置项改为详见框架配置方法二使用匿名获取当前的匿名可在未登录情况下使用的注意点如果前端没有提交或者提交的是一个无效的话框架将不会根据此创建对象而是随机一个新的值来创建对象此值可以通过获取到本章代码示例会话框架配置你可以零配置启动框架但同时你也可以通过一定的参数配置定制性使用框架支持多种方式配置框架信息配置方式方式在或配置风格配置文档名称同时也是名称有效期单位秒默认天代表永久有效最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结是否允许同一账号多地同时登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个风格默认可取值是否输出操作日志风格配置文档名称同时也是名称有效期单位秒默认天代表永久有效最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结是否允许同一账号多地同时登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个风格默认可取值是否输出操作日志方式通过代码配置模式配置类参数配置参考文档此配置会覆盖中的配置名称同时也是名称有效期单位秒默认天代表永不过期最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结是否允许同一账号多地同时登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个风格是否输出操作日志模式配置类参数配置参考文档此配置会与中的配置合并代码配置优先名称同时也是名称有效期单位秒默认天代表永不过期最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结是否允许同一账号多地同时登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个风格是否输出操作日志两者的区别在于模式会覆盖中的配置模式会与中的配置合并代码配置优先核心包所有可配置项你不必立刻掌握整个表格只需要在用到某个功能时再详细查阅它即可参数名称类型默认值说明名称同时也是名称数据持久化前缀有效期单位秒默认天代表永不过期参考有效期详解最低活跃频率单位秒如果超过此时间没有访问系统就会被冻结默认代表不限制永不冻结例如可以设置为代表分钟内无操作就冻结参考有效期详解是否启用动态功能如不需要请设置为节省缓存请求次数是否允许同一账号并发登录为时允许一起登录为时新登录挤掉旧登录在多人登录同一账号时是否共用一个为时所有登录共用一个为时每次登录新建一个时提供了数据后即使配置了为也不能复用旧必须创建新同一账号最大登录数量代表不限只有在时此配置才有效详解在每次创建时的最高循环次数用于保证唯一性不循环重试直接使用是否尝试从请求体里读取是否尝试从里读取是否尝试从里读取此值为后登录时也不会再往前端注入是否在登录后将写入到响应头风格参考自定义风格默认数据持久组件实现类中每次清理过期数据间隔的时间单位秒默认值秒设置为代表不启动定时清理获取时是否必须登录如果配置为会在每次获取时校验是否登录详解是否打开自动续签如果此值为框架会在每次直接或间接调用时进行一次过期检查与续签操作参考有效期详解前缀例如填写实际传参参考自定义前缀是否在初始化配置时打印版本字符画是否打印操作日志日志等级此值与联动日志等级值此值与联动是否打印彩色日志打印彩色日志打印黑白日志框架根据运行终端自行判断是否打印彩色日志秘钥只有集成模块时此参数才会生效参考和集成的有效期单位秒参考内部服务外网隔离认证的账号和密码参考认证配置当前项目的网络访问地址是否校验部分插件有效配置对象签名配置对象相关配置参数名称类型默认值说明作用域写入时显式指定的作用域常用于单点登录二级域名共享的场景路径默认写在域名根路径下是否只在协议下有效是否禁止操作第三方限制级别完全禁止部分允许不限制配置示例风格配置相关配置风格相关配置参数签名相关配置参数名称类型默认值说明调用签名秘钥接口调用时的时间戳允许的差距单位代表不校验差距默认分钟示例风格配置参数签名配置接口调用签名秘钥风格接口调用签名秘钥单点登录相关配置端配置参数名称类型默认值说明指定当前系统集成时使用的模式约定型配置项不对代码逻辑产生任何影响有效期单位秒所有允许的授权回调地址多个用逗号隔开不在此列表中的将禁止下放参考整合配置域名校验主页路由在登录后不指定参数的情况下默认跳转的路由是否打开单点注销功能是否打开模式三此值为时将使用请求校验值单点注销获取参考详解是否在每次下发时自动续期的有效期根据全局值在上记录信息的最高数量无限超过此值将进行自动清退处理先进先出是否校验参数签名方便本地调试用的一个配置项生产环境请务必为配置示例风格配置单点登录服务端配置有效期单位秒默认五分钟所有允许的授权回调地址风格有效期单位秒默认五分钟所有允许的授权回调地址端配置参数名称类型默认值说明指定当前系统集成时使用的模式约定型配置项不对代码逻辑产生任何影响当前名称标识用于和码的互相锁定配置端主机总地址拼接在属性前面用以简化各种配置参考详解配置端单点登录授权地址配置端的校验地址配置端的拉取数据地址配置端单点注销地址配置当前端的登录地址为空时自动获取配置当前端的单点注销回调为空时自动获取是否打开单点注销功能是否打开模式三此值为时将使用请求校验值单点注销拉取数据参考详解是否校验参数签名方便本地调试用的一个配置项生产环境请务必为配置示例风格配置相关配置端主机地址是否打开单点注销功能风格端主机地址是否打开单点注销功能相关配置参数名称类型默认值说明是否打开模式授权码是否打开模式隐藏式是否打开模式密码式是否打开模式凭证式是否在每次刷新时产生一个新的授权码保存的时间单位秒默认五分钟保存的时间单位秒默认两个小时保存的时间单位秒默认天保存的时间单位秒默认两个小时保存的时间单位秒默认为代表延续的有效时间默认生成算法中使用的摘要前缀指定高级权限多个用逗号隔开指定低级权限多个用逗号隔开模式是否返回字段用于兼容标准协议是否在返回值中隐藏默认的状态字段相关配置风格配置配置风格配置配置相关配置参数名称类型默认值说明值如不配置则自动计算有效期单位秒默认十分钟风格配置风格属性定义参数名称类型默认值说明应用应该全局唯一应用秘钥应用签约的所有权限应用允许授权的所有可以使用号通配符应用允许的所有取全局配置单独配置此是否在每次刷新时产生一个新的默认取全局配置取全局配置单独配置此保存的时间单位秒默认取全局配置取全局配置单独配置此保存的时间单位秒默认取全局配置取全局配置单独配置此保存的时间单位秒默认取全局配置取全局配置单独配置此保存的时间单位秒默认取全局配置部分配置项详解对部分配置项做一下详解配置项详解配置含义同一账号最大登录数量在配置时将允许同一账号并发登录且每次登录都会产生一个新这些都会以的形式记录在其之上这就造成一个问题随着同一账号登录的次数越来越多的列表也会越来越大极端情况下列表长度可能达到成百上千以上严重拖慢数据处理速度为此对这个列表的大小设定一个上限值也就是默认值假设一个账号的登录数量超过后将会主动注销第一个登录的会话先进先出以此保证队列中的有效会话数量始终值配置项详解配置含义获取时是否必须登录如果配置为会在每次获取时校验是否登录在调用登录后调用可以获取这个会话的对象调用可以获取这个会话对象关于两种有何区别可以参考这篇模型详解此处暂不赘述从设计上讲无论会话是否已经登录只要前端提供了我们就可以找到这个的专属对象这非常灵活但不安全因为前端提交的可能是任意伪造的为了解决这个问题方法在获取时会率先检测一下这个是否是一个有效如果是有效正常返回对象如果是无效则抛出异常这样就保证了伪造的是无法获取对象的但是有的场景下我们又确实需要在登录之前就使用对象这时候就把配置项值改为即可配置项详解配置含义是否打开单点登录模式三此配置项为时代表使用模式二使用校验值删除数据做到单点注销使用同步数据此配置项为时代表使用模式三使用请求校验值使用请求做到单点注销使用请求同步数据本章代码示例框架配置',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-08 16:03:50',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/xxx.css?1"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/basic/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://violet.zeabur.app/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/" title="Github"><img class="back-menu-item-icon" src="https://pic4.zhimg.com/v2-341e1d3b2845db15bceeff70d3fe228b_r.jpg" alt="Github"><span class="back-menu-item-text">Github</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Violet博客屋</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博文</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/shuoshuo/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 分享</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/photos/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1994908354&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 影视</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> 游戏厅</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文档</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 随机文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/document/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 文档页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itbaima/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 柏码</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/runoob/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 菜鸟教程</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itheima/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 黑马程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/SpringCloudAlibaba/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 阿里微服务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友人帐</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站导航</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/front/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 前端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/back-end/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 后端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/programmer/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/ai/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于笔者</span></a></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">19</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" itemprop="url">开发框架</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/SaToken/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>SaToken</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SaToken鉴权框架-基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-09-27T08:32:20.000Z" title="发表于 2024-09-27 16:32:20">2024-09-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-10-08T08:03:50.774Z" title="更新于 2024-10-08 16:03:50">2024-10-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">15.5k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>58分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SaToken鉴权框架-基础"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="http://example.com/posts/fe850976.html"><header><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/" itemprop="url">开发框架</a><a href="/tags/SaToken/" tabindex="-1" itemprop="url">SaToken</a><h1 id="CrawlerTitle" itemprop="name headline">SaToken鉴权框架-基础</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">violet</span><time itemprop="dateCreated datePublished" datetime="2024-09-27T08:32:20.000Z" title="发表于 2024-09-27 16:32:20">2024-09-27</time><time itemprop="dateCreated datePublished" datetime="2024-10-08T08:03:50.774Z" title="更新于 2024-10-08 16:03:50">2024-10-08</time></header><p><img src="/img/load.gif" data-original="https://sa-token.cc/logo.png" alt="logo"></p>
<h1 id="Sa-Token-介绍"><a href="#Sa-Token-介绍" class="headerlink" title="Sa-Token 介绍"></a>Sa-Token 介绍</h1><p>Sa-Token 是一个轻量级 Java 权限认证框架，主要解决：<strong>登录认证</strong>、<strong>权限认证</strong>、<strong>单点登录</strong>、<strong>OAuth2.0</strong>、<strong>分布式 Session 会话</strong>、<strong>微服务网关鉴权</strong>等一系列权限相关问题。</p>
<p>Sa-Token 旨在以简单、优雅的方式完成系统的权限认证部分，以登录认证为例，你只需要：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 会话登录，参数填登录人的账号id </span></span><br><span class="line">StpUtil.login(<span class="number">10001</span>);</span><br></pre></td></tr></tbody></table></figure>



<p>无需实现任何接口，无需创建任何配置文件，只需要这一句静态代码的调用，便可以完成会话登录认证。</p>
<p>如果一个接口需要登陆后才能访问，我们只需要调用以下代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 校验当前客户端是否已经登录，如果未登录则抛出 `NotLoginException` 异常</span></span><br><span class="line">StpUtil.checkLogin();</span><br></pre></td></tr></tbody></table></figure>

<p>在 Sa-Token 中，大多数功能都可以一行代码解决：</p>
<p>踢人下线：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 将账号id为 10077 的会话踢下线 </span></span><br><span class="line">StpUtil.kickout(<span class="number">10077</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>权限认证：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 注解鉴权：只有具备 `user:add` 权限的会话才可以进入方法</span></span><br><span class="line"><span class="meta">@SaCheckPermission("user:add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">insert</span><span class="params">(SysUser user)</span> {</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>路由拦截鉴权：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 根据路由划分模块，不同模块不同鉴权 </span></span><br><span class="line">registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handler -&gt; {</span><br><span class="line">    SaRouter.match(<span class="string">"/user/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"user"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/admin/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"admin"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/goods/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"goods"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/orders/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"orders"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/notice/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"notice"</span>));</span><br><span class="line">    <span class="comment">// 更多模块... </span></span><br><span class="line">})).addPathPatterns(<span class="string">"/**"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>当你受够了 Shiro、SpringSecurity 等框架的三拜九叩之后，你就会明白，相对于这些传统老牌框架，Sa-Token 的 API 设计是多么的简单、优雅！</p>
<h2 id="Sa-Token-功能预览"><a href="#Sa-Token-功能预览" class="headerlink" title="Sa-Token 功能预览"></a>Sa-Token 功能预览</h2><p>Sa-Token 目前主要五大功能模块：登录认证、权限认证、单点登录、OAuth2.0、微服务鉴权。</p>
<ul>
<li><strong>登录认证</strong> —— 单端登录、多端登录、同端互斥登录、七天免登录。</li>
<li><strong>权限认证</strong> —— 权限认证、角色认证、会话二级认证。</li>
<li><strong>踢人下线</strong> —— 根据账号 id 踢人下线、根据 Token 值踢人下线。</li>
<li><strong>注解式鉴权</strong> —— 优雅的将鉴权与业务代码分离。</li>
<li><strong>路由拦截式鉴权</strong> —— 根据项目路由拦截鉴权，可适配 restful 模式。</li>
<li><strong>Session 会话</strong> —— 全端共享 Session ，单端独享 Session，自定义 Session ，方便的存取值。</li>
<li><strong>持久层扩展</strong> —— 可集成 Redis ，重启数据不丢失。</li>
<li><strong>前后台分离</strong> —— APP 、小程序等不支持 Cookie 的终端也可以轻松鉴权。</li>
<li><strong>Token 风格定制</strong> —— 内置流中 Token 风格，还可：自定义 Token 生成策略。</li>
<li><strong>记住我模式</strong> —— 适配 [记住我] 模式，重启浏览器免验证。</li>
<li><strong>二级认证</strong> —— 在已登录的基础上再次认证，保证安全性。</li>
<li><strong>模拟他人账号</strong> —— 实时操作任意用户状态数据。</li>
<li><strong>临时身份切换</strong> —— 将会话身份临时切换为其他账号。</li>
<li><strong>同端互斥登录</strong> —— 像 QQ 一样手机电脑同时在线，但是两个手机上互斥登录。</li>
<li><strong>账号封禁</strong> —— 登录封禁、按照业务分类封禁、按照处罚阶梯封禁。</li>
<li><strong>密码加密</strong> —— 提供基础加密算法，可快速 MD5、SHA1、SHA256、AES 加密。</li>
<li><strong>会话查询</strong> —— 提供方便灵活的会话查询接口。</li>
<li><strong>Http Basic 认证</strong> —— 一行代码接入 Http Basic 、Digest 认证。</li>
<li><strong>全局侦听器</strong> —— 在用户登录、注销、被踢下线等关键性操作时进行一些 AOP 操作。</li>
<li><strong>全局过滤器</strong> —— 方便的处理跨域，全局设置安全响应头等操作。</li>
<li><strong>多账号体系认证</strong> —— 一个系统多套账号分开鉴权（比如商城的 User 表和 Admin 表）。</li>
<li><strong>单点登录</strong> —— 内置三种单点登录模式：同城、跨域、同 Redis、跨 Redis、前后端分离等架构都可以搞定。</li>
<li><strong>单点注销</strong> —— 任意子系统内发起注销，即可全端下线。</li>
<li><strong>OAuth2.0 认证</strong> —— 轻松搭建 OAuth2.0 服务，支持 openid 模式。</li>
<li><strong>分布式会话</strong> —— 提供共享数据中心分布式会话方案。</li>
<li><strong>微服务网关鉴权</strong> —— 适配 Gateway 、ShenYu 、Zuul 等常见网关的路由拦截认证。</li>
<li><strong>RPC 调用鉴权</strong> —— 网关转发鉴权，RPC 调用鉴权，让服务调用不再裸奔。</li>
<li><strong>临时 Token 认证</strong> —— 解决短时间的 Token 授权问题。</li>
<li><strong>独立 Redis</strong> —— 将权限缓存与业务缓存分离。</li>
<li><strong>Quick 快速登录认证</strong> —— 为项目零代码注入一个登录页面。</li>
<li><strong>标签方言</strong> —— 提供 Thymeleaf 标签方言集成包，提供 beetl 集成示例。</li>
<li><strong>jwt 集成</strong> —— 提供三种模式的 jwt 集成方案，提供 token 扩展参数能力。</li>
<li><strong>RPC 调用状态传递</strong> —— 提供 dubbo 、grpc 等集成包，在 RPC 调用时登陆状态不丢失。</li>
<li><strong>参数签名</strong> —— 提供跨系统 API 调用签名校验模块，防止参数篡改，防止请求重放。</li>
<li><strong>自动续签</strong> —— 提供两种 Token 过期策略，灵活搭配使用，还可以自动续签。</li>
<li><strong>开箱即用</strong> —— 提供 SpringMVC 、WebFlus 、Solon 等常见框架集成包，开箱即用。</li>
<li><strong>最新技术栈</strong> —— 适配最新技术栈：支持 SpringBoot 3.x ，jdk 17 。</li>
</ul>
<p>功能结构图：</p>
<p><img src="/img/load.gif" data-original="https://color-test.oss-cn-qingdao.aliyuncs.com/sa-token/x/sa-token-js4.png" alt="sa-token-js"></p>
<hr>
<h1 id="在-SpringBoot-中集成"><a href="#在-SpringBoot-中集成" class="headerlink" title="在 SpringBoot 中集成"></a>在 SpringBoot 中集成</h1><h2 id="1、创建项目"><a href="#1、创建项目" class="headerlink" title="1、创建项目"></a>1、创建项目</h2><p>在 IDE 中新建一个 SpringBoot 项目，例如 <code>sa-token-demo-springboot</code></p>
<h2 id="2、添加依赖"><a href="#2、添加依赖" class="headerlink" title="2、添加依赖"></a>2、添加依赖</h2><p>在项目中添加依赖：</p>
<p>Maven 方式</p>
<p>注：如果你使用的是 SpringBoot 3.x，只需要将 <code>sa-token-spring-boot-starter</code> 修改为 <code>sa-token-spring-boot3-starter</code> 即可。</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Sa-Token 权限认证，在线文档：https://sa-token.cc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.dev33<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sa-token-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.39.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="3、设置配置文件"><a href="#3、设置配置文件" class="headerlink" title="3、设置配置文件"></a>3、设置配置文件</h2><p>你可以<strong>零配置启动项目</strong> ，但同时你也可以在 <code>application.yml</code> 中增加如下配置，定制性使用框架：</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">############## Sa-Token 配置 (文档: https://sa-token.cc) ##############</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="comment"># token 名称（同时也是 cookie 名称）</span></span><br><span class="line">    <span class="attr">token-name:</span> <span class="string">satoken</span></span><br><span class="line">    <span class="comment"># token 有效期（单位：秒） 默认30天，-1 代表永久有效</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">2592000</span></span><br><span class="line">    <span class="comment"># token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结</span></span><br><span class="line">    <span class="attr">active-timeout:</span> <span class="number">-1</span></span><br><span class="line">    <span class="comment"># 是否允许同一账号多地同时登录 （为 true 时允许一起登录, 为 false 时新登录挤掉旧登录）</span></span><br><span class="line">    <span class="attr">is-concurrent:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token, 为 false 时每次登录新建一个 token）</span></span><br><span class="line">    <span class="attr">is-share:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># token 风格（默认可取值：uuid、simple-uuid、random-32、random-64、random-128、tik）</span></span><br><span class="line">    <span class="attr">token-style:</span> <span class="string">uuid</span></span><br><span class="line">    <span class="comment"># 是否输出操作日志 </span></span><br><span class="line">    <span class="attr">is-log:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="4、创建启动类"><a href="#4、创建启动类" class="headerlink" title="4、创建启动类"></a>4、创建启动类</h2><p>在项目中新建包 <code>com.sa.token</code> ，在此包内新建主类 <code>SaTokenDemoApplication.java</code>，复制以下代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenDemoApplication</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException {</span><br><span class="line">        SpringApplication.run(SaTokenDemoApplication.class, args);</span><br><span class="line">        System.out.println(<span class="string">"启动成功，Sa-Token 配置如下："</span> + SaManager.getConfig());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="5、创建测试-Controller"><a href="#5、创建测试-Controller" class="headerlink" title="5、创建测试 Controller"></a>5、创建测试 Controller</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user/")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试登录，浏览器访问： http://localhost:8081/user/doLogin?username=zhang&amp;password=123456</span></span><br><span class="line">    <span class="meta">@RequestMapping("doLogin")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doLogin</span><span class="params">(String username, String password)</span> {</span><br><span class="line">        <span class="comment">// 此处仅作模拟示例，真实项目需要从数据库中查询数据进行比对 </span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"zhang"</span>.equals(username) &amp;&amp; <span class="string">"123456"</span>.equals(password)) {</span><br><span class="line">            StpUtil.login(<span class="number">10001</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"登录成功"</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"登录失败"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询登录状态，浏览器访问： http://localhost:8081/user/isLogin</span></span><br><span class="line">    <span class="meta">@RequestMapping("isLogin")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">isLogin</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"当前会话是否登录："</span> + StpUtil.isLogin();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="6、运行"><a href="#6、运行" class="headerlink" title="6、运行"></a>6、运行</h2><p>启动代码，依次运行上述接口：</p>
<p><img src="/img/load.gif" data-original="/../../../../../images/frameworks/Java/auth/sa-token/a/v1.png" alt="v1"></p>
<p><img src="/img/load.gif" data-original="/../../../../../images/frameworks/Java/auth/sa-token/a/v2.png" alt="v2"></p>
<p><img src="/img/load.gif" data-original="/../../../../../images/frameworks/Java/auth/sa-token/a/v3.png" alt="v3"></p>
<hr>
<h1 id="登录认证"><a href="#登录认证" class="headerlink" title="登录认证"></a>登录认证</h1><h2 id="1、设计思路"><a href="#1、设计思路" class="headerlink" title="1、设计思路"></a>1、设计思路</h2><p>对于一些登录之后才能访问的接口（例如：查询我的账号资料），我们通常的做法是增加一层接口校验：</p>
<ul>
<li>如果校验通过，则：正常返回数据</li>
<li>如果校验未通过，则：抛出异常，告知其需要先进性登录。</li>
</ul>
<p>那么，判断会话是否登录的依据是什么？我们先来简单分析一下登录访问流程：</p>
<ol>
<li>用户提交 <code>name</code> + <code>password</code> 参数，调用登录接口。</li>
<li>登录成功，返回这个用户的 Token 会话凭证。</li>
<li>用户后续的每次请求，都携带上这个 Token。</li>
<li>服务器根据 Token 判断此会话是否登录成功。</li>
</ol>
<p>所谓登录认证，指的就是服务器校验账号密码，为用户颁发 Token 会话凭证的过程，这个 Token 也是我们后续判断会话是否登录的关键所在。</p>
<p><button style="background: #fbca1f; font-family: inherit; padding: 0.6em 1.3em; font-weight: 900; font-size: 18px;
border: 3px solid black; border-radius: 0.4em; box-shadow: 0.1em 0.1em; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s;" onclick="window.open('https://oss.dev33.cn/sa-token/doc/g/g3--login-auth.gif', '_blank');" onmouseover="this.style.transform='translate(-0.05em, -0.05em)'; this.style.boxShadow='0.15em 0.15em';" onmouseout="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';" onmousedown="this.style.transform='translate(0.05em, 0.05em)'; this.style.boxShadow='0.05em 0.05em';" onmouseup="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';"><br>加载动态演示图<br></button></p>
<h2 id="2、登录与注销"><a href="#2、登录与注销" class="headerlink" title="2、登录与注销"></a>2、登录与注销</h2><p>根据以上思路，我们需要一个会话登录的函数：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 会话登录：参数填写要登录的账号id，建议的数据类型：long | int | String， 不可以传入复杂类型，如：User、Admin 等等</span></span><br><span class="line">StpUtil.login(Object id);     </span><br></pre></td></tr></tbody></table></figure>

<p>只此一句代码，便可以使会话登录成功，实际上，Sa-Token 在背后做了大量的工作，包括但不限于：</p>
<ol>
<li>检查此账号是否之前已有登录；</li>
<li>为账号生成 <code>Token</code> 凭证与 <code>Session</code> 会话；</li>
<li>记录 Token 活跃时间；</li>
<li>通知全局侦听器，xx 账号登录成功；</li>
<li>将 <code>Token</code> 注入到请求上下问；</li>
</ol>
<p>你暂时不需要完整了解整个登录过程，你只需要记住关键一点：<code>Sa-Token 为这个账号创建了一个Token凭证，且通过 Cookie 上下文返回给了前端</code>。</p>
<p>所以一般情况下，我们的登录接口代码，会大致类似如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 会话登录接口 </span></span><br><span class="line"><span class="meta">@RequestMapping("doLogin")</span></span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">doLogin</span><span class="params">(String name, String pwd)</span> {</span><br><span class="line">    <span class="comment">// 第一步：比对前端提交的账号名称、密码</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">"zhang"</span>.equals(name) &amp;&amp; <span class="string">"123456"</span>.equals(pwd)) {</span><br><span class="line">        <span class="comment">// 第二步：根据账号id，进行登录 </span></span><br><span class="line">        StpUtil.login(<span class="number">10001</span>);</span><br><span class="line">        <span class="keyword">return</span> SaResult.ok(<span class="string">"登录成功"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> SaResult.error(<span class="string">"登录失败"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果你对以上代码阅读没有压力，你可能会注意到略显奇怪的一点：此处仅仅做了会话登录，但并没有主动向前端返回 token 信息。是因为不需要吗？严格来讲是需要的，只不过 <code>StpUtil.login(id)</code> 方法利用了 Cookie 自动注入的特性，省略了你手写返回 token 的代码。</p>
<blockquote>
<p>Cookie 是什么？</p>
<p>如果你对 Cookie 功能还不太了解，也不用担心，我们会在之后的 [ 前后端分离 ] 章节中详细的阐述 Cookie 功能，现在你只需要了解最基本的两点：</p>
<ul>
<li>Cookie 可以从后端控制往浏览器中写入 token 值。</li>
<li>Cookie 会在前端每次发起请求时自动提交 token 值。</li>
</ul>
<p>因此，在 Cookie 功能的加持下，我们可以仅靠 <code>StpUtil.login(id)</code> 一句代码就完成登录认证。</p>
</blockquote>
<p>除了登录方法，我们还需要：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 当前会话注销登录</span></span><br><span class="line">StpUtil.logout();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前会话是否已经登录，返回true=已登录，false=未登录</span></span><br><span class="line">StpUtil.isLogin();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检验当前会话是否已经登录, 如果未登录，则抛出异常：`NotLoginException`</span></span><br><span class="line">StpUtil.checkLogin();</span><br></pre></td></tr></tbody></table></figure>

<p>异常 <code>NotLoginException</code> 代表当前会话暂未登录，可能的原因有很多：前端没有提交 token 、前端提交的 token 是无效的、前端提交的 token 已经过期 …… 等等，可参照：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL25vdC1sb2dpbi1zY2VuZQ==">未登录场景值</a> 了解如何获取未登录的场景值。</p>
<h2 id="3、会话查询"><a href="#3、会话查询" class="headerlink" title="3、会话查询"></a>3、会话查询</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前会话账号id, 如果未登录，则抛出异常：`NotLoginException`</span></span><br><span class="line">StpUtil.getLoginId();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类似查询API还有：</span></span><br><span class="line">StpUtil.getLoginIdAsString();    <span class="comment">// 获取当前会话账号id, 并转化为`String`类型</span></span><br><span class="line">StpUtil.getLoginIdAsInt();       <span class="comment">// 获取当前会话账号id, 并转化为`int`类型</span></span><br><span class="line">StpUtil.getLoginIdAsLong();      <span class="comment">// 获取当前会话账号id, 并转化为`long`类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------- 指定未登录情形下返回的默认值 ----------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前会话账号id, 如果未登录，则返回 null </span></span><br><span class="line">StpUtil.getLoginIdDefaultNull();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前会话账号id, 如果未登录，则返回默认值 （`defaultValue`可以为任意类型）</span></span><br><span class="line">StpUtil.getLoginId(T defaultValue);</span><br></pre></td></tr></tbody></table></figure>



<h2 id="4、Token-查询"><a href="#4、Token-查询" class="headerlink" title="4、Token 查询"></a>4、Token 查询</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前会话的 token 值</span></span><br><span class="line">StpUtil.getTokenValue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前`StpLogic`的 token 名称</span></span><br><span class="line">StpUtil.getTokenName();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定 token 对应的账号id，如果未登录，则返回 null</span></span><br><span class="line">StpUtil.getLoginIdByToken(String tokenValue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前会话剩余有效期（单位：s，返回-1代表永久有效）</span></span><br><span class="line">StpUtil.getTokenTimeout();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前会话的 token 信息参数</span></span><br><span class="line">StpUtil.getTokenInfo();</span><br></pre></td></tr></tbody></table></figure>

<p>有关<code>TokenInfo</code>参数详解，请参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Rva2VuLWluZm8=">TokenInfo参数详解</a></p>
<h2 id="5、来个小测试，加深一下理解"><a href="#5、来个小测试，加深一下理解" class="headerlink" title="5、来个小测试，加深一下理解"></a>5、来个小测试，加深一下理解</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录测试 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/acc/")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试登录  ---- http://localhost:8081/acc/doLogin?name=zhang&amp;pwd=123456</span></span><br><span class="line">    <span class="meta">@RequestMapping("doLogin")</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">doLogin</span><span class="params">(String name, String pwd)</span> {</span><br><span class="line">        <span class="comment">// 此处仅作模拟示例，真实项目需要从数据库中查询数据进行比对 </span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"zhang"</span>.equals(name) &amp;&amp; <span class="string">"123456"</span>.equals(pwd)) {</span><br><span class="line">            StpUtil.login(<span class="number">10001</span>);</span><br><span class="line">            <span class="keyword">return</span> SaResult.ok(<span class="string">"登录成功"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> SaResult.error(<span class="string">"登录失败"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询登录状态  ---- http://localhost:8081/acc/isLogin</span></span><br><span class="line">    <span class="meta">@RequestMapping("isLogin")</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">isLogin</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> SaResult.ok(<span class="string">"是否登录："</span> + StpUtil.isLogin());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询 Token 信息  ---- http://localhost:8081/acc/tokenInfo</span></span><br><span class="line">    <span class="meta">@RequestMapping("tokenInfo")</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">tokenInfo</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> SaResult.data(StpUtil.getTokenInfo());</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试注销  ---- http://localhost:8081/acc/logout</span></span><br><span class="line">    <span class="meta">@RequestMapping("logout")</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">logout</span><span class="params">()</span> {</span><br><span class="line">        StpUtil.logout();</span><br><span class="line">        <span class="keyword">return</span> SaResult.ok();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>[本章代码示例：Sa-Token 登录认证 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jYXNlcy91c2UvTG9naW5BdXRoQ29udHJvbGxlci5qYXZh"> LoginAuthController.java ]</a></p>
<hr>
<h1 id="权限认证"><a href="#权限认证" class="headerlink" title="权限认证"></a>权限认证</h1><h2 id="1、设计思路-1"><a href="#1、设计思路-1" class="headerlink" title="1、设计思路"></a>1、设计思路</h2><p>所谓权限认证，核心逻辑就是判断一个账号是否拥有指定权限：</p>
<ul>
<li>有，就让你通过。</li>
<li>没有？那么禁止访问！</li>
</ul>
<p>深入到底层数据中，就是每个账号都会拥有一组权限码集合，框架来校验这个集合中是否包含指定的权限码。</p>
<p>例如：当前账号哦拥有权限码集合 <code>["user-add", "user-delete", "user-get"]</code> ，这时候我来校验权限 <code>"user-update"</code> ，则其结果就是：验证失败，禁止访问。</p>
<button style="background: #fbca1f; font-family: inherit; padding: 0.6em 1.3em; font-weight: 900; font-size: 18px; border: 3px solid black; border-radius: 0.4em; box-shadow: 0.1em 0.1em; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s;" onclick="toggleGif()" onmouseover="this.style.transform='translate(-0.05em, -0.05em)'; this.style.boxShadow='0.15em 0.15em';" onmouseout="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';" onmousedown="this.style.transform='translate(0.05em, 0.05em)'; this.style.boxShadow='0.05em 0.05em';" onmouseup="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';">
加载动态演示图
</button>


<img id="gifImage" src="/img/load.gif" data-original="https://oss.dev33.cn/sa-token/doc/g/g3--jur-auth.gif" style="display:none; width: 1280px; height: auto;" alt="动态演示图">

<script>
function toggleGif() {
    const gif = document.getElementById('gifImage');
    if (gif.style.display === 'none' || gif.style.display === '') {
        gif.style.display = 'block'; 
    } else {
        gif.style.display = 'none'; 
    }
}
</script>

<p><br><br></p>
<p>所以现在问题的核心就是两个：</p>
<ol>
<li>如何获取一个账号所拥有的权限码集合？</li>
<li>本次操作需要验证的权限码是哪个？</li>
</ol>
<h2 id="2、获取当前账号权限码集合"><a href="#2、获取当前账号权限码集合" class="headerlink" title="2、获取当前账号权限码集合"></a>2、获取当前账号权限码集合</h2><p>因为每个项目的需求不同，其权限设计也千变万化，因此 [ 获取当前账号权限码集合 ] 这一操作不可能内置到框架中，所以 Sa-Token 将此操作以接口的方式暴露给你，以方便你根据自己的业务逻辑进行重写。</p>
<p>你需要做的是新建一个类，实现 <code>StpInterface</code> 接口，例如以下代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义权限加载接口实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span>    <span class="comment">// 保证此类被 SpringBoot 扫描，完成 Sa-Token 的自定义权限验证扩展 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StpInterfaceImpl</span> <span class="keyword">implements</span> <span class="title class_">StpInterface</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回一个账号所拥有的权限码集合 </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getPermissionList</span><span class="params">(Object loginId, String loginType)</span> {</span><br><span class="line">        <span class="comment">// 本 list 仅做模拟，实际项目中要根据具体业务逻辑来查询权限</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();    </span><br><span class="line">        list.add(<span class="string">"101"</span>);</span><br><span class="line">        list.add(<span class="string">"user.add"</span>);</span><br><span class="line">        list.add(<span class="string">"user.update"</span>);</span><br><span class="line">        list.add(<span class="string">"user.get"</span>);</span><br><span class="line">        <span class="comment">// list.add("user.delete");</span></span><br><span class="line">        list.add(<span class="string">"art.*"</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回一个账号所拥有的角色标识集合 (权限与角色可分开校验)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getRoleList</span><span class="params">(Object loginId, String loginType)</span> {</span><br><span class="line">        <span class="comment">// 本 list 仅做模拟，实际项目中要根据具体业务逻辑来查询角色</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();    </span><br><span class="line">        list.add(<span class="string">"admin"</span>);</span><br><span class="line">        list.add(<span class="string">"super-admin"</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>参数解释：</strong></p>
<ul>
<li>loginId：账号 id，即你在调用 <code>StpUtil.login(id)</code> 时写入的标识值。</li>
<li>loginType：账号体系标识，此处可以暂时忽略，在 [ 多账户认证 ] 章节下会对这个概念做详细的解释。</li>
</ul>
<blockquote>
<p>有同学会产生疑问：我实现了此接口，但是程序启动时好像并没有执行，是不是我写错了？</p>
<p>答：不执行是正常现象，程序启动时不会执行这个接口的方法，在每次调用鉴权代码时，才会执行到此。</p>
</blockquote>
<h2 id="3、权限校验"><a href="#3、权限校验" class="headerlink" title="3、权限校验"></a>3、权限校验</h2><p>然后就可以用以下 api 来鉴权了</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取：当前账号所拥有的权限集合</span></span><br><span class="line">StpUtil.getPermissionList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断：当前账号是否含有指定权限, 返回 true 或 false</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"user.add"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定权限, 如果验证未通过，则抛出异常: NotPermissionException </span></span><br><span class="line">StpUtil.checkPermission(<span class="string">"user.add"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定权限 [指定多个，必须全部验证通过]</span></span><br><span class="line">StpUtil.checkPermissionAnd(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定权限 [指定多个，只要其一验证通过即可]</span></span><br><span class="line">StpUtil.checkPermissionOr(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);    </span><br></pre></td></tr></tbody></table></figure>

<p>扩展：<code>NotPermissionException</code> 对象可通过 <code>getLoginType()</code> 方法获取具体是哪个 <code>StpLogic</code> 抛出的异常</p>
<h2 id="4、角色校验"><a href="#4、角色校验" class="headerlink" title="4、角色校验"></a>4、角色校验</h2><p>在 Sa-Token 中，角色和权限可以分开独立验证</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取：当前账号所拥有的角色集合</span></span><br><span class="line">StpUtil.getRoleList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断：当前账号是否拥有指定角色, 返回 true 或 false</span></span><br><span class="line">StpUtil.hasRole(<span class="string">"super-admin"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定角色标识, 如果验证未通过，则抛出异常: NotRoleException</span></span><br><span class="line">StpUtil.checkRole(<span class="string">"super-admin"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定角色标识 [指定多个，必须全部验证通过]</span></span><br><span class="line">StpUtil.checkRoleAnd(<span class="string">"super-admin"</span>, <span class="string">"shop-admin"</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验：当前账号是否含有指定角色标识 [指定多个，只要其一验证通过即可] </span></span><br><span class="line">StpUtil.checkRoleOr(<span class="string">"super-admin"</span>, <span class="string">"shop-admin"</span>);        </span><br></pre></td></tr></tbody></table></figure>

<p>扩展：<code>NotRoleException</code> 对象可通过 <code>getLoginType()</code> 方法获取具体是哪个 <code>StpLogic</code> 抛出的异常</p>
<h2 id="5、拦截全局异常"><a href="#5、拦截全局异常" class="headerlink" title="5、拦截全局异常"></a>5、拦截全局异常</h2><p>有同学要问，鉴权失败，抛出异常，然后呢？要把异常显示给用户看吗？<strong>当然不可以！</strong></p>
<p>你可以创建一个全局异常拦截器，统一返回给前端的格式，参考：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> {</span><br><span class="line">    <span class="comment">// 全局异常拦截 </span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">handlerException</span><span class="params">(Exception e)</span> {</span><br><span class="line">        e.printStackTrace(); </span><br><span class="line">        <span class="keyword">return</span> SaResult.error(e.getMessage());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jdXJyZW50L0dsb2JhbEV4Y2VwdGlvbi5qYXZh">码云：GlobalException.java</a></p>
<h2 id="6、权限通配符"><a href="#6、权限通配符" class="headerlink" title="6、权限通配符"></a>6、权限通配符</h2><p>Sa-Token允许你根据通配符指定<strong>泛权限</strong>，例如当一个账号拥有<code>art.*</code>的权限时，<code>art.add</code>、<code>art.delete</code>、<code>art.update</code>都将匹配通过</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 当拥有 art.* 权限时</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"art.add"</span>);        <span class="comment">// true</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"art.update"</span>);     <span class="comment">// true</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"goods.add"</span>);      <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当拥有 *.delete 权限时</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"art.delete"</span>);      <span class="comment">// true</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"user.delete"</span>);     <span class="comment">// true</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"user.update"</span>);     <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当拥有 *.js 权限时</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"index.js"</span>);        <span class="comment">// true</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"index.css"</span>);       <span class="comment">// false</span></span><br><span class="line">StpUtil.hasPermission(<span class="string">"index.html"</span>);      <span class="comment">// false</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>上帝权限</p>
<p>当一个账号拥有 <code>"*"</code> 权限时，他可以验证通过任何权限码 （角色认证同理）</p>
</blockquote>
<h2 id="7、如何把权限精确到按钮级？"><a href="#7、如何把权限精确到按钮级？" class="headerlink" title="7、如何把权限精确到按钮级？"></a>7、如何把权限精确到按钮级？</h2><p>权限精确到按钮级的意思就是指：<strong>权限范围可以控制到页面上的每一个按钮是否显示</strong> 。</p>
<p>思路：如此精确的范围控制只依赖后端已经难以完成，此时需要前端进行一定的逻辑判断。</p>
<p>如果是前后端一体项目，可以参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvcGx1Z2luL3RoeW1lbGVhZi1leHRlbmQ=">Thymeleaf 标签方言</a>，如果是前后端分离项目，则：</p>
<ol>
<li><p>在登录时，把当前账号拥有的所有权限码一次性返回给前端。</p>
</li>
<li><p>前端将权限码集合保存在 <code>localStorage</code> 或其他全局状态管理对象中。</p>
</li>
<li><p>在需要权限控制的按钮上，使用 js 进行逻辑判断，例如在 <code>Vue</code> 框架中我们可以使用如下写法：</p>
<figure class="highlight js"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// `arr`是当前用户拥有的权限码数组</span></span><br><span class="line"><span class="comment">// `user.delete`是显示按钮需要拥有的权限码</span></span><br><span class="line"><span class="comment">// `删除按钮`是用户拥有权限码才可以看到的内容。</span></span><br><span class="line">&lt;button v-<span class="keyword">if</span>=<span class="string">"arr.indexOf('user.delete') &gt; -1"</span>&gt;删除按钮&lt;/button&gt;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>以上写法只为提供一个参考示例，不同框架有不同写法，大家可根据项目技术栈灵活封装进行调用。</p>
<blockquote>
<p>✍ 前端有了鉴权后端还需要鉴权吗？</p>
<p><strong>需要！</strong><br>前端的鉴权只是一个辅助功能，对于专业人员这些限制都是可以轻松绕过的，为保证服务器安全：<strong>无论前端是否进行了权限校验，后端接口都需要对会话请求再次进行权限校验！</strong></p>
</blockquote>
<h2 id="8、示例代码"><a href="#8、示例代码" class="headerlink" title="8、示例代码"></a>8、示例代码</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sa-Token 权限认证示例 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> click33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022-10-13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/jur/")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JurAuthController</span> {</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 前提1：首先调用登录接口进行登录，代码在 com.pj.cases.use.LoginAuthController 中有详细解释，此处不再赘述 </span></span><br><span class="line"><span class="comment">	 * 		---- http://localhost:8081/acc/doLogin?name=zhang&amp;pwd=123456</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 前提2：项目实现 StpInterface 接口，代码在  com.pj.satoken.StpInterfaceImpl</span></span><br><span class="line"><span class="comment">	 * 		Sa-Token 将从此实现类获取 每个账号拥有哪些权限。</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 然后我们就可以使用以下示例中的代码进行鉴权了 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 查询权限   ---- http://localhost:8081/jur/getPermission</span></span><br><span class="line">	<span class="meta">@RequestMapping("getPermission")</span></span><br><span class="line">	<span class="keyword">public</span> SaResult <span class="title function_">getPermission</span><span class="params">()</span> {</span><br><span class="line">		<span class="comment">// 查询权限信息 ，如果当前会话未登录，会返回一个空集合 </span></span><br><span class="line">		List&lt;String&gt; permissionList = StpUtil.getPermissionList();</span><br><span class="line">		System.out.println(<span class="string">"当前登录账号拥有的所有权限："</span> + permissionList);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 查询角色信息 ，如果当前会话未登录，会返回一个空集合 </span></span><br><span class="line">		List&lt;String&gt; roleList = StpUtil.getRoleList();</span><br><span class="line">		System.out.println(<span class="string">"当前登录账号拥有的所有角色："</span> + roleList);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 返回给前端 </span></span><br><span class="line">		<span class="keyword">return</span> SaResult.ok()</span><br><span class="line">				.set(<span class="string">"roleList"</span>, roleList)</span><br><span class="line">				.set(<span class="string">"permissionList"</span>, permissionList);</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 权限校验  ---- http://localhost:8081/jur/checkPermission</span></span><br><span class="line">	<span class="meta">@RequestMapping("checkPermission")</span></span><br><span class="line">	<span class="keyword">public</span> SaResult <span class="title function_">checkPermission</span><span class="params">()</span> {</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 判断：当前账号是否拥有一个权限，返回 true 或 false</span></span><br><span class="line">		<span class="comment">// 		如果当前账号未登录，则永远返回 false </span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"user.add"</span>);</span><br><span class="line">		StpUtil.hasPermissionAnd(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);  <span class="comment">// 指定多个，必须全部拥有才会返回 true </span></span><br><span class="line">		StpUtil.hasPermissionOr(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);	 <span class="comment">// 指定多个，只要拥有一个就会返回 true </span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 校验：当前账号是否拥有一个权限，校验不通过时会抛出 `NotPermissionException` 异常 </span></span><br><span class="line">		<span class="comment">// 		如果当前账号未登录，则永远校验失败 </span></span><br><span class="line">		StpUtil.checkPermission(<span class="string">"user.add"</span>);</span><br><span class="line">		StpUtil.checkPermissionAnd(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);  <span class="comment">// 指定多个，必须全部拥有才会校验通过 </span></span><br><span class="line">		StpUtil.checkPermissionOr(<span class="string">"user.add"</span>, <span class="string">"user.delete"</span>, <span class="string">"user.get"</span>);  <span class="comment">// 指定多个，只要拥有一个就会校验通过 </span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> SaResult.ok();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 角色校验  ---- http://localhost:8081/jur/checkRole</span></span><br><span class="line">	<span class="meta">@RequestMapping("checkRole")</span></span><br><span class="line">	<span class="keyword">public</span> SaResult <span class="title function_">checkRole</span><span class="params">()</span> {</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 判断：当前账号是否拥有一个角色，返回 true 或 false</span></span><br><span class="line">		<span class="comment">// 		如果当前账号未登录，则永远返回 false </span></span><br><span class="line">		StpUtil.hasRole(<span class="string">"admin"</span>);</span><br><span class="line">		StpUtil.hasRoleAnd(<span class="string">"admin"</span>, <span class="string">"ceo"</span>, <span class="string">"cfo"</span>);  <span class="comment">// 指定多个，必须全部拥有才会返回 true </span></span><br><span class="line">		StpUtil.hasRoleOr(<span class="string">"admin"</span>, <span class="string">"ceo"</span>, <span class="string">"cfo"</span>);	  <span class="comment">// 指定多个，只要拥有一个就会返回 true </span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 校验：当前账号是否拥有一个角色，校验不通过时会抛出 `NotRoleException` 异常 </span></span><br><span class="line">		<span class="comment">// 		如果当前账号未登录，则永远校验失败 </span></span><br><span class="line">		StpUtil.checkRole(<span class="string">"admin"</span>);</span><br><span class="line">		StpUtil.checkRoleAnd(<span class="string">"admin"</span>, <span class="string">"ceo"</span>, <span class="string">"cfo"</span>);  <span class="comment">// 指定多个，必须全部拥有才会校验通过 </span></span><br><span class="line">		StpUtil.checkRoleOr(<span class="string">"admin"</span>, <span class="string">"ceo"</span>, <span class="string">"cfo"</span>);  <span class="comment">// 指定多个，只要拥有一个就会校验通过 </span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> SaResult.ok();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 权限通配符  ---- http://localhost:8081/jur/wildcardPermission</span></span><br><span class="line">	<span class="meta">@RequestMapping("wildcardPermission")</span></span><br><span class="line">	<span class="keyword">public</span> SaResult <span class="title function_">wildcardPermission</span><span class="params">()</span> {</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 前提条件：在 StpInterface 实现类中，为账号返回了 "art.*" 泛权限</span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"art.add"</span>);  <span class="comment">// 返回 true </span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"art.delete"</span>);  <span class="comment">// 返回 true </span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"goods.add"</span>);  <span class="comment">// 返回 false，因为前缀不符合  </span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// * 符合可以出现在任意位置，比如权限码的开头，当账号拥有 "*.delete" 时  </span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"goods.add"</span>);        <span class="comment">// false</span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"goods.delete"</span>);     <span class="comment">// true</span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"art.delete"</span>);      <span class="comment">// true</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 也可以出现在权限码的中间，比如当账号拥有 "shop.*.user" 时  </span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"shop.add.user"</span>);  <span class="comment">// true</span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"shop.delete.user"</span>);  <span class="comment">// true</span></span><br><span class="line">		StpUtil.hasPermission(<span class="string">"shop.delete.goods"</span>);  <span class="comment">// false，因为后缀不符合 </span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 注意点：</span></span><br><span class="line">		<span class="comment">// 1、上帝权限：当一个账号拥有 "*" 权限时，他可以验证通过任何权限码</span></span><br><span class="line">		<span class="comment">// 2、角色校验也可以加 * ，指定泛角色，例如： "*.admin"，暂不赘述 </span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> SaResult.ok();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>[本章代码示例：Sa-Token 权限认证 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jYXNlcy91c2UvSnVyQXV0aENvbnRyb2xsZXIuamF2YQ=="> JurAuthController.java ]</a></p>
<hr>
<h1 id="踢人下线"><a href="#踢人下线" class="headerlink" title="踢人下线"></a>踢人下线</h1><p>所谓踢人下线，核心操作就是找到指定 <code>loginId</code> 对应的 <code>Token</code> ，并设置其失效。</p>
<p><img src="/img/load.gif" data-original="https://oss.dev33.cn/sa-token/doc/kickout.png" alt="踢下线"></p>
<h2 id="1、强制注销"><a href="#1、强制注销" class="headerlink" title="1、强制注销"></a>1、强制注销</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">StpUtil.logout(<span class="number">10001</span>);                    <span class="comment">// 强制指定账号注销下线 </span></span><br><span class="line">StpUtil.logout(<span class="number">10001</span>, <span class="string">"PC"</span>);              <span class="comment">// 强制指定账号指定端注销下线 </span></span><br><span class="line">StpUtil.logoutByTokenValue(<span class="string">"token"</span>);      <span class="comment">// 强制指定 Token 注销下线 </span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="2、踢人下线"><a href="#2、踢人下线" class="headerlink" title="2、踢人下线"></a>2、踢人下线</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">StpUtil.kickout(<span class="number">10001</span>);                    <span class="comment">// 将指定账号踢下线 </span></span><br><span class="line">StpUtil.kickout(<span class="number">10001</span>, <span class="string">"PC"</span>);              <span class="comment">// 将指定账号指定端踢下线</span></span><br><span class="line">StpUtil.kickoutByTokenValue(<span class="string">"token"</span>);      <span class="comment">// 将指定 Token 踢下线</span></span><br></pre></td></tr></tbody></table></figure>



<p>强制注销 和 踢人下线 的区别在于：</p>
<ul>
<li>强制注销等价于对方主动调用了注销方法，再次访问会提示：Token无效。</li>
<li>踢人下线不会清除Token信息，而是将其打上特定标记，再次访问会提示：Token已被踢下线。</li>
</ul>
<p><button style="background: #fbca1f; font-family: inherit; padding: 0.6em 1.3em; font-weight: 900; font-size: 18px; border: 3px solid black; border-radius: 0.4em; box-shadow: 0.1em 0.1em; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s;" onclick="toggleGif1()" onmouseover="this.style.transform='translate(-0.05em, -0.05em)'; this.style.boxShadow='0.15em 0.15em';" onmouseout="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';" onmousedown="this.style.transform='translate(0.05em, 0.05em)'; this.style.boxShadow='0.05em 0.05em';" onmouseup="this.style.transform=''; this.style.boxShadow='0.1em 0.1em';"><br>加载动态演示图<br></button></p>
<img id="gifImage1" src="/img/load.gif" data-original="https://oss.dev33.cn/sa-token/doc/g/g3--kickout.gif" style="display:none; width: 1280px; height: auto;" alt="动态演示图">

<script>
function toggleGif1() {
    const gif = document.getElementById('gifImage1');
    if (gif.style.display === 'none' || gif.style.display === '') {
        gif.style.display = 'block'; 
    } else {
        gif.style.display = 'none'; 
    }
}
</script>

<p><br><br></p>
<p>[本章代码示例：Sa-Token 踢人下线 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jYXNlcy91c2UvS2lja291dENvbnRyb2xsZXIuamF2YQ=="> KickoutController.java ]</a></p>
<hr>
<h1 id="注解鉴权"><a href="#注解鉴权" class="headerlink" title="注解鉴权"></a>注解鉴权</h1><h2 id="注解鉴权-1"><a href="#注解鉴权-1" class="headerlink" title="注解鉴权"></a>注解鉴权</h2><p>有同学表示：尽管使用代码鉴权非常方便，但是我们仍希望把鉴权逻辑和业务逻辑分离出来，我们可以使用注解鉴权吗？当然可以！</p>
<p>注解鉴权 —— 优雅的将鉴权与业务代码分离！</p>
<ul>
<li><code>@SaCheckLogin</code>：登录校验 —— 只有登录之后才能够进入该方法。</li>
<li><code>@SaCheckRole("admin")</code>：角色校验 —— 必须具有指定角色标识才能进入该方法。</li>
<li><code>@SaCheckPermission("user:add")</code>：权限校验 —— 必须具有指定权限才能进入该方法。</li>
<li><code>@SacheckSafe</code>：二级认证校验 —— 必须二级认证之后才能进入该方法。</li>
<li><code>@SaCheckHttpBasic</code>：HttpBasic 校验 —— 只有通过 HttpBasic 认证后才能进入该方法。</li>
<li><code>@SaCheckHttpDigest</code>：HttpDigest 校验 —— 只有通过 HttpDigest 认证后才能进入该方法。</li>
<li><code>@SaIgnore</code>：忽略校验 —— 表示被修饰的方法或类无需进行注解鉴权和路由拦截器鉴权。</li>
<li><code>@SacheckDisable("comment")</code>：账号服务封禁校验 —— 校验当前账号指定服务是否被封禁。</li>
</ul>
<p>Sa-Token 使用全局拦截器完成注解鉴权功能，为了不为项目带来不必要的性能负担，拦截器默认处于关闭状态</p>
<p>因此，为了使用注解鉴权，<strong>你必须手动将 Sa-Token 的全局拦截器注册到你项目中</strong></p>
<h2 id="1、注册拦截器"><a href="#1、注册拦截器" class="headerlink" title="1、注册拦截器"></a>1、注册拦截器</h2><p>以<code>SpringBoot2.0</code>为例，新建配置类<code>SaTokenConfigure.java</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> {</span><br><span class="line">    <span class="comment">// 注册 Sa-Token 拦截器，打开注解式鉴权功能 </span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">        <span class="comment">// 注册 Sa-Token 拦截器，打开注解式鉴权功能 </span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>()).addPathPatterns(<span class="string">"/**"</span>);    </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>保证此类被<code>springboot</code>启动类扫描到即可</p>
<h2 id="2、使用注解鉴权"><a href="#2、使用注解鉴权" class="headerlink" title="2、使用注解鉴权"></a>2、使用注解鉴权</h2><p>然后我们就可以愉快的使用注解鉴权了：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 登录校验：只有登录之后才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckLogin</span>                        </span><br><span class="line"><span class="meta">@RequestMapping("info")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">info</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"查询用户信息"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 角色校验：必须具有指定角色才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckRole("super-admin")</span>        </span><br><span class="line"><span class="meta">@RequestMapping("add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 权限校验：必须具有指定权限才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckPermission("user-add")</span>        </span><br><span class="line"><span class="meta">@RequestMapping("add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 二级认证校验：必须二级认证之后才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckSafe()</span>        </span><br><span class="line"><span class="meta">@RequestMapping("add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Http Basic 校验：只有通过 Http Basic 认证后才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckHttpBasic(account = "sa:123456")</span></span><br><span class="line"><span class="meta">@RequestMapping("add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Http Digest 校验：只有通过 Http Digest 认证后才能进入该方法 </span></span><br><span class="line"><span class="meta">@SaCheckHttpDigest(value = "sa:123456")</span></span><br><span class="line"><span class="meta">@RequestMapping("add")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">add</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"用户增加"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验当前账号是否被封禁 comment 服务，如果已被封禁会抛出异常，无法进入方法 </span></span><br><span class="line"><span class="meta">@SaCheckDisable("comment")</span>                </span><br><span class="line"><span class="meta">@RequestMapping("send")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">send</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"查询用户信息"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>注：以上注解都可以加在类上，代表为这个类所有方法进行鉴权</p>
<h2 id="3、设定校验模式"><a href="#3、设定校验模式" class="headerlink" title="3、设定校验模式"></a>3、设定校验模式</h2><p><code>@SaCheckRole</code>与<code>@SaCheckPermission</code>注解可设置校验模式，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 注解式鉴权：只要具有其中一个权限即可通过校验 </span></span><br><span class="line"><span class="meta">@RequestMapping("atJurOr")</span></span><br><span class="line"><span class="meta">@SaCheckPermission(value = {"user-add", "user-all", "user-delete"}, mode = SaMode.OR)</span>        </span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">atJurOr</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> SaResult.data(<span class="string">"用户信息"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>mode 有两种取值：</p>
<ul>
<li><code>SaMode.AND</code>，标注一组权限，会话必须全部具有才可通过校验。</li>
<li><code>SaMode.OR</code>，标注一组权限，会话只要具有其一即可通过校验。</li>
</ul>
<h2 id="4、角色权限双重校验-“or-校验”"><a href="#4、角色权限双重校验-“or-校验”" class="headerlink" title="4、角色权限双重校验 “or 校验”"></a>4、角色权限双重校验 “or 校验”</h2><p>假设有以下业务场景：一个接口在具有权限 <code>user.add</code> 或角色 <code>admin</code> 时可以调通。怎么写？</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 角色权限双重 “or校验”：具备指定权限或者指定角色即可通过校验</span></span><br><span class="line"><span class="meta">@RequestMapping("userAdd")</span></span><br><span class="line"><span class="meta">@SaCheckPermission(value = "user.add", orRole = "admin")</span>        </span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">userAdd</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> SaResult.data(<span class="string">"用户信息"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>orRole 字段代表权限校验未通过时的次要选择，两者只要一校验成功即可进入请求方法，其有三种写法：</p>
<ul>
<li>写法一：<code>orRole = "admin"</code>，代表需要拥有角色 admin 。</li>
<li>写法二：<code>orRole = {"admin", "manager", "staff"}</code>，代表具有三个角色其一即可。</li>
<li>写法三：<code>orRole = {"admin, manager, staff"}</code>，代表必须同时具有三个角色。</li>
</ul>
<h2 id="5、忽略认证"><a href="#5、忽略认证" class="headerlink" title="5、忽略认证"></a>5、忽略认证</h2><p>使用 <code>@SaIgnore</code> 可表示一个接口忽略认证：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SaCheckLogin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... 其它方法 </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 此接口加上了 @SaIgnore 可以游客访问 </span></span><br><span class="line">    <span class="meta">@SaIgnore</span></span><br><span class="line">    <span class="meta">@RequestMapping("getList")</span></span><br><span class="line">    <span class="keyword">public</span> SaResult <span class="title function_">getList</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">        <span class="keyword">return</span> SaResult.ok(); </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如上代码表示：<code>TestController</code> 中的所有方法都需要登录后才可以访问，但是 <code>getList</code> 接口可以匿名游客访问。</p>
<ul>
<li><code>@SaIgnore</code> 修饰方法时代表这个方法可以被游客访问，修饰类时代表这个类中的所有接口都可以游客访问。</li>
<li><code>@SaIgnore</code> 具有最高优先级，当 @SaIgnore 和其它鉴权注解一起出现时，其它鉴权注解都将被忽略。</li>
<li><code>@SaIgnore</code> 同样可以忽略掉 Sa-Token 拦截器中的路由鉴权，在下面的 [路由拦截鉴权] 章节中我们会讲到。</li>
</ul>
<h2 id="6、批量注解鉴权"><a href="#6、批量注解鉴权" class="headerlink" title="6、批量注解鉴权"></a>6、批量注解鉴权</h2><p>使用 <code>@SaCheckOr</code> 表示批量注解鉴权：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 在 `@SaCheckOr` 中可以指定多个注解，只要当前会话满足其中一个注解即可通过验证，进入方法。</span></span><br><span class="line"><span class="meta">@SaCheckOr(</span></span><br><span class="line"><span class="meta">        login = @SaCheckLogin,</span></span><br><span class="line"><span class="meta">        role = @SaCheckRole("admin"),</span></span><br><span class="line"><span class="meta">        permission = @SaCheckPermission("user.add"),</span></span><br><span class="line"><span class="meta">        safe = @SaCheckSafe("update-password"),</span></span><br><span class="line"><span class="meta">        httpBasic = @SaCheckHttpBasic(account = "sa:123456"),</span></span><br><span class="line"><span class="meta">        disable = @SaCheckDisable("submit-orders")</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@RequestMapping("test")</span></span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">test</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">return</span> SaResult.ok(); </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>每一项属性都可以写成数组形式，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 当前客户端只要有 [ login 账号登录] 或者 [user 账号登录] 其一，就可以通过验证进入方法。</span></span><br><span class="line"><span class="comment">//         注意：`type = "login"` 和 `type = "user"` 是多账号模式章节的扩展属性，此处你可以先略过这个知识点。</span></span><br><span class="line"><span class="meta">@SaCheckOr(</span></span><br><span class="line"><span class="meta">    login = { @SaCheckLogin(type = "login"), @SaCheckLogin(type = "user") }</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@RequestMapping("test")</span></span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">test</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">return</span> SaResult.ok(); </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>疑问：既然有了 <code>@SaCheckOr</code>，为什么没有与之对应的 <code>@SaCheckAnd</code> 呢？</p>
<p>因为当你写多个注解时，其天然就是 <code>and</code> 校验关系，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 当你在一个方法上写多个注解鉴权时，其默认就是要满足所有注解规则后，才可以进入方法，只要有一个不满足，就会抛出异常</span></span><br><span class="line"><span class="meta">@SaCheckLogin</span></span><br><span class="line"><span class="meta">@SaCheckRole("admin")</span></span><br><span class="line"><span class="meta">@SaCheckPermission("user.add")</span></span><br><span class="line"><span class="meta">@RequestMapping("test")</span></span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">test</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">return</span> SaResult.ok(); </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="7、扩展阅读"><a href="#7、扩展阅读" class="headerlink" title="7、扩展阅读"></a>7、扩展阅读</h2><ul>
<li>在业务逻辑层使用鉴权注解：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvcGx1Z2luL2FvcC1hdA==">AOP注解鉴权</a></li>
<li>制作自定义鉴权注解注入到框架：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL2N1c3RvbS1hbm5vdGF0aW9ucw==">自定义注解</a></li>
</ul>
<p>[本章代码示例：Sa-Token 注解鉴权 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jYXNlcy91c2UvQXRDaGVja0NvbnRyb2xsZXIuamF2YQ=="> AtCheckController.java ]</a></p>
<hr>
<h1 id="路由拦截鉴权"><a href="#路由拦截鉴权" class="headerlink" title="路由拦截鉴权"></a>路由拦截鉴权</h1><p>假设我们有如下需求：</p>
<blockquote>
<p><strong>🗡 需求场景</strong></p>
<p>项目中的所有接口均需要登录认证，只有<strong>登录接口</strong>本身对外开放。</p>
</blockquote>
<p>我们怎么实现呢？给每个接口加上鉴权注解？手写全局拦截器？似乎都不是非常方便。</p>
<p>在这个需求中我们真正需要的是一种基于路由拦截的鉴权模式，那么在 Sa-Token 怎么实现路由拦截鉴权呢？</p>
<h2 id="1、注册-Sa-Token-路由拦截器"><a href="#1、注册-Sa-Token-路由拦截器" class="headerlink" title="1、注册 Sa-Token 路由拦截器"></a>1、注册 Sa-Token 路由拦截器</h2><p>以 <code>SpringBoot2.0</code> 为例，新建配置类 <code>SaTokenConfigure.java</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> {</span><br><span class="line">    <span class="comment">// 注册拦截器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">        <span class="comment">// 注册 Sa-Token 拦截器，校验规则为 StpUtil.checkLogin() 登录校验。</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handle -&gt; StpUtil.checkLogin()))</span><br><span class="line">                .addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                .excludePathPatterns(<span class="string">"/user/doLogin"</span>); </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>以上代码，我们注册了一个基于 <code>StpUtil.checkLogin()</code> 的登录校验拦截器，并且排除了 <code>/user/doLogin</code> 接口用来开放登录（除了 <code>/user/doLogin</code> 以外的所有接口都需要登录才能访问）。</p>
<blockquote>
<p><strong>⚙ 版本升级</strong></p>
<p><code>SaInterceptor</code> 是新版本提供的拦截器，点此 <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NoZW5nemhhbmdfL2FydGljbGUvZGV0YWlscy8xMjY0NTg5NDk=">查看旧版本代码迁移示例</a>。</p>
</blockquote>
<h2 id="2、校验函数详解"><a href="#2、校验函数详解" class="headerlink" title="2、校验函数详解"></a>2、校验函数详解</h2><p>自定义认证规则：<code>new SaInterceptor(handle -&gt; StpUtil.checkLogin())</code> 是最简单的写法，代表只进行登录校验功能。</p>
<p>我们可以往构造函数塞一个完整的 Lambda 表达式，来定义详细的校验规则，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">        <span class="comment">// 注册 Sa-Token 拦截器，定义详细认证规则 </span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handler -&gt; {</span><br><span class="line">            <span class="comment">// 指定一条 match 规则</span></span><br><span class="line">            SaRouter</span><br><span class="line">                .match(<span class="string">"/**"</span>)    <span class="comment">// 拦截的 path 列表，可以写多个 */</span></span><br><span class="line">                .notMatch(<span class="string">"/user/doLogin"</span>)        <span class="comment">// 排除掉的 path 列表，可以写多个 </span></span><br><span class="line">                .check(r -&gt; StpUtil.checkLogin());        <span class="comment">// 要执行的校验动作，可以写完整的 lambda 表达式</span></span><br><span class="line">                </span><br><span class="line">            <span class="comment">// 根据路由划分模块，不同模块不同鉴权 </span></span><br><span class="line">            SaRouter.match(<span class="string">"/user/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"user"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/admin/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"admin"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/goods/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"goods"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/orders/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"orders"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/notice/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"notice"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/comment/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"comment"</span>));</span><br><span class="line">        })).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>SaRouter.match() 匹配函数有两个参数：</p>
<ul>
<li>参数一：要匹配的 path 路由。</li>
<li>参数二：要执行的校验参数。</li>
</ul>
<p>在校验函数内不只可以使用 <code>StpUtil.checkPermission("xxx")</code> 进行权限校验，你还可以写任意代码，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> {</span><br><span class="line">    <span class="comment">// 注册 Sa-Token 的拦截器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">        <span class="comment">// 注册路由拦截器，自定义认证规则 </span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handler -&gt; {</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 登录校验 -- 拦截所有路由，并排除/user/doLogin 用于开放登录 </span></span><br><span class="line">            SaRouter.match(<span class="string">"/**"</span>, <span class="string">"/user/doLogin"</span>, r -&gt; StpUtil.checkLogin());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 角色校验 -- 拦截以 admin 开头的路由，必须具备 admin 角色或者 super-admin 角色才可以通过认证 </span></span><br><span class="line">            SaRouter.match(<span class="string">"/admin/**"</span>, r -&gt; StpUtil.checkRoleOr(<span class="string">"admin"</span>, <span class="string">"super-admin"</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 权限校验 -- 不同模块校验不同权限 </span></span><br><span class="line">            SaRouter.match(<span class="string">"/user/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"user"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/admin/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"admin"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/goods/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"goods"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/orders/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"orders"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/notice/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"notice"</span>));</span><br><span class="line">            SaRouter.match(<span class="string">"/comment/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"comment"</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 甚至你可以随意的写一个打印语句</span></span><br><span class="line">            SaRouter.match(<span class="string">"/**"</span>, r -&gt; System.out.println(<span class="string">"----啦啦啦----"</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 连缀写法</span></span><br><span class="line">            SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"----啦啦啦----"</span>));</span><br><span class="line">            </span><br><span class="line">        })).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="3、匹配特征详解"><a href="#3、匹配特征详解" class="headerlink" title="3、匹配特征详解"></a>3、匹配特征详解</h2><p>除了上述示例的 path 路由匹配，还可以根据很多其它特征进行匹配，以下是所有可匹配的特征：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 基础写法样例：匹配一个path，执行一个校验函数 </span></span><br><span class="line">SaRouter.match(<span class="string">"/user/**"</span>).check(r -&gt; StpUtil.checkLogin());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 path 路由匹配   ——— 支持写多个path，支持写 restful 风格路由 </span></span><br><span class="line"><span class="comment">// 功能说明: 使用 /user , /goods 或者 /art/get 开头的任意路由都将进入 check 方法</span></span><br><span class="line">SaRouter.match(<span class="string">"/user/**"</span>, <span class="string">"/goods/**"</span>, <span class="string">"/art/get/{id}"</span>).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 path 路由排除匹配 </span></span><br><span class="line"><span class="comment">// 功能说明: 使用 .html , .css 或者 .js 结尾的任意路由都将跳过, 不会进入 check 方法</span></span><br><span class="line">SaRouter.match(<span class="string">"/**"</span>).notMatch(<span class="string">"*.html"</span>, <span class="string">"*.css"</span>, <span class="string">"*.js"</span>).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据请求类型匹配 </span></span><br><span class="line">SaRouter.match(SaHttpMethod.GET).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据一个 boolean 条件进行匹配 </span></span><br><span class="line">SaRouter.match( StpUtil.isLogin() ).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据一个返回 boolean 结果的lambda表达式匹配 </span></span><br><span class="line">SaRouter.match( r -&gt; StpUtil.isLogin() ).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个条件一起使用 </span></span><br><span class="line"><span class="comment">// 功能说明: 必须是 Get 请求 并且 请求路径以 `/user/` 开头 </span></span><br><span class="line">SaRouter.match(SaHttpMethod.GET).match(<span class="string">"/user/**"</span>).check( <span class="comment">/* 要执行的校验函数 */</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以无限连缀下去 </span></span><br><span class="line"><span class="comment">// 功能说明: 同时满足 Get 方式请求, 且路由以 /admin 开头, 路由中间带有 /send/ 字符串, 路由结尾不能是 .js 和 .css</span></span><br><span class="line">SaRouter</span><br><span class="line">    .match(SaHttpMethod.GET)</span><br><span class="line">    .match(<span class="string">"/admin/**"</span>)</span><br><span class="line">    .match(<span class="string">"/**/send/**"</span>) </span><br><span class="line">    .notMatch(<span class="string">"/**/*.js"</span>)</span><br><span class="line">    .notMatch(<span class="string">"/**/*.css"</span>)</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    .check( <span class="comment">/* 只有上述所有条件都匹配成功，才会执行最后的check校验函数 */</span> );</span><br></pre></td></tr></tbody></table></figure>



<h2 id="4、提前退出匹配链"><a href="#4、提前退出匹配链" class="headerlink" title="4、提前退出匹配链"></a>4、提前退出匹配链</h2><p>使用 SaRouter.stop() 可以提前退出匹配链，例：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handler -&gt; {</span><br><span class="line">    SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"进入1"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"进入2"</span>)).stop();</span><br><span class="line">    SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"进入3"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"进入4"</span>));</span><br><span class="line">    SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; System.out.println(<span class="string">"进入5"</span>));</span><br><span class="line">})).addPathPatterns(<span class="string">"/**"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>如上示例，代码运行至第2条匹配链时，会在 Stop 函数处提前退出整个匹配函数，从而忽略掉剩余的所有 match 匹配</p>
<p>除了 <code>stop()</code> 函数，<code>SaRouter</code> 还提供了 <code>back()</code> 函数，用于：停止匹配，结束执行，直接向前端返回结果</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 执行back函数后将停止匹配，也不会进入Controller，而是直接将 back参数 作为返回值输出到前端</span></span><br><span class="line">SaRouter.match(<span class="string">"/user/back"</span>).back(<span class="string">"要返回到前端的内容"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>stop() 与 back() 函数的区别在于：</p>
<ul>
<li><code>SaRouter.stop()</code> 会停止匹配，进入 Controller</li>
<li><code>SaRouter.back()</code> 会停止匹配，直接返回结果到前端</li>
</ul>
<h2 id="5、使用-free-打开一个独立的作用域"><a href="#5、使用-free-打开一个独立的作用域" class="headerlink" title="5、使用 free 打开一个独立的作用域"></a>5、使用 free 打开一个独立的作用域</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 进入 free 独立作用域 </span></span><br><span class="line">SaRouter.match(<span class="string">"/**"</span>).free(r -&gt; {</span><br><span class="line">    SaRouter.match(<span class="string">"/a/**"</span>).check(<span class="comment">/* --- */</span>);</span><br><span class="line">    SaRouter.match(<span class="string">"/b/**"</span>).check(<span class="comment">/* --- */</span>).stop();</span><br><span class="line">    SaRouter.match(<span class="string">"/c/**"</span>).check(<span class="comment">/* --- */</span>);</span><br><span class="line">});</span><br><span class="line"><span class="comment">// 执行 stop() 函数跳出 free 后继续执行下面的 match 匹配 </span></span><br><span class="line">SaRouter.match(<span class="string">"/**"</span>).check(<span class="comment">/* --- */</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>free() 的作用是：打开一个独立的作用域，使内部的 stop()  不再一次性跳出整个 Auth 函数，而是仅仅跳出当前 free 作用域。</p>
<h2 id="6、使用注解忽略掉路由拦截校验"><a href="#6、使用注解忽略掉路由拦截校验" class="headerlink" title="6、使用注解忽略掉路由拦截校验"></a>6、使用注解忽略掉路由拦截校验</h2><p>我们可以使用 <code>@SaIgnore</code> 注解，忽略掉路由拦截认证：</p>
<p><strong>1、先配置好拦截规则：</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handler -&gt; {</span><br><span class="line">        <span class="comment">// 根据路由划分模块，不同模块不同鉴权 </span></span><br><span class="line">        SaRouter.match(<span class="string">"/user/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"user"</span>));</span><br><span class="line">        SaRouter.match(<span class="string">"/admin/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"admin"</span>));</span><br><span class="line">        SaRouter.match(<span class="string">"/goods/**"</span>, r -&gt; StpUtil.checkPermission(<span class="string">"goods"</span>));</span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">    })).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2、然后在 Controller 里又添加忽略校验的注解</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SaIgnore</span></span><br><span class="line"><span class="meta">@RequestMapping("/user/getList")</span></span><br><span class="line"><span class="keyword">public</span> SaResult <span class="title function_">getList</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"------------ 访问进来方法"</span>); </span><br><span class="line">    <span class="keyword">return</span> SaResult.ok(); </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>请求将会跳过拦截器的校验，直接进入 Controller 方法中。</p>
<blockquote>
<p><strong>🗡 注意点</strong></p>
<p>注解 <code>@SaIgnore</code> 的忽略效果只针对 SaInterceptor 拦截器 和 AOP 注解鉴权 生效，对自定义拦截器与过滤器不生效。</p>
</blockquote>
<h2 id="7、关闭注解校验"><a href="#7、关闭注解校验" class="headerlink" title="7、关闭注解校验"></a>7、关闭注解校验</h2><p><code>SaInterceptor</code> 只要注册到项目中，默认就会打开注解校验，如果要关闭此能力，需要：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">    registry.addInterceptor(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SaInterceptor</span>(handle -&gt; {</span><br><span class="line">            SaRouter.match(<span class="string">"/**"</span>).check(r -&gt; StpUtil.checkLogin());</span><br><span class="line">        }).isAnnotation(<span class="literal">false</span>)  <span class="comment">// 指定关闭掉注解鉴权能力，这样框架就只会做路由拦截校验了 </span></span><br><span class="line">    ).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>[本章代码示例：Sa-Token 路由拦截鉴权 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9zYXRva2VuL1NhVG9rZW5Db25maWd1cmUuamF2YQ=="> SaTokenConfigure.java ]</a></p>
<hr>
<h1 id="Session-会话"><a href="#Session-会话" class="headerlink" title="Session 会话"></a>Session 会话</h1><h2 id="1、Session-会话是什么？"><a href="#1、Session-会话是什么？" class="headerlink" title="1、Session 会话是什么？"></a>1、Session 会话是什么？</h2><p>Session 是会话中专业的数据缓存组件，通过 Session 我们可以很方便的缓存一些高频读写数据，提高程序性能，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 在登录时缓存 user 对象 </span></span><br><span class="line">StpUtil.getSession().set(<span class="string">"user"</span>, user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后我们就可以在任意处使用这个 user 对象</span></span><br><span class="line"><span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> (SysUser) StpUtil.getSession().get(<span class="string">"user"</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>在 Sa-Token 中，Session 分为三种，分别是：</p>
<ul>
<li><code>Account-Session</code>: 指的是框架为每个 账号id 分配的 Session</li>
<li><code>Token-Session</code>: 指的是框架为每个 token 分配的 Session</li>
<li><code>Custom-Session</code>: 指的是以一个 特定的值 作为SessionId，来分配的 Session</li>
</ul>
<blockquote>
<p>有关 Account-Session 与 Token-Session 的详细区别，可参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Nlc3Npb24tbW9kZWw=">Session模型详解</a></p>
</blockquote>
<h2 id="2、Account-Session"><a href="#2、Account-Session" class="headerlink" title="2、Account-Session"></a>2、Account-Session</h2><p>有关账号 Session 的 API 如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前账号 id 的 Account-Session (必须是登录后才能调用)</span></span><br><span class="line">StpUtil.getSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前账号 id 的 Account-Session, 并决定在 Session 尚未创建时，是否新建并返回</span></span><br><span class="line">StpUtil.getSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取账号 id 为 10001 的 Account-Session</span></span><br><span class="line">StpUtil.getSessionByLoginId(<span class="number">10001</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取账号 id 为 10001 的 Account-Session, 并决定在 Session 尚未创建时，是否新建并返回</span></span><br><span class="line">StpUtil.getSessionByLoginId(<span class="number">10001</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 SessionId 为 xxxx-xxxx 的 Account-Session, 在 Session 尚未创建时, 返回 null </span></span><br><span class="line">StpUtil.getSessionBySessionId(<span class="string">"xxxx-xxxx"</span>);</span><br></pre></td></tr></tbody></table></figure>



<h2 id="3、Token-Session"><a href="#3、Token-Session" class="headerlink" title="3、Token-Session"></a>3、Token-Session</h2><p>有关 令牌-Session 的 API 如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前 Token 的 Token-Session 对象</span></span><br><span class="line">StpUtil.getTokenSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定 Token 的 Token-Session 对象</span></span><br><span class="line">StpUtil.getTokenSessionByToken(token);</span><br></pre></td></tr></tbody></table></figure>



<h2 id="4、Custom-Session"><a href="#4、Custom-Session" class="headerlink" title="4、Custom-Session"></a>4、Custom-Session</h2><p>自定义 Session 指的是一个 <code>特定的值</code> 作为 SessionId 来分配的 <code>Session</code> ，借助自定义 Session ，你可以为系统中的任意元素分配相应的 Session</p>
<p>例如以商品 id 作为 key 为每个商品分配一个 Session ，以便于缓存和商品相关的数据，其相关 API 如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 查询指定key的Session是否存在</span></span><br><span class="line">SaSessionCustomUtil.isExists(<span class="string">"goods-10001"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定key的Session，如果没有，则新建并返回</span></span><br><span class="line">SaSessionCustomUtil.getSessionById(<span class="string">"goods-10001"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取指定key的Session，如果没有，第二个参数决定是否新建并返回  </span></span><br><span class="line">SaSessionCustomUtil.getSessionById(<span class="string">"goods-10001"</span>, <span class="literal">false</span>);   </span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除指定key的Session</span></span><br><span class="line">SaSessionCustomUtil.deleteSessionById(<span class="string">"goods-10001"</span>);</span><br></pre></td></tr></tbody></table></figure>



<h2 id="5、在-Session-上存取值"><a href="#5、在-Session-上存取值" class="headerlink" title="5、在 Session 上存取值"></a>5、在 Session 上存取值</h2><p>以上三种 Session 均为框架设计概念上的区分，实际上在获取它们时，返回的都是 SaSession 对象，你可以使用 API 在 SaSession 对象上存取值：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 写值 </span></span><br><span class="line">session.set(<span class="string">"name"</span>, <span class="string">"zhang"</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 写值 (只有在此key原本无值的时候才会写入)</span></span><br><span class="line">session.setDefaultValue(<span class="string">"name"</span>, <span class="string">"zhang"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值</span></span><br><span class="line">session.get(<span class="string">"name"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值 (指定默认值)</span></span><br><span class="line">session.get(<span class="string">"name"</span>, <span class="string">"&lt;defaultValue&gt;"</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值 (若无值则执行参数方法, 之后将结果保存到此键名下,并返回此结果   若有值则直接返回, 无需执行参数方法)</span></span><br><span class="line">session.get(<span class="string">"name"</span>, () -&gt; {</span><br><span class="line">            <span class="keyword">return</span> ...;</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------- 数据类型转换： ----------</span></span><br><span class="line">session.getInt(<span class="string">"age"</span>);         <span class="comment">// 取值 (转int类型)</span></span><br><span class="line">session.getLong(<span class="string">"age"</span>);        <span class="comment">// 取值 (转long类型)</span></span><br><span class="line">session.getString(<span class="string">"name"</span>);     <span class="comment">// 取值 (转String类型)</span></span><br><span class="line">session.getDouble(<span class="string">"result"</span>);   <span class="comment">// 取值 (转double类型)</span></span><br><span class="line">session.getFloat(<span class="string">"result"</span>);    <span class="comment">// 取值 (转float类型)</span></span><br><span class="line">session.getModel(<span class="string">"key"</span>, Student.class);     <span class="comment">// 取值 (指定转换类型)</span></span><br><span class="line">session.getModel(<span class="string">"key"</span>, Student.class, &lt;defaultValue&gt;);  <span class="comment">// 取值 (指定转换类型, 并指定值为Null时返回的默认值)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否含有某个key (返回 true 或 false)</span></span><br><span class="line">session.has(<span class="string">"key"</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 删值 </span></span><br><span class="line">session.delete(<span class="string">'name'</span>);          </span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空所有值 </span></span><br><span class="line">session.clear();                 </span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取此 Session 的所有key (返回Set&lt;String&gt;)</span></span><br><span class="line">session.keys();      </span><br></pre></td></tr></tbody></table></figure>



<h2 id="6、其他操作"><a href="#6、其他操作" class="headerlink" title="6、其他操作"></a>6、其他操作</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 返回此 Session 的id </span></span><br><span class="line">session.getId();                          </span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回此 Session 的创建时间 (时间戳) </span></span><br><span class="line">session.getCreateTime();                  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回此 Session 会话上的底层数据对象（如果更新map里的值，请调用session.update()方法避免产生脏数据）</span></span><br><span class="line">session.getDataMap();                     </span><br><span class="line"></span><br><span class="line"><span class="comment">// 将这个 Session 从持久库更新一下</span></span><br><span class="line">session.update();                         </span><br><span class="line"></span><br><span class="line"><span class="comment">// 注销此 Session 会话 (从持久库删除此Session)</span></span><br><span class="line">session.logout();                         </span><br></pre></td></tr></tbody></table></figure>



<h2 id="7、避免与-HttpSession-混淆使用"><a href="#7、避免与-HttpSession-混淆使用" class="headerlink" title="7、避免与 HttpSession 混淆使用"></a>7、避免与 HttpSession 混淆使用</h2><p>经常有同学会把 <code>SaSession</code> 与 <code>HttpSession</code> 进行混淆，例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping("/resetPoints")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">(HttpSession session)</span> {</span><br><span class="line">    <span class="comment">// 在 HttpSession 上写入一个值 </span></span><br><span class="line">    session.setAttribute(<span class="string">"name"</span>, <span class="number">66</span>);</span><br><span class="line">    <span class="comment">// 在 SaSession 进行取值</span></span><br><span class="line">    System.out.println(StpUtil.getSession().get(<span class="string">"name"</span>));    <span class="comment">// 输出null</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>要点：</strong></p>
<ol>
<li><code>SaSession</code> 与 <code>HttpSession</code> 没有任何关系，在 <code>HttpSession</code> 上写入的值，在 <code>SaSession</code> 中无法取出</li>
<li><code>HttpSession</code> 并未被框架接管，在使用 <code>Sa-Token</code> 时，请在任何情况下均使用 <code>SaSession</code> ，不要使用 <code>HttpSession</code></li>
</ol>
<h2 id="8、未登录场景下获取-Token-Session"><a href="#8、未登录场景下获取-Token-Session" class="headerlink" title="8、未登录场景下获取 Token-Session"></a>8、未登录场景下获取 Token-Session</h2><p>默认场景下，只有登录后才能通过 <code>StpUtil.getTokenSession()</code> 获取 <code>Token-Session</code>。</p>
<p>如果想要在未登录场景下获取 Token-Session ，有两种方法：</p>
<ul>
<li>方法一：将全局配置项 <code>tokenSessionCheckLogin</code> 改为 false，详见：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXNlL2NvbmZpZz9pZD0lRTYlODklODAlRTYlOUMlODklRTUlOEYlQUYlRTklODUlOEQlRTclQkQlQUUlRTklQTElQjk=">框架配置</a></li>
<li>方法二：使用匿名 Token-Session</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前 Token 的匿名 Token-Session （可在未登录情况下使用的 Token-Session）</span></span><br><span class="line">StpUtil.getAnonTokenSession();</span><br></pre></td></tr></tbody></table></figure>

<p>注意点：如果前端没有提交 Token ，或者提交的 Token 是一个无效 Token 的话，框架将不会根据此 Token 创建 <code>Token-Session</code> 对象， 而是随机一个新的 Token 值来创建 <code>Token-Session</code> 对象，此 Token 值可以通过 <code>StpUtil.getTokenValue()</code> 获取到。</p>
<p>[本章代码示例：Sa-Token Session 会话 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9qYXZhL2NvbS9wai9jYXNlcy91c2UvU2FTZXNzaW9uQ29udHJvbGxlci5qYXZh"> SaSessionController.java ]</a></p>
<hr>
<h1 id="框架配置"><a href="#框架配置" class="headerlink" title="框架配置"></a>框架配置</h1><p>你可以<strong>零配置启动框架</strong>，但同时你也可以通过一定的参数配置，定制性使用框架，Sa-Token 支持多种方式配置框架信息</p>
<h2 id="1、配置方式"><a href="#1、配置方式" class="headerlink" title="1、配置方式"></a>1、配置方式</h2><p><strong>方式 1、在 application.yml 或 application.properties 配置</strong></p>
<p><code>yaml</code> 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">############## Sa-Token 配置 (文档: https://sa-token.cc) ##############</span></span><br><span class="line"><span class="attr">sa-token</span>: <span class="string"></span></span><br><span class="line"><span class="comment">    # token 名称（同时也是 cookie 名称）</span></span><br><span class="line">    <span class="attr">token-name</span>: <span class="string">satoken</span></span><br><span class="line"><span class="comment">    # token 有效期（单位：秒） 默认30天，-1 代表永久有效</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="string">2592000</span></span><br><span class="line"><span class="comment">    # token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结</span></span><br><span class="line">    <span class="attr">active-timeout</span>: <span class="string">-1</span></span><br><span class="line"><span class="comment">    # 是否允许同一账号多地同时登录 （为 true 时允许一起登录, 为 false 时新登录挤掉旧登录）</span></span><br><span class="line">    <span class="attr">is-concurrent</span>: <span class="string">true</span></span><br><span class="line"><span class="comment">    # 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token, 为 false 时每次登录新建一个 token）</span></span><br><span class="line">    <span class="attr">is-share</span>: <span class="string">true</span></span><br><span class="line"><span class="comment">    # token 风格（默认可取值：uuid、simple-uuid、random-32、random-64、random-128、tik）</span></span><br><span class="line">    <span class="attr">token-style</span>: <span class="string">uuid</span></span><br><span class="line"><span class="comment">    # 是否输出操作日志 </span></span><br><span class="line">    <span class="attr">is-log</span>: <span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>properties</code> 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">############## Sa-Token 配置 (文档: https://sa-token.cc) ##############</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># token 名称（同时也是 cookie 名称）</span></span><br><span class="line"><span class="attr">sa-token.token-name</span>=<span class="string">satoken</span></span><br><span class="line"><span class="comment"># token 有效期（单位：秒） 默认30天，-1 代表永久有效</span></span><br><span class="line"><span class="attr">sa-token.timeout</span>=<span class="string">2592000</span></span><br><span class="line"><span class="comment"># token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结</span></span><br><span class="line"><span class="attr">sa-token.active-timeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="comment"># 是否允许同一账号多地同时登录 （为 true 时允许一起登录, 为 false 时新登录挤掉旧登录）</span></span><br><span class="line"><span class="attr">sa-token.is-concurrent</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token, 为 false 时每次登录新建一个 token）</span></span><br><span class="line"><span class="attr">sa-token.is-share</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># token 风格（默认可取值：uuid、simple-uuid、random-32、random-64、random-128、tik）</span></span><br><span class="line"><span class="attr">sa-token.token-style</span>=<span class="string">uuid</span></span><br><span class="line"><span class="comment"># 是否输出操作日志 </span></span><br><span class="line"><span class="attr">sa-token.is-log</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>



<p><strong>方式 2、通过代码配置</strong></p>
<p>模式 1 ：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sa-Token 配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> {</span><br><span class="line">    <span class="comment">// Sa-Token 参数配置，参考文档：https://sa-token.cc</span></span><br><span class="line">    <span class="comment">// 此配置会覆盖 application.yml 中的配置</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> SaTokenConfig <span class="title function_">getSaTokenConfigPrimary</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">SaTokenConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SaTokenConfig</span>();</span><br><span class="line">        config.setTokenName(<span class="string">"satoken"</span>);             <span class="comment">// token 名称（同时也是 cookie 名称）</span></span><br><span class="line">        config.setTimeout(<span class="number">30</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);       <span class="comment">// token 有效期（单位：秒），默认30天，-1代表永不过期 </span></span><br><span class="line">        config.setActiveTimeout(-<span class="number">1</span>);              <span class="comment">// token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结</span></span><br><span class="line">        config.setIsConcurrent(<span class="literal">true</span>);               <span class="comment">// 是否允许同一账号多地同时登录（为 true 时允许一起登录，为 false 时新登录挤掉旧登录）</span></span><br><span class="line">        config.setIsShare(<span class="literal">true</span>);                    <span class="comment">// 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token，为 false 时每次登录新建一个 token）</span></span><br><span class="line">        config.setTokenStyle(<span class="string">"uuid"</span>);               <span class="comment">// token 风格</span></span><br><span class="line">        config.setIsLog(<span class="literal">false</span>);                     <span class="comment">// 是否输出操作日志 </span></span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>模式 2 ：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sa-Token 配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaTokenConfigure</span> {</span><br><span class="line">    <span class="comment">// Sa-Token 参数配置，参考文档：https://sa-token.cc</span></span><br><span class="line">    <span class="comment">// 此配置会与 application.yml 中的配置合并 （代码配置优先）</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configSaToken</span><span class="params">(SaTokenConfig config)</span> {</span><br><span class="line">        config.setTokenName(<span class="string">"satoken"</span>);             <span class="comment">// token 名称（同时也是 cookie 名称）</span></span><br><span class="line">        config.setTimeout(<span class="number">30</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span>);       <span class="comment">// token 有效期（单位：秒），默认30天，-1代表永不过期 </span></span><br><span class="line">        config.setActiveTimeout(-<span class="number">1</span>);              <span class="comment">// token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结</span></span><br><span class="line">        config.setIsConcurrent(<span class="literal">true</span>);               <span class="comment">// 是否允许同一账号多地同时登录（为 true 时允许一起登录，为 false 时新登录挤掉旧登录）</span></span><br><span class="line">        config.setIsShare(<span class="literal">true</span>);                    <span class="comment">// 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token，为 false 时每次登录新建一个 token）</span></span><br><span class="line">        config.setTokenStyle(<span class="string">"uuid"</span>);               <span class="comment">// token 风格</span></span><br><span class="line">        config.setIsLog(<span class="literal">false</span>);                     <span class="comment">// 是否输出操作日志 </span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>两者的区别在于：</p>
<ul>
<li>模式 1 会覆盖 application.yml 中的配置</li>
<li>模式 2 会与 application.yml 中的配置合并（代码配置优先）</li>
</ul>
<h2 id="2、核心包所有可配置项"><a href="#2、核心包所有可配置项" class="headerlink" title="2、核心包所有可配置项"></a>2、核心包所有可配置项</h2><p><strong>你不必立刻掌握整个表格，只需要在用到某个功能时再详细查阅它即可</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>tokenName</td>
<td>String</td>
<td>satoken</td>
<td>Token 名称 （同时也是 Cookie 名称、数据持久化前缀）</td>
</tr>
<tr>
<td>timeout</td>
<td>long</td>
<td>2592000</td>
<td>Token 有效期（单位：秒），默认30天，-1代表永不过期 <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Rva2VuLXRpbWVvdXQ=">参考：token有效期详解</a></td>
</tr>
<tr>
<td>activeTimeout</td>
<td>long</td>
<td>-1</td>
<td>Token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结（例如可以设置为1800代表30分钟内无操作就冻结） <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Rva2VuLXRpbWVvdXQ=">参考：token有效期详解</a></td>
</tr>
<tr>
<td>dynamicActiveTimeout</td>
<td>Boolean</td>
<td>false</td>
<td>是否启用动态 activeTimeout 功能，如不需要请设置为 false，节省缓存请求次数</td>
</tr>
<tr>
<td>isConcurrent</td>
<td>Boolean</td>
<td>true</td>
<td>是否允许同一账号并发登录 （为 true 时允许一起登录，为 false 时新登录挤掉旧登录）</td>
</tr>
<tr>
<td>isShare</td>
<td>Boolean</td>
<td>true</td>
<td>在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token，为 false 时每次登录新建一个 token，login 时提供了 Extra 数据后，即使配置了为 true 也不能复用旧 Token，必须创建新 Token）</td>
</tr>
<tr>
<td>maxLoginCount</td>
<td>int</td>
<td>12</td>
<td>同一账号最大登录数量，-1代表不限 （只有在 <code>isConcurrent=true</code>，<code>isShare=false</code> 时此配置才有效），<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXNlL2NvbmZpZz9pZD0lRTklODUlOEQlRTclQkQlQUUlRTklQTElQjklRTglQUYlQTYlRTglQTclQTMlRUYlQkMlOUFtYXhsb2dpbmNvdW50">详解</a></td>
</tr>
<tr>
<td>maxTryTimes</td>
<td>int</td>
<td>12</td>
<td>在每次创建 Token 时的最高循环次数，用于保证 Token 唯一性（-1=不循环重试，直接使用）</td>
</tr>
<tr>
<td>isReadBody</td>
<td>Boolean</td>
<td>true</td>
<td>是否尝试从 请求体 里读取 Token</td>
</tr>
<tr>
<td>isReadHeader</td>
<td>Boolean</td>
<td>true</td>
<td>是否尝试从 header 里读取 Token</td>
</tr>
<tr>
<td>isReadCookie</td>
<td>Boolean</td>
<td>true</td>
<td>是否尝试从 cookie 里读取 Token，此值为 false 后，<code>StpUtil.login(id)</code> 登录时也不会再往前端注入Cookie</td>
</tr>
<tr>
<td>isWriteHeader</td>
<td>Boolean</td>
<td>false</td>
<td>是否在登录后将 Token 写入到响应头</td>
</tr>
<tr>
<td>tokenStyle</td>
<td>String</td>
<td>uuid</td>
<td>token风格， <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXAvdG9rZW4tc3R5bGU=">参考：自定义Token风格</a></td>
</tr>
<tr>
<td>dataRefreshPeriod</td>
<td>int</td>
<td>30</td>
<td>默认数据持久组件实现类中，每次清理过期数据间隔的时间 （单位: 秒） ，默认值30秒，设置为-1代表不启动定时清理</td>
</tr>
<tr>
<td>tokenSessionCheckLogin</td>
<td>Boolean</td>
<td>true</td>
<td>获取 <code>Token-Session</code> 时是否必须登录 （如果配置为true，会在每次获取 <code>Token-Session</code> 时校验是否登录），<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXNlL2NvbmZpZz9pZD0lRTklODUlOEQlRTclQkQlQUUlRTklQTElQjklRTglQUYlQTYlRTglQTclQTMlRUYlQkMlOUF0b2tlbnNlc3Npb25jaGVja2xvZ2lu">详解</a></td>
</tr>
<tr>
<td>autoRenew</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开自动续签 （如果此值为true，框架会在每次直接或间接调用 <code>getLoginId()</code> 时进行一次过期检查与续签操作），<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Rva2VuLXRpbWVvdXQ=">参考：token有效期详解</a></td>
</tr>
<tr>
<td>tokenPrefix</td>
<td>String</td>
<td>null</td>
<td>token前缀，例如填写 <code>Bearer</code> 实际传参 <code>satoken: Bearer xxxx-xxxx-xxxx-xxxx</code> <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXAvdG9rZW4tcHJlZml4">参考：自定义Token前缀</a></td>
</tr>
<tr>
<td>isPrint</td>
<td>Boolean</td>
<td>true</td>
<td>是否在初始化配置时打印版本字符画</td>
</tr>
<tr>
<td>isLog</td>
<td>Boolean</td>
<td>false</td>
<td>是否打印操作日志</td>
</tr>
<tr>
<td>logLevel</td>
<td>String</td>
<td>trace</td>
<td>日志等级（trace、debug、info、warn、error、fatal），此值与 logLevelInt 联动</td>
</tr>
<tr>
<td>logLevelInt</td>
<td>int</td>
<td>1</td>
<td>日志等级 int 值（1=trace、2=debug、3=info、4=warn、5=error、6=fatal），此值与 logLevel 联动</td>
</tr>
<tr>
<td>isColorLog</td>
<td>Boolean</td>
<td>null</td>
<td>是否打印彩色日志，true=打印彩色日志，false=打印黑白日志，null=框架根据运行终端自行判断是否打印彩色日志</td>
</tr>
<tr>
<td>jwtSecretKey</td>
<td>String</td>
<td>null</td>
<td>jwt秘钥 （只有集成 <code>sa-token-temp-jwt</code> 模块时此参数才会生效），<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvcGx1Z2luL2p3dC1leHRlbmQ=">参考：和 jwt 集成</a></td>
</tr>
<tr>
<td>sameTokenTimeout</td>
<td>long</td>
<td>86400</td>
<td>Same-Token的有效期 （单位: 秒），<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvbWljcm8vc2FtZS10b2tlbg==">参考：内部服务外网隔离</a></td>
</tr>
<tr>
<td>basic</td>
<td>String</td>
<td>“”</td>
<td>Http Basic 认证的账号和密码 <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXAvYmFzaWMtYXV0aA==">参考：Http Basic 认证</a></td>
</tr>
<tr>
<td>currDomain</td>
<td>String</td>
<td>null</td>
<td>配置当前项目的网络访问地址</td>
</tr>
<tr>
<td>checkSameToken</td>
<td>Boolean</td>
<td>false</td>
<td>是否校验Same-Token（部分rpc插件有效）</td>
</tr>
<tr>
<td>cookie</td>
<td>Object</td>
<td>new SaCookieConfig()</td>
<td>Cookie 配置对象</td>
</tr>
<tr>
<td>sign</td>
<td>Object</td>
<td>new SaSignConfig()</td>
<td>API 签名配置对象</td>
</tr>
</tbody></table>
<p>Cookie相关配置：</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>domain</td>
<td>String</td>
<td>null</td>
<td>作用域（写入Cookie时显式指定的作用域, 常用于单点登录二级域名共享Cookie的场景）</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>/</td>
<td>路径，默认写在域名根路径下</td>
</tr>
<tr>
<td>secure</td>
<td>Boolean</td>
<td>false</td>
<td>是否只在 https 协议下有效</td>
</tr>
<tr>
<td>httpOnly</td>
<td>Boolean</td>
<td>false</td>
<td>是否禁止 js 操作 Cookie</td>
</tr>
<tr>
<td>sameSite</td>
<td>String</td>
<td>Lax</td>
<td>第三方限制级别（Strict=完全禁止，Lax=部分允许，None=不限制）</td>
</tr>
</tbody></table>
<p>Cookie 配置示例：</p>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="comment"># Cookie 相关配置 </span></span><br><span class="line">    <span class="attr">cookie:</span> </span><br><span class="line">        <span class="attr">domain:</span> <span class="string">stp.com</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">secure:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">httpOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">sameSite:</span> <span class="string">Lax</span></span><br></pre></td></tr></tbody></table></figure>

<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Cookie 相关配置 </span></span><br><span class="line"><span class="attr">sa-token.cookie.domain</span>=<span class="string">stp.com</span></span><br><span class="line"><span class="attr">sa-token.cookie.path</span>=<span class="string">/</span></span><br><span class="line"><span class="attr">sa-token.cookie.secure</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">sa-token.cookie.httpOnly</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">sa-token.cookie.sameSite</span>=<span class="string">Lax</span></span><br></pre></td></tr></tbody></table></figure>



<p>Sign 参数签名相关配置：</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>secretKey</td>
<td>String</td>
<td>null</td>
<td>API 调用签名秘钥</td>
</tr>
<tr>
<td>timestampDisparity</td>
<td>long</td>
<td>900000</td>
<td>接口调用时的时间戳允许的差距（单位：ms），-1 代表不校验差距，默认15分钟</td>
</tr>
</tbody></table>
<p>示例：</p>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="comment"># 参数签名配置 </span></span><br><span class="line">    <span class="attr">sign:</span> </span><br><span class="line">        <span class="comment"># API 接口调用签名秘钥</span></span><br><span class="line">        <span class="attr">secret-key:</span> <span class="string">kQwIOrYvnXmSDkwEiFngrKidMcdrgKor</span></span><br></pre></td></tr></tbody></table></figure>



<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># API 接口调用签名秘钥</span></span><br><span class="line"><span class="attr">sa-token.sign.secret-key</span>=<span class="string">kQwIOrYvnXmSDkwEiFngrKidMcdrgKor</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="3、单点登录相关配置"><a href="#3、单点登录相关配置" class="headerlink" title="3、单点登录相关配置"></a>3、单点登录相关配置</h2><p><strong>SSO-Server 端配置：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>String</td>
<td></td>
<td>指定当前系统集成 SSO 时使用的模式（约定型配置项，不对代码逻辑产生任何影响）</td>
</tr>
<tr>
<td>ticketTimeout</td>
<td>long</td>
<td>300</td>
<td>ticket 有效期 （单位: 秒）</td>
</tr>
<tr>
<td>allowUrl</td>
<td>String</td>
<td>*</td>
<td>所有允许的授权回调地址，多个用逗号隔开（不在此列表中的URL将禁止下放ticket），参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvc3NvL3Nzby1jaGVjay1kb21haW4=">SSO整合：配置域名校验</a></td>
</tr>
<tr>
<td>homeRoute</td>
<td>String</td>
<td></td>
<td>主页路由：在 /sso/auth 登录后不指定 redirect 参数的情况下默认跳转的路由</td>
</tr>
<tr>
<td>isSlo</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开单点注销功能</td>
</tr>
<tr>
<td>isHttp</td>
<td>Boolean</td>
<td>false</td>
<td>是否打开模式三（此值为 true 时将使用 http 请求：校验 ticket 值、单点注销、获取 userinfo），参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXNlL2NvbmZpZz9pZD0lRTklODUlOEQlRTclQkQlQUUlRTklQTElQjklRTglQUYlQTYlRTglQTclQTMlRUYlQkMlOUFpc2h0dHA=">详解</a></td>
</tr>
<tr>
<td>autoRenewTimeout</td>
<td>Bolean</td>
<td>false</td>
<td>是否在每次下发 ticket 时，自动续期 token 的有效期（根据全局 timeout 值）</td>
</tr>
<tr>
<td>maxRegClient</td>
<td>int</td>
<td>32</td>
<td>在 Access-Session 上记录 Client 信息的最高数量（-1=无限），超过此值将进行自动清退处理，先进先出</td>
</tr>
<tr>
<td>isCheckSign</td>
<td>Boolean</td>
<td>true</td>
<td>是否校验参数签名（方便本地调试用的一个配置项，生产环境请务必为true）</td>
</tr>
</tbody></table>
<p>配置示例：</p>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span></span><br><span class="line">    <span class="comment"># SSO 单点登录服务端配置 </span></span><br><span class="line">    <span class="attr">sso-server:</span></span><br><span class="line">        <span class="comment"># Ticket有效期 (单位: 秒)，默认五分钟 </span></span><br><span class="line">        <span class="attr">ticket-timeout:</span> <span class="number">300</span></span><br><span class="line">        <span class="comment"># 所有允许的授权回调地址</span></span><br><span class="line">        <span class="attr">allow-url:</span> <span class="string">"*"</span></span><br></pre></td></tr></tbody></table></figure>

<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Ticket有效期 (单位: 秒)，默认五分钟 </span></span><br><span class="line"><span class="attr">sa-token.sso-server.ticket-timeout</span>=<span class="string">300</span></span><br><span class="line"><span class="comment"># 所有允许的授权回调地址</span></span><br><span class="line"><span class="attr">sa-token.sso-server.allow-url</span>=<span class="string">"*"</span></span><br></pre></td></tr></tbody></table></figure>



<p><strong>SSO-Client 端配置：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>mode</td>
<td>String</td>
<td></td>
<td>指定当前系统集成 SSO 时使用的模式（约定型配置项，不对代码逻辑产生任何影响）</td>
</tr>
<tr>
<td>client</td>
<td>String</td>
<td>“”</td>
<td>当前 Client 名称标识，用于和 ticket 码的互相锁定</td>
</tr>
<tr>
<td>serverUrl</td>
<td>String</td>
<td>null</td>
<td>配置 Server 端主机总地址，拼接在 <code>authUrl</code>、<code>checkTicketUrl</code>、<code>userinfoUrl</code>、<code>sloUrl</code> 属性前面，用以简化各种 url 配置，参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvc3NvL3Nzby1xdWVzdGlvbnM/aWQ9JUU5JTk3JUFFJUVGJUJDJTlBJUU2JUE4JUExJUU1JUJDJThGJUU0JUI4JTg5JUU5JTg1JThEJUU3JUJEJUFFJUU0JUI4JTgwJUU1JUEwJTg2LXh4eC11cmwtJUVGJUJDJThDJUU2JTlDJTg5JUU1JThBJTlFJUU2JUIzJTk1JUU3JUFFJTgwJUU1JThDJTk2JUU0JUI4JTgwJUU0JUI4JThCJUU1JTkwJTk3JUVGJUJDJTlG">详解</a></td>
</tr>
<tr>
<td>authUrl</td>
<td>String</td>
<td>/sso/auth</td>
<td>配置 Server 端单点登录授权地址</td>
</tr>
<tr>
<td>checkTicketUrl</td>
<td>String</td>
<td>/sso/checkTicket</td>
<td>配置 Server 端的 <code>ticket</code> 校验地址</td>
</tr>
<tr>
<td>getDataUrl</td>
<td>String</td>
<td>/sso/getData</td>
<td>配置 Server 端的 拉取数据 地址</td>
</tr>
<tr>
<td>sloUrl</td>
<td>String</td>
<td>/sso/signout</td>
<td>配置 Server 端单点注销地址</td>
</tr>
<tr>
<td>currSsoLogin</td>
<td>String</td>
<td>null</td>
<td>配置当前 Client 端的登录地址（为空时自动获取）</td>
</tr>
<tr>
<td>currSsoLogoutCall</td>
<td>String</td>
<td>null</td>
<td>配置当前 Client 端的单点注销回调URL （为空时自动获取）</td>
</tr>
<tr>
<td>isSlo</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开单点注销功能</td>
</tr>
<tr>
<td>isHttp</td>
<td>Boolean</td>
<td>false</td>
<td>是否打开模式三（此值为 true 时将使用 http 请求：校验 ticket 值、单点注销、拉取数据getData），参考：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvdXNlL2NvbmZpZz9pZD0lRTklODUlOEQlRTclQkQlQUUlRTklQTElQjklRTglQUYlQTYlRTglQTclQTMlRUYlQkMlOUFpc2h0dHA=">详解</a></td>
</tr>
<tr>
<td>isCheckSign</td>
<td>Boolean</td>
<td>true</td>
<td>是否校验参数签名（方便本地调试用的一个配置项，生产环境请务必为true）</td>
</tr>
</tbody></table>
<p>配置示例：</p>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="comment"># SSO-相关配置</span></span><br><span class="line">    <span class="attr">sso-client:</span> </span><br><span class="line">        <span class="comment"># sso-server 端主机地址</span></span><br><span class="line">        <span class="attr">server-url:</span> <span class="string">http://sa-sso-server.com:9000</span></span><br><span class="line">        <span class="comment"># 是否打开单点注销功能 </span></span><br><span class="line">        <span class="attr">is-slo:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># sso-server 端主机地址</span></span><br><span class="line"><span class="attr">sa-token.sso-client.server-url</span>=<span class="string">http://sa-sso-server.com:9000</span></span><br><span class="line"><span class="comment"># 是否打开单点注销功能 </span></span><br><span class="line"><span class="attr">sa-token.sso-client.is-slo</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="4、OAuth2-0相关配置"><a href="#4、OAuth2-0相关配置" class="headerlink" title="4、OAuth2.0相关配置"></a>4、OAuth2.0相关配置</h2><table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>enableAuthorizationCode</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开模式：授权码（<code>Authorization Code</code>）</td>
</tr>
<tr>
<td>enableImplicit</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开模式：隐藏式（<code>Implicit</code>）</td>
</tr>
<tr>
<td>enablePassword</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开模式：密码式（<code>Password</code>）</td>
</tr>
<tr>
<td>enableClientCredentials</td>
<td>Boolean</td>
<td>true</td>
<td>是否打开模式：凭证式（<code>Client Credentials</code>）</td>
</tr>
<tr>
<td>isNewRefresh</td>
<td>Boolean</td>
<td>false</td>
<td>是否在每次 <code>Refresh-Token</code> 刷新 <code>Access-Token</code> 时，产生一个新的 <code>Refresh-Token</code></td>
</tr>
<tr>
<td>codeTimeout</td>
<td>long</td>
<td>300</td>
<td>Code授权码 保存的时间（单位：秒） 默认五分钟</td>
</tr>
<tr>
<td>accessTokenTimeout</td>
<td>long</td>
<td>7200</td>
<td><code>Access-Token</code> 保存的时间（单位：秒）默认两个小时</td>
</tr>
<tr>
<td>refreshTokenTimeout</td>
<td>long</td>
<td>2592000</td>
<td><code>Refresh-Token</code> 保存的时间（单位：秒） 默认30 天</td>
</tr>
<tr>
<td>clientTokenTimeout</td>
<td>long</td>
<td>7200</td>
<td><code>Client-Token</code> 保存的时间（单位：秒） 默认两个小时</td>
</tr>
<tr>
<td>lowerClientTokenTimeout</td>
<td>long</td>
<td>7200</td>
<td><code>Lower-Client-Token</code> 保存的时间（单位：秒） ，默认为-1，代表延续 <code>Client-Token</code> 的有效时间</td>
</tr>
<tr>
<td>openidDigestPrefix</td>
<td>String</td>
<td>openid_default_digest_prefix</td>
<td>默认 openid 生成算法中使用的摘要前缀</td>
</tr>
<tr>
<td>higherScope</td>
<td>String</td>
<td></td>
<td>指定高级权限，多个用逗号隔开</td>
</tr>
<tr>
<td>lowerScope</td>
<td>String</td>
<td></td>
<td>指定低级权限，多个用逗号隔开</td>
</tr>
<tr>
<td>mode4ReturnAccessToken</td>
<td>Boolean</td>
<td>false</td>
<td>模式4是否返回 AccessToken 字段，用于兼容OAuth2标准协议</td>
</tr>
<tr>
<td>hideStatusField</td>
<td>Boolean</td>
<td>false</td>
<td>是否在返回值中隐藏默认的状态字段 (code、msg、data)</td>
</tr>
<tr>
<td>oidc</td>
<td>SaOAuth2OidcConfig</td>
<td>new SaOAuth2OidcConfig()</td>
<td>OIDC 相关配置</td>
</tr>
</tbody></table>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="attr">token-name:</span> <span class="string">sa-token-oauth2-server</span></span><br><span class="line">    <span class="comment"># OAuth2.0 配置 </span></span><br><span class="line">    <span class="attr">oauth2-server:</span> </span><br><span class="line">        <span class="attr">enable-authorization-code:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">enable-implicit:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">enable-password:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">enable-client-credentials:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure>

<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置 </span></span><br><span class="line"><span class="attr">sa-token.token-name</span>=<span class="string">sa-token-oauth2-server</span></span><br><span class="line"><span class="comment"># OAuth2.0 配置 </span></span><br><span class="line"><span class="attr">sa-token.oauth2-server.enable-authorization-code</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">sa-token.oauth2-server.enable-implicit</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">sa-token.oauth2-server.enable-password</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">sa-token.oauth2-server.enable-client-credentials</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure>



<p><strong>OIDC 相关配置</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>iss</td>
<td>String</td>
<td></td>
<td>iss 值，如不配置则自动计算</td>
</tr>
<tr>
<td>idTokenTimeout</td>
<td>long</td>
<td>600</td>
<td>idToken 有效期（单位秒） 默认十分钟</td>
</tr>
</tbody></table>
<p>yaml 风格</p>
<figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Sa-Token 配置</span></span><br><span class="line"><span class="attr">sa-token:</span> </span><br><span class="line">    <span class="attr">oauth2-server:</span> </span><br><span class="line">        <span class="attr">oidc:</span> </span><br><span class="line">            <span class="attr">iss:</span> <span class="string">xxx</span></span><br><span class="line">            <span class="attr">idTokenTimeout:</span> <span class="number">600</span></span><br></pre></td></tr></tbody></table></figure>

<p>properties 风格</p>
<figure class="highlight properties"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">sa-token.oauth2-server.oidc.iss</span>=<span class="string">xxx</span></span><br><span class="line"><span class="attr">sa-token.oauth2-server.oidc.idTokenTimeout</span>=<span class="string">600</span></span><br></pre></td></tr></tbody></table></figure>



<p><strong>SaClientModel 属性定义</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>类型</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>clientId</td>
<td>String</td>
<td>null</td>
<td>应用id，应该全局唯一</td>
</tr>
<tr>
<td>clientSecret</td>
<td>String</td>
<td>null</td>
<td>应用秘钥</td>
</tr>
<tr>
<td>contractScopes</td>
<td>List</td>
<td>null</td>
<td>应用签约的所有权限</td>
</tr>
<tr>
<td>allowRedirectUris</td>
<td>List</td>
<td>null</td>
<td>应用允许授权的所有URL（可以使用 <code>*</code> 号通配符）</td>
</tr>
<tr>
<td>allowGrantTypes</td>
<td>List</td>
<td>new ArrayList&lt;&gt;()</td>
<td>应用允许的所有 <code>grant_type</code></td>
</tr>
<tr>
<td>isNewRefresh</td>
<td>Boolean</td>
<td>取全局配置</td>
<td>单独配置此Client：是否在每次 <code>Refresh-Token</code> 刷新 <code>Access-Token</code> 时，产生一个新的 Refresh-Token [ 默认取全局配置 ]</td>
</tr>
<tr>
<td>accessTokenTimeout</td>
<td>long</td>
<td>取全局配置</td>
<td>单独配置此Client：<code>Access-Token</code> 保存的时间（单位：秒） [默认取全局配置]</td>
</tr>
<tr>
<td>refreshTokenTimeout</td>
<td>long</td>
<td>取全局配置</td>
<td>单独配置此Client：<code>Refresh-Token</code> 保存的时间（单位：秒） [默认取全局配置]</td>
</tr>
<tr>
<td>clientTokenTimeout</td>
<td>long</td>
<td>取全局配置</td>
<td>单独配置此Client：<code>Client-Token</code> 保存的时间（单位：秒） [默认取全局配置]</td>
</tr>
<tr>
<td>lowerClientTokenTimeout</td>
<td>long</td>
<td>取全局配置</td>
<td>单独配置此Client：<code>Lower-Client-Token</code> 保存的时间（单位：秒） [默认取全局配置]</td>
</tr>
</tbody></table>
<h2 id="5、部分配置项详解"><a href="#5、部分配置项详解" class="headerlink" title="5、部分配置项详解"></a>5、部分配置项详解</h2><p>对部分配置项做一下详解</p>
<p><strong>配置项详解：maxLoginCount</strong></p>
<p>配置含义：同一账号最大登录数量。</p>
<p>在配置 <code>isConcurrent=true</code>, <code>isShare=false</code> 时，Sa-Token 将允许同一账号并发登录，且每次登录都会产生一个新Token， 这些 Token 都会以 <code>TokenSign</code> 的形式记录在其 <code>Account-Session</code> 之上，这就造成一个问题：</p>
<p>随着同一账号登录的次数越来越多，TokenSign 的列表也会越来越大，极端情况下，列表长度可能达到成百上千以上，严重拖慢数据处理速度， 为此 Sa-Token 对这个 TokenSign 列表的大小设定一个上限值，也就是 <code>maxLoginCount</code>，默认值=12。</p>
<p>假设一个账号的登录数量超过 <code>maxLoginCount</code> 后，将会主动注销第一个登录的会话（先进先出），以此保证队列中的有效会话数量始终 <code>&lt;= maxLoginCount</code> 值。</p>
<p><strong>配置项详解：tokenSessionCheckLogin</strong></p>
<p>配置含义：获取 <code>Token-Session</code> 时是否必须登录 （如果配置为true，会在每次获取 <code>Token-Session</code> 时校验是否登录）。</p>
<p>在调用 <code>StpUtil.login(id)</code> 登录后，</p>
<ul>
<li>调用 <code>StpUtil.getSession()</code> 可以获取这个会话的 <code>Account-Session</code> 对象。</li>
<li>调用 <code>StpUtil.getTokenSession()</code> 可以获取这个会话 <code>Token-Session</code> 对象。</li>
</ul>
<p>关于两种 Session 有何区别，可以参考这篇：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9zYS10b2tlbi5jYy9kb2MuaHRtbCMvZnVuL3Nlc3Npb24tbW9kZWw=">Session模型详解</a>，此处暂不赘述。</p>
<p>从设计上讲，无论会话是否已经登录，只要前端提供了Token，我们就可以找到这个 Token 的专属 <code>Token-Session</code> 对象，<strong>这非常灵活但不安全</strong>， 因为前端提交的 Token 可能是任意伪造的。</p>
<p>为了解决这个问题，<code>StpUtil.getTokenSession()</code> 方法在获取 <code>Token-Session</code> 时，会率先检测一下这个 Token 是否是一个有效Token：</p>
<ul>
<li>如果是有效Token，正常返回 <code>Token-Session</code> 对象</li>
<li>如果是无效Token，则抛出异常。</li>
</ul>
<p>这样就保证了伪造的 Token 是无法获取 <code>Token-Session</code> 对象的。</p>
<p>但是 —— 有的场景下我们又确实需要在登录之前就使用 Token-Session 对象，这时候就把配置项 <code>tokenSessionCheckLogin</code> 值改为 <code>false</code> 即可。</p>
<p><strong>配置项详解：isHttp</strong></p>
<p>配置含义：是否打开单点登录模式三。</p>
<ul>
<li>此配置项为 false 时，代表使用SSO模式二：使用 Redis 校验 ticket 值、删除 Redis 数据做到单点注销、使用 Redis 同步 Userinfo 数据。</li>
<li>此配置项为 true 时，代表使用SSO模式三：使用 Http 请求校验 ticket 值、使用 Http 请求做到单点注销、使用 Http 请求同步 Userinfo 数据。</li>
</ul>
<hr>
<p>[本章代码示例：Sa-Token 框架配置 —— <a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9naXRlZS5jb20vZHJvbWFyYS9zYS10b2tlbi9ibG9iL21hc3Rlci9zYS10b2tlbi1kZW1vL3NhLXRva2VuLWRlbW8tY2FzZS9zcmMvbWFpbi9yZXNvdXJjZXMvYXBwbGljYXRpb24ueW1s"> application.yml ]</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/basic/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/basic/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">violet</div><div class="post-copyright__author_desc">生活明朗，万物可爱</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/posts/fe850976.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/posts/fe850976.html')">SaToken鉴权框架-基础</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" target="_blank"><img class="post-qr-code-img" src="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" target="_blank"><img class="post-qr-code-img" src="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/posts/fe850976.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SaToken鉴权框架-基础&amp;url=http://example.com/posts/fe850976.html&amp;pic=https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Violet博客屋</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/SaToken/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>SaToken<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://img.zcool.cn/community/01c5355e5c78d3a8012165183b7ae8.jpg@2o.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1690d21b.html"><img class="prev-cover" src="https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">函数式编程</div></div></a></div><div class="next-post pull-right"><a href="/posts/fe850976.html"><img class="next-cover" src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SaToken鉴权框架</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/c5b41cb.html" title="SaToken鉴权框架-深入"><img class="cover" src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-10-08</div><div class="title">SaToken鉴权框架-深入</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="/img/basic/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">violet</h1><div class="author-info__desc">生活明朗，万物可爱</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Violetlx" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Sa-Token-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">Sa-Token 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sa-Token-%E5%8A%9F%E8%83%BD%E9%A2%84%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">Sa-Token 功能预览</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8-SpringBoot-%E4%B8%AD%E9%9B%86%E6%88%90"><span class="toc-number">2.</span> <span class="toc-text">在 SpringBoot 中集成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text">1、创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">2.2.</span> <span class="toc-text">2、添加依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%AE%BE%E7%BD%AE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">3、设置配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">2.4.</span> <span class="toc-text">4、创建启动类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95-Controller"><span class="toc-number">2.5.</span> <span class="toc-text">5、创建测试 Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E8%BF%90%E8%A1%8C"><span class="toc-number">2.6.</span> <span class="toc-text">6、运行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">登录认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-number">3.1.</span> <span class="toc-text">1、设计思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%99%BB%E5%BD%95%E4%B8%8E%E6%B3%A8%E9%94%80"><span class="toc-number">3.2.</span> <span class="toc-text">2、登录与注销</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%BC%9A%E8%AF%9D%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.3.</span> <span class="toc-text">3、会话查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Token-%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.</span> <span class="toc-text">4、Token 查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%9D%A5%E4%B8%AA%E5%B0%8F%E6%B5%8B%E8%AF%95%EF%BC%8C%E5%8A%A0%E6%B7%B1%E4%B8%80%E4%B8%8B%E7%90%86%E8%A7%A3"><span class="toc-number">3.5.</span> <span class="toc-text">5、来个小测试，加深一下理解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81"><span class="toc-number">4.</span> <span class="toc-text">权限认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF-1"><span class="toc-number">4.1.</span> <span class="toc-text">1、设计思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%B4%A6%E5%8F%B7%E6%9D%83%E9%99%90%E7%A0%81%E9%9B%86%E5%90%88"><span class="toc-number">4.2.</span> <span class="toc-text">2、获取当前账号权限码集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.3.</span> <span class="toc-text">3、权限校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%A7%92%E8%89%B2%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.4.</span> <span class="toc-text">4、角色校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E6%8B%A6%E6%88%AA%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">4.5.</span> <span class="toc-text">5、拦截全局异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%9D%83%E9%99%90%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">4.6.</span> <span class="toc-text">6、权限通配符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%A6%82%E4%BD%95%E6%8A%8A%E6%9D%83%E9%99%90%E7%B2%BE%E7%A1%AE%E5%88%B0%E6%8C%89%E9%92%AE%E7%BA%A7%EF%BC%9F"><span class="toc-number">4.7.</span> <span class="toc-text">7、如何把权限精确到按钮级？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">4.8.</span> <span class="toc-text">8、示例代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B8%A2%E4%BA%BA%E4%B8%8B%E7%BA%BF"><span class="toc-number">5.</span> <span class="toc-text">踢人下线</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%BC%BA%E5%88%B6%E6%B3%A8%E9%94%80"><span class="toc-number">5.1.</span> <span class="toc-text">1、强制注销</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%B8%A2%E4%BA%BA%E4%B8%8B%E7%BA%BF"><span class="toc-number">5.2.</span> <span class="toc-text">2、踢人下线</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%89%B4%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text">注解鉴权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%89%B4%E6%9D%83-1"><span class="toc-number">6.1.</span> <span class="toc-text">注解鉴权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%B3%A8%E5%86%8C%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.2.</span> <span class="toc-text">1、注册拦截器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E9%89%B4%E6%9D%83"><span class="toc-number">6.3.</span> <span class="toc-text">2、使用注解鉴权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%AE%BE%E5%AE%9A%E6%A0%A1%E9%AA%8C%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text">3、设定校验模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%E5%8F%8C%E9%87%8D%E6%A0%A1%E9%AA%8C-%E2%80%9Cor-%E6%A0%A1%E9%AA%8C%E2%80%9D"><span class="toc-number">6.5.</span> <span class="toc-text">4、角色权限双重校验 “or 校验”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%BF%BD%E7%95%A5%E8%AE%A4%E8%AF%81"><span class="toc-number">6.6.</span> <span class="toc-text">5、忽略认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%89%B9%E9%87%8F%E6%B3%A8%E8%A7%A3%E9%89%B4%E6%9D%83"><span class="toc-number">6.7.</span> <span class="toc-text">6、批量注解鉴权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="toc-number">6.8.</span> <span class="toc-text">7、扩展阅读</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA%E9%89%B4%E6%9D%83"><span class="toc-number">7.</span> <span class="toc-text">路由拦截鉴权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%B3%A8%E5%86%8C-Sa-Token-%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">1、注册 Sa-Token 路由拦截器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%A0%A1%E9%AA%8C%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">7.2.</span> <span class="toc-text">2、校验函数详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%8C%B9%E9%85%8D%E7%89%B9%E5%BE%81%E8%AF%A6%E8%A7%A3"><span class="toc-number">7.3.</span> <span class="toc-text">3、匹配特征详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%8F%90%E5%89%8D%E9%80%80%E5%87%BA%E5%8C%B9%E9%85%8D%E9%93%BE"><span class="toc-number">7.4.</span> <span class="toc-text">4、提前退出匹配链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8-free-%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">7.5.</span> <span class="toc-text">5、使用 free 打开一个独立的作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%BF%BD%E7%95%A5%E6%8E%89%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA%E6%A0%A1%E9%AA%8C"><span class="toc-number">7.6.</span> <span class="toc-text">6、使用注解忽略掉路由拦截校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E5%85%B3%E9%97%AD%E6%B3%A8%E8%A7%A3%E6%A0%A1%E9%AA%8C"><span class="toc-number">7.7.</span> <span class="toc-text">7、关闭注解校验</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Session-%E4%BC%9A%E8%AF%9D"><span class="toc-number">8.</span> <span class="toc-text">Session 会话</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Session-%E4%BC%9A%E8%AF%9D%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">8.1.</span> <span class="toc-text">1、Session 会话是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Account-Session"><span class="toc-number">8.2.</span> <span class="toc-text">2、Account-Session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Token-Session"><span class="toc-number">8.3.</span> <span class="toc-text">3、Token-Session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Custom-Session"><span class="toc-number">8.4.</span> <span class="toc-text">4、Custom-Session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%9C%A8-Session-%E4%B8%8A%E5%AD%98%E5%8F%96%E5%80%BC"><span class="toc-number">8.5.</span> <span class="toc-text">5、在 Session 上存取值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C"><span class="toc-number">8.6.</span> <span class="toc-text">6、其他操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81%E9%81%BF%E5%85%8D%E4%B8%8E-HttpSession-%E6%B7%B7%E6%B7%86%E4%BD%BF%E7%94%A8"><span class="toc-number">8.7.</span> <span class="toc-text">7、避免与 HttpSession 混淆使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81%E6%9C%AA%E7%99%BB%E5%BD%95%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%8E%B7%E5%8F%96-Token-Session"><span class="toc-number">8.8.</span> <span class="toc-text">8、未登录场景下获取 Token-Session</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">9.</span> <span class="toc-text">框架配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">9.1.</span> <span class="toc-text">1、配置方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E5%8C%85%E6%89%80%E6%9C%89%E5%8F%AF%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">9.2.</span> <span class="toc-text">2、核心包所有可配置项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">9.3.</span> <span class="toc-text">3、单点登录相关配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81OAuth2-0%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">9.4.</span> <span class="toc-text">4、OAuth2.0相关配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%83%A8%E5%88%86%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3"><span class="toc-number">9.5.</span> <span class="toc-text">5、部分配置项详解</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/e22607b1.html" title="词"><img src="https://img.zcool.cn/community/01c5355e5c78d3a8012165183b7ae8.jpg@2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="词"></a><div class="content"><a class="title" href="/posts/e22607b1.html" title="词">词</a><time datetime="2024-10-08T08:22:02.000Z" title="发表于 2024-10-08 16:22:02">2024-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1f44fecb.html" title="诗"><img src="https://img.zcool.cn/community/01b08e5e5c78d3a80121651842666c.jpg@2o.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="诗"></a><div class="content"><a class="title" href="/posts/1f44fecb.html" title="诗">诗</a><time datetime="2024-10-08T08:22:01.000Z" title="发表于 2024-10-08 16:22:01">2024-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c5b41cb.html" title="SaToken鉴权框架-深入"><img src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SaToken鉴权框架-深入"></a><div class="content"><a class="title" href="/posts/c5b41cb.html" title="SaToken鉴权框架-深入">SaToken鉴权框架-深入</a><time datetime="2024-10-08T08:03:25.000Z" title="发表于 2024-10-08 16:03:25">2024-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fe850976.html" title="SaToken鉴权框架"><img src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SaToken鉴权框架"></a><div class="content"><a class="title" href="/posts/fe850976.html" title="SaToken鉴权框架">SaToken鉴权框架</a><time datetime="2024-09-27T08:32:20.000Z" title="发表于 2024-09-27 16:32:20">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fe850976.html" title="SaToken鉴权框架-基础"><img src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SaToken鉴权框架-基础"></a><div class="content"><a class="title" href="/posts/fe850976.html" title="SaToken鉴权框架-基础">SaToken鉴权框架-基础</a><time datetime="2024-09-27T08:32:20.000Z" title="发表于 2024-09-27 16:32:20">2024-09-27</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://mail.qq.com/" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src="https://media.giphy.com/media/zymjdD521GHBu/giphy.gif" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.bilibili.com/" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.douyin.com/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2024 By <a class="footer-bar-link" href="/" title="violet" target="_blank">violet</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://violet.zeabur.app/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/" title="Github"><img class="back-menu-item-icon" src="https://pic4.zhimg.com/v2-341e1d3b2845db15bceeff70d3fe228b_r.jpg" alt="Github"><span class="back-menu-item-text">Github</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博文</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/shuoshuo/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 分享</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/photos/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1994908354&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 影视</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><i class="anzhiyufont anzhiyu-icon-rocket faa-tada" style="font-size: 0.9em;"></i><span> 游戏厅</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文档</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 随机文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/document/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 文档页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itbaima/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 柏码</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/runoob/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 菜鸟教程</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itheima/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 黑马程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/SpringCloudAlibaba/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 阿里微服务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友人帐</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站导航</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/front/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 前端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/back-end/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 后端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/programmer/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/ai/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于笔者</span></a></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Docker/" style="font-size: 0.88rem; color: rgb(45, 40, 53);">Docker<sup>2</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem; color: rgb(108, 144, 100);">IDEA<sup>4</sup></a><a href="/tags/Java%E7%A8%8B%E5%BA%8F%E5%91%98/" style="font-size: 0.88rem; color: rgb(51, 84, 96);">Java程序员<sup>3</sup></a><a href="/tags/MybatisPlus/" style="font-size: 0.88rem; color: rgb(177, 176, 26);">MybatisPlus<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem; color: rgb(126, 197, 23);">SQL<sup>1</sup></a><a href="/tags/SaToken/" style="font-size: 0.88rem; color: rgb(56, 19, 181);">SaToken<sup>3</sup></a><a href="/tags/VMware/" style="font-size: 0.88rem; color: rgb(57, 145, 149);">VMware<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 0.88rem; color: rgb(48, 98, 28);">VsCode<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem; color: rgb(183, 155, 9);">git<sup>1</sup></a><a href="/tags/nacos/" style="font-size: 0.88rem; color: rgb(175, 55, 104);">nacos<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem; color: rgb(18, 164, 144);">redis<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 0.88rem; color: rgb(76, 99, 82);">生活<sup>2</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button type="button" title="切换背景" onclick="toggleWinbox()"><i class="anzhiyufont anzhiyu-icon-images"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 violet 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="" src="/live2d-widget-master/autoload.js"></script><script src="https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script src="/js/xxx.js?1"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/js/index.js"></script><style>#widget-tree-button{opacity:0}</style><div id="widget-tree">
      <ul>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">
          生活
        </a>
      <span class="tree-list-count">2</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/1f44fecb.html" title="诗"><i class="post-icon gg-file-document"></i>诗</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/e22607b1.html" title="词"><i class="post-icon gg-file-document"></i>词</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">
          程序员
        </a>
      <span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/621998ca.html" title="Java架构师成长路径图"><i class="post-icon gg-file-document"></i>Java架构师成长路径图</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/6ed5eebe.html" title="SpringCloud微服务项目"><i class="post-icon gg-file-document"></i>SpringCloud微服务项目</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/1690d21b.html" title="函数式编程"><i class="post-icon gg-file-document"></i>函数式编程</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">
          工具
        </a>
      <span class="tree-list-count">6</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/c68db7e6.html" title="VsCode下载安装"><i class="post-icon gg-file-document"></i>VsCode下载安装</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/545a6120.html" title="VMware"><i class="post-icon gg-file-document"></i>VMware</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/7f7493d0.html" title="IDEA 使用 Git 详解(一)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(一)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/d06fc5d7.html" title="IDEA 使用 Git 详解(三)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(三)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/ae9ce5fc.html" title="IDEA 使用 Git 详解(二)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(二)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/97a0a1c6.html" title="Idea下载安装"><i class="post-icon gg-file-document"></i>Idea下载安装</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/SpringCloud/">
          SpringCloud
        </a>
      <span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/f5f9fa9b.html" title="安装Docker"><i class="post-icon gg-file-document"></i>安装Docker</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/cd988ed5.html" title="Docker使用"><i class="post-icon gg-file-document"></i>Docker使用</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/8af9e237.html" title="MybatisPlus"><i class="post-icon gg-file-document"></i>MybatisPlus</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
          环境搭建
        </a>
      <span class="tree-list-count">4</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/f5f9fa9b.html" title="安装Docker"><i class="post-icon gg-file-document"></i>安装Docker</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/386349fe.html" title="Git 安装与使用"><i class="post-icon gg-file-document"></i>Git 安装与使用</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/6b830637.html" title="Redis安装说明"><i class="post-icon gg-file-document"></i>Redis安装说明</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/95afb97c.html" title="Nacos 安装与使用"><i class="post-icon gg-file-document"></i>Nacos 安装与使用</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">
          开发框架
        </a>
      <span class="tree-list-count">4</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/8af9e237.html" title="MybatisPlus"><i class="post-icon gg-file-document"></i>MybatisPlus</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/c5b41cb.html" title="SaToken鉴权框架-深入"><i class="post-icon gg-file-document"></i>SaToken鉴权框架-深入</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/fe850976.html" title="SaToken鉴权框架"><i class="post-icon gg-file-document"></i>SaToken鉴权框架</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/fe850976.html" title="SaToken鉴权框架-基础"><i class="post-icon gg-file-document"></i>SaToken鉴权框架-基础</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E6%B3%95/">
          编程语法
        </a>
      <span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/5d06cb2d.html" title="SQL使用教程"><i class="post-icon gg-file-document"></i>SQL使用教程</a></li></ul></li></ul>
        <div id="widget-tree-button">
          <i class="gg-chevron-right"></i>
        </div>
      </div> <script data-pjax="">if(document.getElementById('recent-posts') && location.pathname =='/'){
    
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post" style="height: auto;width: 100%;position: relative;"> <div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container" style="top: 0;margin-bottom: 20px;"> <div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://img1.baidu.com/it/u=3093179843,731129673&fm=253&fmt=auto&app=138&f=JPEG?w=952&h=500" alt="https://img1.baidu.com/it/u=3093179843,731129673&fm=253&fmt=auto&app=138&f=JPEG?w=952&h=500"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-09-02</span><a class="blog-slider__title" href="posts/4a17b156.html">Hello World</a><div class="blog-slider__text">简单好用的 hexo 博客！欢迎使用！</div><a class="blog-slider__button" href="posts/4a17b156.html">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="https://www.javaweb.cc/zb_users/upload/editor/water/2022-12-01/63887b9fdbaf2.jpeg" alt="https://www.javaweb.cc/zb_users/upload/editor/water/2022-12-01/63887b9fdbaf2.jpeg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-09-23</span><a class="blog-slider__title" href="posts/621998ca.html">Java架构师成长路径图</a><div class="blog-slider__text">Java架构师成长路径图！</div><a class="blog-slider__button" href="posts/621998ca.html">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div> </div> </div>';
    console.log('已挂载swiper')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script>
<script data-pjax="" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script>
<style></style><!-- hexo injector body_end end -->
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: true,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>