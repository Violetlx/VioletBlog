<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/css/index.css" rel="stylesheet"><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>函数式编程 | Violet博客屋</title><meta name="keywords" content="Java程序员"><meta name="author" content="violet"><meta name="copyright" content="violet"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="函数式编程"><meta name="application-name" content="函数式编程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="函数式编程"><meta property="og:url" content="http://example.com/posts/1690d21b.html"><meta property="og:site_name" content="Violet博客屋"><meta property="og:description" content="函数式编程"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain"><meta property="article:author" content="violet"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain"><meta name="description" content="函数式编程"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/posts/1690d21b"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="code-xxx"><meta name="msvalidate.01" content="xxx"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="var(--anzhiyu-main)"><link rel="mask-icon" href="/img/siteicon/apple-icon-180.png" color="#5bbad5"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-icon-180.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="bookmark" href="/img/siteicon/apple-icon-180.png"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"><link rel="apple-touch-startup-image" href="/img/siteicon/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":1500,"languages":{"author":"作者: violet","link":"链接: ","source":"来源: Violet博客屋","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Violet博客屋',
  title: '函数式编程',
  postAI: '',
  pageFillDescription: '一. 道之伊始, 什么是函数, 大道无情, 无情, 佛祖成道, 函数与方法, 不变的好处, 合格的函数无状态, 大道无形, 函数化对象, 行为参数化, 延迟执行, 函数对象的不同类型, 二. 函数编程语法, 表现形式, 函数类型, 六种方法引用, 1）类名静态方法名, 2）类名非静态方法名, 3）对象非静态方法名, 4）类名new, 5）this非静态方法名, 6）super非静态方法名, 7）特例, 闭包（Closure）, 柯里化（Carrying）, 高阶函数（Higher-Order Functions）, 1) 内循环, 2) 遍历二叉树, 3) 简单流, 4) 简单流-化简, 5) 简单流-收集, 综合练习, 1）判断语法正确性, 2）写出等价的 lambda 表达式, 3）使用函数接口解决问题, 4）写出等价的方法引用, 5）补充代码, 6）实现需求, 三. Stream API, 过滤, 映射, 降维, 构建, 拼接, 截取, 生成, 查找与判断, 排序与去重, 化简, 收集, 收集器, 下游收集器, 基本流, 特性, 并行, 效率, 1) 数组求和, 2) 求最大值, 3) 并行(发)收集, 4）MethodHandle 性能, 综合练习, 四. 实际应用, 数据统计分析, 1）每月的销售量, 2）销量最高的月份, 3）求销量最高的商品, 4）下单最多的前10用户, 5.1）每个地区下单最多的用户, 5.2）每个地区下单最多的前3用户, 6.1）按类别统计销量, 6.2）按一级类别统计销量, 7）按价格区间统计销量, 8）不同年龄段女性所下不同类别订单, 异步处理, 框架设计, 将未知交给子类, 将未知交给用户, 延迟拼接条件, 偏门用法, 并行计算, UI 事件, 五. 实现原理, lambda 原理, 第一步生成静态方法, 第二步生成实现类字节码, 方法引用原理, 闭包原理, Stream 构建一道之伊始宇宙初开之际混沌之气笼罩着整个宇宙一切模糊不清然后盘古开天女娲造人日月乃出星辰乃现山川蜿蜒江河奔流生灵万物欣欣向荣此日月星辰山川江河生灵万物谓之对象皆随时间而化然而日月之行星汉灿烂山川起伏湖海汇聚冥冥中有至理藏其中名曰道乃万物遵循之规律亦谓之函数它无问东西亘古不变作为设计宇宙洪荒的程序员造日月筑山川划江河开湖海演化生灵万物令其生生不息则必用面向对象之手段若定规则求本源追纯粹论不变则当选函数编程之思想下面就让我们从函数开始什么是函数什么是函数呢函数即规则数学上例如是一种规律按照此规律变化为很多规律已经由人揭示例如程序设计中更可以自己去制定规律一旦成为规则的制定者你就是神大道无情无情何为无情只要输入相同无论多少次调用无论什么时间调用输出相同佛祖成道例如张三张三张三佛祖向虔诚祈祷以上的执行结果除了参数变化外希望函数的执行规则永远不变张三向佛祖虔诚祈祷张三向佛祖虔诚祈祷张三向佛祖虔诚祈祷然而由于设计上的缺陷函数引用了外界可变的数据如果这么使用魔王张三结果就会是张三向魔王虔诚祈祷问题出在哪儿呢函数的目的是除了参数能变化其它部分都要不变这样才能成为规则的一部分佛祖要成为规则的一部分也要保持不变改正方法或不是说函数不能引用外界的数据而是它引用的数据必须也能作为规则的一部分让佛祖不变佛祖才能成为规则函数与方法方法本质上也是函数不过方法绑定在对象之上它是对象个人法则函数是函数对象数据其它参数而方法是对象数据方法其它参数不变的好处只有不变才能在滚滚时间洪流中屹立不倒成为规则的一部分多线程编程中不变意味着线程安全合格的函数无状态大道无形函数化对象函数本无形也就是它代表的规则位置固定不能传播若要有形让函数的规则能够传播需要将函数化为对象与它已经变成了一个对象区别在哪前者是纯粹的一条两数加法规则它的位置是固定的要使用它需要通过找到它然后执行而后者对象就像长了腿它的位置是可以变化的想去哪里就去哪里哪里要用到这条加法规则把它传递过去接口的目的是为了将来用它来执行函数对象此接口中只能有一个方法定义函数化为对象做个比喻之前是大家要统一去西天取经现在是每个菩萨罗汉拿着经书入世传经例如上面的例子做了一些简单的扩展可以看到不同的客户端可以上传自己的计算规则大部分文献都说是匿名函数但我觉得需要在这个说法上进行补充至少在里虽然表达式本身不需要起名字但不得提供一个对应接口嘛行为参数化已知学生类定义如下针对一组学生集合筛选出男学生下面的代码实现如何评价一下张无忌男杨不悔女周芷若女宋青书男能得到张无忌宋青书男如果需求再变动一下要求找到岁以下的学生上面代码显然不能用了改动方法如下能得到张无忌杨不悔那么需求如果再要变动找岁以下男学生怎么改显然上述做法并不太好更希望一个方法能处理各种情况仔细观察以上两个方法找不同不同在于筛选条件部分男和既然它们就是不同那么能否把它作为参数传递进来这样处理起来不就一致了吗它俩要判断的逻辑不同那这两处不同的逻辑必然要用函数来表示将来这两个函数都需要用到对象来判断都应该返回一个结果怎么描述函数的长相呢方法可以统一成下述代码好最后怎么给它传递不同实现呢男以及还有新需求也能满足男这样就实现了以不变应万变而变换即是一个个函数对象也可以称之为行为参数化延迟执行在记录日志时假设日志级别是方法会遇到下面的问题本不需要记录日志但方法仍被执行了执行耗时操作结果改进方法显然这么做很多类似代码都要加上这样判断很不优雅改进方法在方法外再套一个新方法内部逻辑大概是这样调用时这样变成了不是立刻执行在未来条件成立时才执行函数对象的不同类型二函数编程语法表现形式在语言中对象有两种形式表达式与方法引用对象的类型是由它的行为决定的如果有一些对象它们的入参类型返回值类型都一致那么它们可以看作是同一类的对象它们的类型用函数式接口来表示函数类型练习将对象分类见函数接口的命名规律带有是一元的意思表示一个参数带有或是二元的意思表示两个参数三元四元方法引用也是类似入参类型返回值类型都一致的话可以看作同一类的对象也是用函数式接口表示六种方法引用类名静态方法名如何理解函数对象的逻辑部分是调用此静态方法因此这个静态方法需要什么参数函数对象也提供相应的参数即可需求挑选出所有男性学生张无忌男周芷若女宋青书男男这个高阶函数接收的函数类型是一个类型的入参一个的返回值因此我们只需要给它提供一个相符合的对象即可这个静态方法有入参对应有返回值也能对应上所以可以直接使用输出张无忌男宋青书男类名非静态方法名如何理解函数对象的逻辑部分是调用此非静态方法因此这个函数对象需要提供一个额外的对象参数以便能够调用此非静态方法非静态方法的剩余参数与函数对象的剩余参数一一对应例张三你好上例中函数类型的参数对应着方法所属类型参数对应着方法自己的参数返回值对应着方法自己的返回值输出张三你好例改写之前根据性别过滤的需求需求挑选出所有男性学生张无忌男周芷若女宋青书男男这个高阶函数接收的函数类型是一个类型的入参一个的返回值因此我们只需要给它提供一个相符合的对象即可它的入参对应着非静态方法的所属类型它没有其它参数方法也没有参数返回值都是输出张无忌男宋青书男例将学生对象仅保留学生的姓名张无忌男周芷若女宋青书男男这个高阶函数接收的函数类型是是一个类型的参数一个类型的返回值它的入参对应着非静态方法的所属类型它没有剩余参数方法也没有参数它的返回值对应着方法的返回值输出张无忌周芷若宋青书对象非静态方法名如何理解函数对象的逻辑部分是调用此非静态方法因为对象已提供所以不必作为函数对象参数的一部分非静态方法的剩余参数与函数对象的剩余参数一一对应对象张无忌男周芷若女宋青书男男男其实较为典型的一个应用就是对象中的非静态方法最后的输出可以修改为这是因为这个高阶函数接收的函数类型是一个类型参数无返回值而对象中有非静态方法与之一致因此可以将此方法化为对象给使用类名对于构造方法也有专门的语法把它们转换为对象函数类型应满足参数部分与构造方法参数一致返回值类型与构造方法所在类一致例如某人张三李四非静态方法名算是形式的特例只能用在类内部张无忌男周芷若女宋青书男男女非静态方法名算是形式的特例只能用在类内部用在要用区分重载方法时特例函数接口和方法引用之间可以差一个返回值例如可以看到接口不需要返回值而实际的函数对象多出的返回值也不影响使用闭包何为闭包闭包就是函数对象与外界变量绑定在一起形成的整体例如代码中的和就形成了一个闭包可以想象成函数对象有个背包背包里可以装变量随身携带将来函数对象甭管传递到多远的地方包里总装着个有个限制局部变量必须是或的意思就是虽然没有用修饰但就像是用修饰了一样不能重新赋值否则就语法错误意味着闭包变量在装进包里的那一刻就不能变化了道理也简单为了保证函数的不变性防止破坏成道闭包是一种给函数执行提供数据的手段函数执行既可以使用函数入参还可以使用闭包变量例闭包作用给函数对象提供参数以外的数据创建个任务对象并且每个任务对象给一个任务编号执行任务柯里化柯里化的作用是让函数对象分步执行本质上是利用多个函数对象和闭包例如代码中是第一个函数对象它的返回结果是第二个函数对象后者与前面的参数构成了闭包确定了的值是返回第二个函数对象被放入了对象的背包记下来了确定了的值是此时可以执行的操作得到结果分析过程类似高阶函数内循环遍历二叉树简单流简单流化简简单流收集综合练习判断语法正确性写出等价的表达式假设已有对象张三使用函数接口解决问题把下列方法中可能存在变化的部分抽象为函数对象从外界传递进来筛选判断是否是偶数但以后可能改变判断规则转换将数字转为字符串但以后可能改变转换规则消费打印但以后可能改变消费规则生成随机数但以后可能改变生成规则写出等价的方法引用补充代码如果想用来构造对象还应当补充哪些代码实现需求张三张三张三通过测试传入参数时分别用类名静态方法名类名非静态方法名来表示学生年龄大于等于的条件三过滤草莓浆果红色桑葚浆果紫色杨梅浆果红色核桃坚果棕色草莓坚果棕色蓝莓浆果蓝色找到所有浆果浆果找到蓝色的浆果方法浆果蓝色方法让每个只做一件事两次相对于并且关系浆果蓝色方法让每个只做一件事不过比方法强的地方可以运算浆果蓝色映射酱降维例草莓浆果红色桑葚浆果紫色杨梅浆果红色蓝莓浆果蓝色核桃坚果棕色草莓坚果棕色这样把坚果和浆果两个集合变成了含六个元素的水果流例想逐一处理每个订单中的商品这样把一个有两个元素的订单流变成了一个有六个元素的商品流构建根据已有的数组构建流根据已有的构建流包括等把一个对象变成流把多个对象变成流拼接两个流拼接截取是跳过几个元素是限制处理的元素个数是流中元素直到条件不成立留下剩余元素是流中元素直到条件不成立舍弃剩余元素生成生成从的数字或者如果想订制可以用方法例如下面生成奇数序列参数是初始值参数是一个特殊即参数类型与返回值相同它会根据上一个元素的值计算出当前元素需要用限制元素个数也可以用的重载方法参数是初始值参数用来限制元素个数一旦不满足此条件流就结束参数相当于上个方法的参数的特点是根据上一个元素计算当前元素如果不需要依赖上一个元素可以改用方法例如下面是生成个随机不过如果只是生成随机数的话有更简单的办法如果要指定上下限例如下面是生成从的个随机数查找与判断下面的代码找到流中任意一个偶数注意返回的是对象因为可能流中不存在偶数对于对象一般需要用或提供默认值来处理与比较类似的是它俩的区别是找在流中任意位置的元素不需要考虑顺序对于上例返回也是可以的是找第一个出现在元素需要考虑顺序对于上例只能返回在顺序流中与表现相同区别在于并行流下会更快判断流中是否存在任意一个偶数它返回的是值可以直接用来判断判断流是否全部是偶数同样它返回的是值可以直接用来判断判断流是否全部不是偶数与含义恰好相反排序与去重已知有数据独孤求败令狐冲风清扬东方不败方证任我行冲虚向问天不戒要求首先按武力排序逆序武力相同的按姓名长度排序正序仅用来解方法引用改写其中接收一个提取器说明按对象中哪部分来比较返回一个比较器返回一个顺序相反的比较器接收一个提取器返回一个新比较器新比较器在原有比较器结果相等时执行新的比较逻辑增加一个辅助方法原理如果不好看改成下面的代码化简代表初始值是一个作用是根据上次化简结果和当前元素得到本次化简结果这样两两化简可以将流中的所有元素合并成一个结果收集是描述如何创建收集容器是描述如何向容器添加元素是描述如何合并两个容器串行流下不需要合并容器并行流如果用的是并发容器也不需要合并收集器类中提供了很多现成的收集器详情见网页下游收集器做分组收集时组内可能需要进一步的数据收集称为下游收集器详情见网页基本流基本类型流指和它们在做数值计算时有更好的性能转换成基本流基本流转对象流特性一次使用流只能使用一次终结方法只能调用一次两类操作中间操作懒惰的终结操作迫切的并行效率数组求和其中用循环对求和用对求和用循环对求和用对求和元素个数元素个数元素个数结论做数值计算优先挑选基本流等在数据量较大时它的性能已经非常接近普通循环做数值计算应当避免普通流性能与其它几种相比慢一个数量级求最大值其中原始数据都是没有包装类自定义多线程并行求最大值并行流求最大值串行流求最大值循环求最大值元素个数元素个数元素个数结论并行流相对自己用多线程实现分而治之更简洁并行流只有在数据量非常大时才能充分发力数据量少还不如用串行流并行发收集元素个数元素个数元素个数结论是一个容器单线程收集数据量少时性能占优是多个容器多线程并行收集时间应该花费在合并容器上性能最差是一个容器多线程并发收集在数据量大时性能较优性能正常方法调用反射的性能对比综合练习将的课堂例题修改为方法引用方式实现与的区别三级排序包含值的排序二维流扁平映射三维流扁平映射用打印九九乘法表用生成斐波那契数列的前项自定义求平均四实际应用数据统计分析每月的销售量结果应为订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数其中应该是数据的问题订单数销量最高的月份结果应为订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数也可以用求销量最高的商品结果应为下单最多的前用户结果应为订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数或者每个地区下单最多的用户结果应为上海广东天津四川浙江重庆湖北湖南江苏海南北京每个地区下单最多的前用户结果应为上海广东天津四川浙江重庆湖北湖南江苏海南北京按类别统计销量结果应为订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数按一级类别统计销量结果应为订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数订单数按价格区间统计销量结果应为不同年龄段女性所下不同类别订单女异步处理例子使用开始统计执行其它操作例子使用开始统计执行其它操作框架设计什么是框架半成品软件帮助开发者快速构建应用程序框架提供的都是固定不变的已知的可以重用的代码而那些每个应用不同的业务逻辑变化的未知的部分则在框架外由开发者自己实现将未知交给子类延迟创建中的很多类有非常复杂的继承关系并且它们分工明确你做什么我做什么职责是划分好的例如是父类它有个职责是缓存单例用下面方法实现但如何创建这个父类是不知道的创建是子类的职责父类中的内部就要使用函数对象来获得创建好的对象最后子类创建单例时会把这个函数对象传进去创建其它不需要用缓存将未知交给用户赵一伤男钱二败男孙三毁男李四摧男周五输男吴六破男郑七灭男王八衰男中代码对来讲建立数据库连接创建对象执行查询这些步骤都是固定的而结果要如何用对象封装这对框架代码是未知的用接口代表将来它的实现将结果转换成需要的对象收到事件对来讲它并不知道如何处理事件因此可以提供一个类型为的对象延迟拼接条件赵一伤比较典型的用法有两处第一在调用等方法添加条件时第一个参数是为才会拼接条件否则不拼接如何实现的呢用类型的对象来延迟拼接操作然而它在实现拼接时是不断修改一个状态变量为函数编程所不齿偏门用法第二如果用拼接条件时为了取得列名采用了这个办法它要做的事很简单但内部实现却比较复杂必须用方法引用而不能用其它对象它会实现接口序列化时会把它变成想办法拿到对象反射调用通过能够获得它对应的实际方法也就是和所在类再通过方法名推导得到属性名去掉即所在类知道了属性名也有了就可以进一步确定列名属性上的指定的列名优先没有把属性名当作列名不是很喜欢这种做法比较恶心但它确实是想做这么一件事在代码中全面使用的字段名避免出现数据库的列名将对象序列化得到对象使用类所属类和实现方法名并行计算统计页面的访问次数事件使用表达式定义按钮的点击事件处理程序五实现原理原理以下面代码为例执行结果第一步生成静态方法如何证明用反射输出为去掉了包名容易阅读可以看到除了我们自己写的和以外多出一个名为的方法这个方法是在编译期间由编译器生成的方法是合成方法它的参数内容就是表达式提供的参数和内容如下面代码片段所示第二步生成实现类字节码如果是我自己造一个对象包含此方法可以这么做先创建一个类将来使用时创建对象只不过是在运行期间造出的这个类以及对象而已要想查看这个类在中运行时添加虚拟机参数早期添加的参数是没有去进行版本比对了若想实现在运行期间生成上述字节码有两种手段一是动态代理并没有采用这种办法来生成类二是用它配合在执行时更具性能优势其中是接口方法名是工厂方法长相是接口方法长相是实现方法是实现方法长相是实际函数对象长相实际是调用实现类的构造方法对应的最后返回函数对象方法引用原理闭包原理捕获基本类型变量生成一个带个参数的方法但它和还差一个参数不同之处除了原本的接口类型之外多了实现方法第一个参数的类型产生对象的时候通过把这个参数的实际值传进去这样产生的就是这样并且生成对象时的值被固定为捕获引用类型变量与捕获基本类型变量类似不过除了还可以构建自定义可切分迭代器练习按每次切分固定大小来实现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-29 17:11:27',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/xxx.css?1"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/basic/avatar.png"><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://violet.zeabur.app/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/" title="Github"><img class="back-menu-item-icon" src="https://pic4.zhimg.com/v2-341e1d3b2845db15bceeff70d3fe228b_r.jpg" alt="Github"><span class="back-menu-item-text">Github</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Violet博客屋</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博文</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/shuoshuo/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 分享</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/photos/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1994908354&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 影视</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文档</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 随机文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/document/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 文档页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itbaima/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 柏码</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/runoob/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 菜鸟教程</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itheima/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 黑马程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/SpringCloudAlibaba/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 阿里微服务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友人帐</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站导航</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/front/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 前端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/back-end/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 后端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/programmer/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/ai/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于笔者</span></a></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音乐</div><span class="author-content-item-title">灵魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">18</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/" itemprop="url">程序员</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Java%E7%A8%8B%E5%BA%8F%E5%91%98/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Java程序员</span></a></span></div></div><h1 class="post-title" itemprop="name headline">函数式编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-09-27T06:01:27.000Z" title="发表于 2024-09-27 14:01:27">2024-09-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-09-29T09:11:27.767Z" title="更新于 2024-09-29 17:11:27">2024-09-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">14.4k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>66分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="函数式编程"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope="" itemtype="http://example.com/posts/1690d21b.html"><header><a class="post-meta-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/" itemprop="url">程序员</a><a href="/tags/Java%E7%A8%8B%E5%BA%8F%E5%91%98/" tabindex="-1" itemprop="url">Java程序员</a><h1 id="CrawlerTitle" itemprop="name headline">函数式编程</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">violet</span><time itemprop="dateCreated datePublished" datetime="2024-09-27T06:01:27.000Z" title="发表于 2024-09-27 14:01:27">2024-09-27</time><time itemprop="dateCreated datePublished" datetime="2024-09-29T09:11:27.767Z" title="更新于 2024-09-29 17:11:27">2024-09-29</time></header><h1 id="一-道之伊始"><a href="#一-道之伊始" class="headerlink" title="一. 道之伊始"></a>一. 道之伊始</h1><p>宇宙初开之际，混沌之气笼罩着整个宇宙，一切模糊不清。</p>
<p>然后，盘古开天，女娲造人：日月乃出、星辰乃现，山川蜿蜒、江河奔流、生灵万物，欣欣向荣。此日月、星辰、山川、江河、生灵万物，谓之【对象】，皆随时间而化。</p>
<p>然而：日月之行、星汉灿烂、山川起伏、湖海汇聚，冥冥中有至理藏其中。名曰【道】，乃万物遵循之规律，亦谓之【函数】，它无问东西，亘古不变</p>
<p>作为<strong>设计宇宙洪荒</strong>的程序员</p>
<ul>
<li>造日月、筑山川、划江河、开湖海、演化生灵万物、令其生生不息，则必用面向【对象】之手段</li>
<li>若定规则、求本源、追纯粹，论不变，则当选【函数】编程之思想</li>
</ul>
<p>下面就让我们从【函数】开始。</p>
<h2 id="什么是函数"><a href="#什么是函数" class="headerlink" title="什么是函数"></a>什么是函数</h2><p>什么是函数呢？函数即规则</p>
<p>数学上：</p>
<p><img src="/img/load.gif" data-original="/images/programmer/Java/b/image-20240129152419304.png" alt="image-20240129152419304"></p>
<p>例如：</p>
<table>
<thead>
<tr>
<th>INPUT</th>
<th>f(x)</th>
<th>OUTPUT</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>?</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>?</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>?</td>
<td>9</td>
</tr>
<tr>
<td>4</td>
<td>?</td>
<td>16</td>
</tr>
<tr>
<td>5</td>
<td>?</td>
<td>25</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<ul>
<li>$f(x) = x^2$ 是一种规律， input 按照此规律变化为 output</li>
<li>很多规律已经由人揭示，例如 $e = m \cdot c^2$​</li>
<li>程序设计中<strong>更</strong>可以自己去制定规律，一旦成为规则的制定者，你就是神</li>
</ul>
<h2 id="大道无情"><a href="#大道无情" class="headerlink" title="大道无情"></a>大道无情</h2><h3 id="无情"><a href="#无情" class="headerlink" title="无情"></a>无情</h3><p>何为无情：</p>
<ul>
<li>只要输入相同，无论多少次调用，无论什么时间调用，输出相同。</li>
</ul>
<h3 id="佛祖成道"><a href="#佛祖成道" class="headerlink" title="佛祖成道"></a>佛祖成道</h3><p>例如</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMutable</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        System.out.println(pray(<span class="string">"张三"</span>));</span><br><span class="line">        System.out.println(pray(<span class="string">"张三"</span>));</span><br><span class="line">        System.out.println(pray(<span class="string">"张三"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Buddha</span> {</span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Buddha</span><span class="params">(String name)</span> {</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Buddha</span> <span class="variable">buddha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buddha</span>(<span class="string">"佛祖"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String <span class="title function_">pray</span><span class="params">(String person)</span> {</span><br><span class="line">        <span class="keyword">return</span> (person + <span class="string">"向["</span> + buddha.name + <span class="string">"]虔诚祈祷"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>以上 pray 的执行结果，除了参数变化外，希望函数的执行规则永远不变</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">张三向[佛祖]虔诚祈祷</span><br><span class="line">张三向[佛祖]虔诚祈祷</span><br><span class="line">张三向[佛祖]虔诚祈祷</span><br></pre></td></tr></tbody></table></figure>

<p>然而，由于设计上的缺陷，函数引用了外界可变的数据，如果这么使用</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">buddha.name = <span class="string">"魔王"</span>;</span><br><span class="line">System.out.println(pray(<span class="string">"张三"</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>结果就会是</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">张三向[魔王]虔诚祈祷</span><br></pre></td></tr></tbody></table></figure>

<p>问题出在哪儿呢？函数的目的是除了参数能变化，其它部分都要不变，这样才能成为规则的一部分。佛祖要成为规则的一部分，也要保持不变</p>
<p>改正方法</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Buddha</span> {</span><br><span class="line">    <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Buddha</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>或</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Buddha</span><span class="params">(String name)</span> { }</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>不是说函数不能引用外界的数据，而是它引用的数据必须也能作为规则的一部分</li>
<li>让佛祖不变，佛祖才能成为规则</li>
</ul>
<h3 id="函数与方法"><a href="#函数与方法" class="headerlink" title="函数与方法"></a>函数与方法</h3><p>方法本质上也是函数。不过方法绑定在对象之上，它是对象个人法则</p>
<p>函数是</p>
<ul>
<li>函数（对象数据，其它参数）</li>
</ul>
<p>而方法是</p>
<ul>
<li>对象数据.方法（其它参数）</li>
</ul>
<h3 id="不变的好处"><a href="#不变的好处" class="headerlink" title="不变的好处"></a>不变的好处</h3><p>只有不变，才能在滚滚时间洪流中屹立不倒，成为规则的一部分。</p>
<p>多线程编程中，不变意味着线程安全</p>
<h3 id="合格的函数无状态"><a href="#合格的函数无状态" class="headerlink" title="合格的函数无状态"></a>合格的函数无状态</h3><h2 id="大道无形"><a href="#大道无形" class="headerlink" title="大道无形"></a>大道无形</h2><h3 id="函数化对象"><a href="#函数化对象" class="headerlink" title="函数化对象"></a>函数化对象</h3><p>函数本无形，也就是它代表的规则：位置固定、不能传播。</p>
<p>若要有形，让函数的规则能够传播，需要将函数化为对象。</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> {</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    }</span><br><span class="line">} </span><br></pre></td></tr></tbody></table></figure>

<p>与</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Lambda</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">Lambda</span> <span class="variable">add</span> <span class="operator">=</span> (a, b) -&gt; a + b; <span class="comment">// 它已经变成了一个 lambda 对象</span></span><br></pre></td></tr></tbody></table></figure>

<p>区别在哪？</p>
<ul>
<li>前者是纯粹的一条两数加法规则，它的位置是固定的，要使用它，需要通过 MyClass.add 找到它，然后执行</li>
<li>而后者（add 对象）就像长了腿，它的位置是可以变化的，想去哪里就去哪里，哪里要用到这条加法规则，把它传递过去</li>
<li>接口的目的是为了将来用它来执行函数对象，此接口中只能有一个方法定义</li>
</ul>
<p>函数化为对象做个比喻</p>
<ul>
<li>之前是大家要统一去西天取经</li>
<li>现在是每个菩萨、罗汉拿着经书，入世传经</li>
</ul>
<p>例如</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Lambda</span> {</span><br><span class="line">        <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Server</span> {</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8080</span>);</span><br><span class="line">            System.out.println(<span class="string">"server start..."</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">                <span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> ss.accept();</span><br><span class="line">                Thread.ofVirtual().start(() -&gt; {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        <span class="type">ObjectInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(s.getInputStream());</span><br><span class="line">                        <span class="type">Lambda</span> <span class="variable">lambda</span> <span class="operator">=</span> (Lambda) is.readObject();</span><br><span class="line">                        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">10</span>);</span><br><span class="line">                        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> ThreadLocalRandom.current().nextInt(<span class="number">10</span>);</span><br><span class="line">                        System.out.printf(<span class="string">"%s %d op %d = %d%n"</span>,</span><br><span class="line">                   s.getRemoteSocketAddress().toString(), a, b, lambda.calculate(a, b));</span><br><span class="line">                    } <span class="keyword">catch</span> (IOException | ClassNotFoundException e) {</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Client1</span> {</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="keyword">try</span>(<span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>)){</span><br><span class="line">                <span class="type">Lambda</span> <span class="variable">lambda</span> <span class="operator">=</span> (Lambda &amp; Serializable) (a, b) -&gt; a + b;</span><br><span class="line">                <span class="type">ObjectOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(s.getOutputStream());</span><br><span class="line">                os.writeObject(lambda);</span><br><span class="line">                os.flush();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Client2</span> {</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="keyword">try</span>(<span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>)){</span><br><span class="line">                <span class="type">Lambda</span> <span class="variable">lambda</span> <span class="operator">=</span> (Lambda &amp; Serializable) (a, b) -&gt; a - b;</span><br><span class="line">                <span class="type">ObjectOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(s.getOutputStream());</span><br><span class="line">                os.writeObject(lambda);</span><br><span class="line">                os.flush();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Client3</span> {</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">            <span class="keyword">try</span>(<span class="type">Socket</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>)){</span><br><span class="line">                <span class="type">Lambda</span> <span class="variable">lambda</span> <span class="operator">=</span> (Lambda &amp; Serializable) (a, b) -&gt; a * b;</span><br><span class="line">                <span class="type">ObjectOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(s.getOutputStream());</span><br><span class="line">                os.writeObject(lambda);</span><br><span class="line">                os.flush();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>上面的例子做了一些简单的扩展，可以看到不同的客户端可以上传自己的计算规则</li>
</ul>
<blockquote>
<p><em><strong>P.S.</strong></em></p>
<ul>
<li>大部分文献都说 lambda 是匿名函数，但我觉得需要在这个说法上进行补充</li>
<li>至少在 java 里，虽然 lambda 表达式本身不需要起名字，但不得提供一个对应接口嘛</li>
</ul>
</blockquote>
<h3 id="行为参数化"><a href="#行为参数化" class="headerlink" title="行为参数化"></a>行为参数化</h3><p>已知学生类定义如下</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age, String sex)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSex</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student{"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", age="</span> + age +</span><br><span class="line">                <span class="string">", sex='"</span> + sex + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'}'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>针对一组学生集合，筛选出男学生，下面的代码实现如何，评价一下</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    List&lt;Student&gt; students = List.of(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="number">18</span>, <span class="string">"男"</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"杨不悔"</span>, <span class="number">16</span>, <span class="string">"女"</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="number">19</span>, <span class="string">"女"</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="number">20</span>, <span class="string">"男"</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    System.out.println(filter(students)); <span class="comment">// 能得到 张无忌，宋青书</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> List&lt;Student&gt; <span class="title function_">filter</span><span class="params">(List&lt;Student&gt; students)</span> {</span><br><span class="line">    List&lt;Student&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) {</span><br><span class="line">        <span class="keyword">if</span> (student.sex.equals(<span class="string">"男"</span>)) {</span><br><span class="line">            result.add(student);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果需求再变动一下，要求找到 18 岁以下的学生，上面代码显然不能用了，改动方法如下</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Student&gt; <span class="title function_">filter</span><span class="params">(List&lt;Student&gt; students)</span> {</span><br><span class="line">    List&lt;Student&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) {</span><br><span class="line">        <span class="keyword">if</span> (student.age &lt;= <span class="number">18</span>) {</span><br><span class="line">            result.add(student);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">System.out.println(filter(students)); <span class="comment">// 能得到 张无忌，杨不悔</span></span><br></pre></td></tr></tbody></table></figure>

<p>那么需求如果再要变动，找18岁以下男学生，怎么改？显然上述做法并不太好… 更希望一个方法能处理各种情况，仔细观察以上两个方法，找不同。</p>
<p>不同在于筛选条件部分：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">student.sex.equals(<span class="string">"男"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>和</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">student.age &lt;= <span class="number">18</span></span><br></pre></td></tr></tbody></table></figure>

<p>既然它们就是不同，那么能否把它作为参数传递进来，这样处理起来不就一致了吗？</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Student&gt; <span class="title function_">filter</span><span class="params">(List&lt;Student&gt; students, ???)</span> {</span><br><span class="line">    List&lt;Student&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) {</span><br><span class="line">        <span class="keyword">if</span> (???) {</span><br><span class="line">            result.add(student);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>它俩要判断的逻辑不同，那这两处不同的逻辑必然要用函数来表示，将来这两个函数都需要用到 student 对象来判断，都应该返回一个 boolean 结果，怎么描述函数的长相呢？</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Lambda</span> {</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Student student)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>方法可以统一成下述代码</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Student&gt; <span class="title function_">filter</span><span class="params">(List&lt;Student&gt; students, Lambda lambda)</span> {</span><br><span class="line">    List&lt;Student&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) {</span><br><span class="line">        <span class="keyword">if</span> (lambda.test(student)) {</span><br><span class="line">            result.add(student);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>好，最后怎么给它传递不同实现呢？</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">filter(students, student -&gt; student.sex.equals(<span class="string">"男"</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>以及</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">filter(students, student -&gt; student.age &lt;= <span class="number">18</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>还有新需求也能满足</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">filter(students, student -&gt; student.sex.equals(<span class="string">"男"</span>) &amp;&amp; student.age &lt;= <span class="number">18</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>这样就实现了以不变应万变，而变换即是一个个函数对象，也可以称之为行为参数化</p>
<h3 id="延迟执行"><a href="#延迟执行" class="headerlink" title="延迟执行"></a>延迟执行</h3><p>在记录日志时，假设日志级别是 INFO，debug 方法会遇到下面的问题：</p>
<ul>
<li>本不需要记录日志，但 expensive 方法仍被执行了</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    System.out.println(logger.getLevel());</span><br><span class="line">    logger.debug(<span class="string">"{}"</span>, expensive());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">expensive</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"执行耗时操作"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"结果"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>改进方法1：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(logger.isDebugEnabled())</span><br><span class="line">    logger.debug(<span class="string">"{}"</span>, expensive());</span><br></pre></td></tr></tbody></table></figure>

<p>显然这么做，很多类似代码都要加上这样 if 判断，很不优雅</p>
<p>改进方法2：</p>
<p>在 debug 方法外再套一个新方法，内部逻辑大概是这样：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">debug</span><span class="params">(<span class="keyword">final</span> String msg, <span class="keyword">final</span> Supplier&lt;?&gt; lambda)</span> {</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isDebugEnabled()) {</span><br><span class="line">        <span class="built_in">this</span>.debug(msg, lambda.get());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>调用时这样：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">logger.debug(<span class="string">"{}"</span>, () -&gt; expensive());</span><br></pre></td></tr></tbody></table></figure>

<p>expensive() 变成了不是立刻执行，在未来 if 条件成立时才执行</p>
<h3 id="函数对象的不同类型"><a href="#函数对象的不同类型" class="headerlink" title="函数对象的不同类型"></a>函数对象的不同类型</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Comparator&lt;Student&gt; c = </span><br><span class="line">    			(Student s1, Student s2) -&gt; Integer.compare(s1.age, s2.age);</span><br><span class="line">        </span><br><span class="line">BiFunction&lt;Student, Student, Integer&gt; f = </span><br><span class="line">                (Student s1, Student s2) -&gt; Integer.compare(s1.age, s2.age);</span><br></pre></td></tr></tbody></table></figure>





<h1 id="二-函数编程语法"><a href="#二-函数编程语法" class="headerlink" title="二. 函数编程语法"></a>二. 函数编程语法</h1><h2 id="表现形式"><a href="#表现形式" class="headerlink" title="表现形式"></a>表现形式</h2><p>在 Java 语言中，lambda 对象有两种形式：lambda 表达式与方法引用</p>
<p>lambda 对象的类型是由它的行为决定的，如果有一些 lambda 对象，它们的入参类型、返回值类型都一致，那么它们可以看作是同一类的 lambda 对象，它们的类型，用函数式接口来表示</p>
<h2 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h2><p>练习：将 lambda 对象分类，见 PPT</p>
<p>函数接口的命名规律</p>
<ul>
<li>带有 Unary 是一元的意思，表示一个参数</li>
<li>带有 Bi 或 Binary 是二元的意思，表示两个参数</li>
<li>Ternary 三元</li>
<li>Quatenary 四元</li>
<li>…</li>
</ul>
<p>方法引用也是类似，入参类型、返回值类型都一致的话，可以看作同一类的对象，也是用函数式接口表示</p>
<h2 id="六种方法引用"><a href="#六种方法引用" class="headerlink" title="六种方法引用"></a>六种方法引用</h2><h3 id="1）类名-静态方法名"><a href="#1）类名-静态方法名" class="headerlink" title="1）类名::静态方法名"></a>1）类名::静态方法名</h3><p>如何理解：</p>
<ul>
<li>函数对象的逻辑部分是：调用此静态方法</li>
<li>因此这个静态方法需要什么参数，函数对象也提供相应的参数即可</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type2Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            需求：挑选出所有男性学生</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Stream.of(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="string">"男"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="string">"女"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="string">"男"</span>)</span><br><span class="line">                )</span><br><span class="line">                .filter(Type2Test::isMale)</span><br><span class="line">                .forEach(student -&gt; System.out.println(student));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">(Student student)</span> {</span><br><span class="line">        <span class="keyword">return</span> student.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, String sex)</span> {</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>filter 这个高阶函数接收的函数类型（Predicate）是：一个 T 类型的入参，一个 boolean 的返回值<ul>
<li>因此我们只需要给它提供一个相符合的 lambda 对象即可</li>
</ul>
</li>
<li>isMale 这个静态方法有入参 Student 对应 T，有返回值 boolean 也能对应上，所以可以直接使用</li>
</ul>
<p>输出</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Student[name=张无忌, sex=男]</span><br><span class="line">Student[name=宋青书, sex=男]</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2）类名-非静态方法名"><a href="#2）类名-非静态方法名" class="headerlink" title="2）类名::非静态方法名"></a>2）类名::非静态方法名</h3><p>如何理解：</p>
<ul>
<li>函数对象的逻辑部分是：调用此非静态方法</li>
<li>因此这个函数对象需要提供一个额外的对象参数，以便能够调用此非静态方法</li>
<li>非静态方法的剩余参数，与函数对象的剩余参数一一对应</li>
</ul>
<p>例1：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type3Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        highOrder(Student::hello);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">highOrder</span><span class="params">(Type3 lambda)</span> {</span><br><span class="line">        System.out.println(lambda.transfer(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张三"</span>), <span class="string">"你好"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Type3</span> {</span><br><span class="line">        String <span class="title function_">transfer</span><span class="params">(Student stu, String message)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> {</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(String message)</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.name + <span class="string">" say: "</span> + message;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>上例中函数类型的</p>
<ul>
<li>参数1 对应着 hello 方法所属类型 Student</li>
<li>参数2 对应着 hello 方法自己的参数 String</li>
<li>返回值对应着 hello 方法自己的返回值 String</li>
</ul>
<p>输出</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">张三 say: 你好</span><br></pre></td></tr></tbody></table></figure>



<p>例2：改写之前根据性别过滤的需求</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type2Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            需求：挑选出所有男性学生</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Stream.of(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="string">"男"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="string">"女"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="string">"男"</span>)</span><br><span class="line">                )</span><br><span class="line">                .filter(Student::isMale)</span><br><span class="line">                .forEach(student -&gt; System.out.println(student));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, String sex)</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>filter 这个高阶函数接收的函数类型（Predicate）是：一个 T 类型的入参，一个 boolean 的返回值<ul>
<li>因此我们只需要给它提供一个相符合的 lambda 对象即可</li>
</ul>
</li>
<li>它的入参1 T 对应着 isMale 非静态方法的所属类型 Student</li>
<li>它没有其它参数，isMale 方法也没有参数</li>
<li>返回值都是 boolean</li>
</ul>
<p>输出</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Student[name=张无忌, sex=男]</span><br><span class="line">Student[name=宋青书, sex=男]</span><br></pre></td></tr></tbody></table></figure>



<p>例3：将学生对象仅保留学生的姓名</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type2Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        Stream.of(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="string">"男"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="string">"女"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="string">"男"</span>)</span><br><span class="line">                )</span><br><span class="line">                .map(Student::name)</span><br><span class="line">                .forEach(student -&gt; System.out.println(student));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, String sex)</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>map 这个高阶函数接收的函数类型是（Function）是：一个 T 类型的参数，一个 R 类型的返回值</li>
<li>它的入参1 T 对应着 name 非静态方法的所属类型 Student</li>
<li>它没有剩余参数，name 方法也没有参数</li>
<li>它的返回值 R 对应着 name 方法的返回值 String</li>
</ul>
<p>输出</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">张无忌</span><br><span class="line">周芷若</span><br><span class="line">宋青书</span><br></pre></td></tr></tbody></table></figure>



<h3 id="3）对象-非静态方法名"><a href="#3）对象-非静态方法名" class="headerlink" title="3）对象::非静态方法名"></a>3）对象::非静态方法名</h3><p>如何理解：</p>
<ul>
<li>函数对象的逻辑部分是：调用此非静态方法</li>
<li>因为对象已提供，所以不必作为函数对象参数的一部分</li>
<li>非静态方法的剩余参数，与函数对象的剩余参数一一对应</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type4Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Util</span> <span class="variable">util</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Util</span>(); <span class="comment">// 对象</span></span><br><span class="line">        Stream.of(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="string">"男"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="string">"女"</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="string">"男"</span>)</span><br><span class="line">                )</span><br><span class="line">                .filter(util::isMale)</span><br><span class="line">                .map(util::getName)</span><br><span class="line">                .forEach(student -&gt; System.out.println(student));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, String sex)</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Util</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">(Student student)</span> {</span><br><span class="line">            <span class="keyword">return</span> student.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">        }</span><br><span class="line">        String <span class="title function_">getName</span><span class="params">(Student student)</span> {</span><br><span class="line">            <span class="keyword">return</span> student.name();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其实较为典型的一个应用就是 <code>System.out</code> 对象中的非静态方法，最后的输出可以修改为</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<p>这是因为 </p>
<ul>
<li>forEach  这个高阶函数接收的函数类型（Consumer）是一个 T 类型参数，void 无返回值</li>
<li>而 System.out 对象中有非静态方法 void println(Object x) 与之一致，因此可以将此方法化为 lambda 对象给 forEach 使用</li>
</ul>
<h3 id="4）类名-new"><a href="#4）类名-new" class="headerlink" title="4）类名::new"></a>4）类名::new</h3><p>对于构造方法，也有专门的语法把它们转换为 lambda 对象</p>
<p>函数类型应满足</p>
<ul>
<li>参数部分与构造方法参数一致</li>
<li>返回值类型与构造方法所在类一致</li>
</ul>
<p>例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type5Test</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> {</span><br><span class="line">            <span class="built_in">this</span>.name = <span class="string">"某人"</span>;</span><br><span class="line">            <span class="built_in">this</span>.age = <span class="number">18</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> {</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = <span class="number">18</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> {</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Student{"</span> +</span><br><span class="line">                    <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                    <span class="string">", age="</span> + age +</span><br><span class="line">                    <span class="string">'}'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Type51</span> {</span><br><span class="line">        Student <span class="title function_">create</span><span class="params">()</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Type52</span> {</span><br><span class="line">        Student <span class="title function_">create</span><span class="params">(String name)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Type53</span> {</span><br><span class="line">        Student <span class="title function_">create</span><span class="params">(String name, <span class="type">int</span> age)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        hiOrder((Type51) Student::<span class="keyword">new</span>);</span><br><span class="line">        hiOrder((Type52) Student::<span class="keyword">new</span>);</span><br><span class="line">        hiOrder((Type53) Student::<span class="keyword">new</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hiOrder</span><span class="params">(Type51 creator)</span> {</span><br><span class="line">        System.out.println(creator.create());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hiOrder</span><span class="params">(Type52 creator)</span> {</span><br><span class="line">        System.out.println(creator.create(<span class="string">"张三"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hiOrder</span><span class="params">(Type53 creator)</span> {</span><br><span class="line">        System.out.println(creator.create(<span class="string">"李四"</span>, <span class="number">20</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="5）this-非静态方法名"><a href="#5）this-非静态方法名" class="headerlink" title="5）this::非静态方法名"></a>5）this::非静态方法名</h3><p>算是形式2的特例，只能用在类内部</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type6Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Util</span> <span class="variable">util</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UtilExt</span>();</span><br><span class="line">        util.hiOrder(Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张无忌"</span>, <span class="string">"男"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"周芷若"</span>, <span class="string">"女"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"宋青书"</span>, <span class="string">"男"</span>)</span><br><span class="line">        ));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, String sex)</span> {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Util</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isMale</span><span class="params">(Student student)</span> {</span><br><span class="line">            <span class="keyword">return</span> student.sex.equals(<span class="string">"男"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">isFemale</span><span class="params">(Student student)</span> {</span><br><span class="line">            <span class="keyword">return</span> student.sex.equals(<span class="string">"女"</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">hiOrder</span><span class="params">(Stream&lt;Student&gt; stream)</span> {</span><br><span class="line">            stream</span><br><span class="line">                    .filter(<span class="built_in">this</span>::isMale)</span><br><span class="line">                    .forEach(System.out::println);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="6）super-非静态方法名"><a href="#6）super-非静态方法名" class="headerlink" title="6）super::非静态方法名"></a>6）super::非静态方法名</h3><p>算是形式2的特例，只能用在类内部（用在要用 super 区分重载方法时）</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Type6Test</span> {</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UtilExt</span> <span class="keyword">extends</span> <span class="title class_">Util</span> {</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">hiOrder</span><span class="params">(Stream&lt;Student&gt; stream)</span> {</span><br><span class="line">            stream</span><br><span class="line">                    .filter(<span class="built_in">super</span>::isFemale)</span><br><span class="line">                    .forEach(System.out::println);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="7）特例"><a href="#7）特例" class="headerlink" title="7）特例"></a>7）特例</h3><p>函数接口和方法引用之间，可以差一个返回值，例如</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task1</span> <span class="operator">=</span> ExceptionTest::print1;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task2</span> <span class="operator">=</span> ExceptionTest::print2;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print1</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"task1 running..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">print2</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"task2 running..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>可以看到 Runnable 接口不需要返回值，而实际的函数对象多出的返回值也不影响使用</li>
</ul>
<h2 id="闭包（Closure）"><a href="#闭包（Closure）" class="headerlink" title="闭包（Closure）"></a>闭包（Closure）</h2><p>何为闭包，闭包就是<strong>函数对象</strong>与<strong>外界变量</strong>绑定在一起，形成的整体。例如</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClosureTest1</span> {</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Lambda</span> {</span><br><span class="line">        <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> y)</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        highOrder(y -&gt; x + y);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">highOrder</span><span class="params">(Lambda lambda)</span> {</span><br><span class="line">        System.out.println(lambda.add(<span class="number">20</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>代码中的 $y \rightarrow x + y$ 和 $x = 10$，就形成了一个闭包</li>
<li>可以想象成，函数对象有个背包，背包里可以装变量随身携带，将来函数对象甭管传递到多远的地方，包里总装着个 $x = 10$</li>
<li>有个限制，局部变量 x 必须是 final 或 effective final 的，effective final 意思就是，虽然没有用 final 修饰，但就像是用 final 修饰了一样，不能重新赋值，否则就语法错误。<ul>
<li>意味着闭包变量，在装进包里的那一刻，就不能变化了</li>
<li>道理也简单，为了保证函数的不变性，防止破坏成道</li>
</ul>
</li>
<li>闭包是一种给函数执行提供数据的手段，函数执行既可以使用函数入参，还可以使用闭包变量</li>
</ul>
<p>例</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClosureTest2</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 闭包作用：给函数对象提供参数以外的数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="comment">// 创建 10 个任务对象，并且每个任务对象给一个任务编号</span></span><br><span class="line">        List&lt;Runnable&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="type">Runnable</span> <span class="variable">task</span> </span><br><span class="line">                <span class="operator">=</span> () -&gt; System.out.println(Thread.currentThread()+<span class="string">":执行任务"</span> + k);</span><br><span class="line">            list.add(task);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newVirtualThreadPerTaskExecutor();</span><br><span class="line">        <span class="keyword">for</span> (Runnable task : list) {</span><br><span class="line">            service.submit(task);</span><br><span class="line">        }</span><br><span class="line">        System.in.read();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="柯里化（Carrying）"><a href="#柯里化（Carrying）" class="headerlink" title="柯里化（Carrying）"></a>柯里化（Carrying）</h2><p>柯里化的作用是让函数对象分步执行（本质上是利用多个函数对象和闭包）</p>
<p>例如：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Carrying1Test</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        highOrder(a -&gt; b -&gt; a + b);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">highOrder</span><span class="params">(Step1 step1)</span> {</span><br><span class="line">        <span class="type">Step2</span> <span class="variable">step2</span> <span class="operator">=</span> step1.exec(<span class="number">10</span>);</span><br><span class="line">        System.out.println(step2.exec(<span class="number">20</span>));</span><br><span class="line">        System.out.println(step2.exec(<span class="number">50</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Step1</span> {</span><br><span class="line">        Step2 <span class="title function_">exec</span><span class="params">(<span class="type">int</span> a)</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Step2</span> {</span><br><span class="line">        <span class="type">int</span> <span class="title function_">exec</span><span class="params">(<span class="type">int</span> b)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>代码中</p>
<ul>
<li>$a \rightarrow …$ 是第一个函数对象，它的返回结果  $b \rightarrow …$ 是第二个函数对象</li>
<li>后者与前面的参数 a 构成了闭包</li>
<li>step1.exec(10) 确定了 a 的值是 10，返回第二个函数对象 step2，a 被放入了 step2 对象的背包记下来了</li>
<li>step2.exec(20) 确定了 b 的值是 20，此时可以执行 a + b 的操作，得到结果 30</li>
<li>step2.exec(50) 分析过程类似</li>
</ul>
<h2 id="高阶函数（Higher-Order-Functions）"><a href="#高阶函数（Higher-Order-Functions）" class="headerlink" title="高阶函数（Higher-Order Functions）"></a>高阶函数（Higher-Order Functions）</h2><h3 id="1-内循环"><a href="#1-内循环" class="headerlink" title="1) 内循环"></a>1) 内循环</h3><h3 id="2-遍历二叉树"><a href="#2-遍历二叉树" class="headerlink" title="2) 遍历二叉树"></a>2) 遍历二叉树</h3><h3 id="3-简单流"><a href="#3-简单流" class="headerlink" title="3) 简单流"></a>3) 简单流</h3><h3 id="4-简单流-化简"><a href="#4-简单流-化简" class="headerlink" title="4) 简单流-化简"></a>4) 简单流-化简</h3><h3 id="5-简单流-收集"><a href="#5-简单流-收集" class="headerlink" title="5) 简单流-收集"></a>5) 简单流-收集</h3><h2 id="综合练习"><a href="#综合练习" class="headerlink" title="综合练习"></a>综合练习</h2><p>✅❌</p>
<h3 id="1）判断语法正确性"><a href="#1）判断语法正确性" class="headerlink" title="1）判断语法正确性"></a>1）判断语法正确性</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Lambda1</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">op</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Lambda2</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">op</span><span class="params">(Object obj)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<ol>
<li><code>Lambda1 lambda = a, b -&gt; a - b</code>  ❌</li>
<li><code>Lambda1 lambda = (c, d) -&gt; c * d</code> ✅</li>
<li><code>Lambda1 lambda = (int a, b) -&gt; a + b</code> ❌</li>
<li><code>Lambda2 lambda = Object a -&gt; System.out.println(a)</code> ❌</li>
</ol>
<h3 id="2）写出等价的-lambda-表达式"><a href="#2）写出等价的-lambda-表达式" class="headerlink" title="2）写出等价的 lambda 表达式"></a>2）写出等价的 lambda 表达式</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(name, student.name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<ol>
<li><p><code>Math::random</code>   </p>
<p><code>()-&gt;Math.random()</code></p>
</li>
<li><p><code>Math::sqrt</code></p>
<p><code>(double number)-&gt;Math.sqrt(number)</code></p>
</li>
<li><p><code>Student::getName</code></p>
<p><code>(Student stu)-&gt;stu.getName()</code></p>
</li>
<li><p><code>Student::setName</code></p>
<p><code>(Student stu, String newName) -&gt; stu.setName(newName)</code></p>
</li>
<li><p><code>Student::hashCode</code></p>
<p><code>(Student stu) -&gt; stu.hashCode()</code></p>
</li>
<li><p><code>Student::equals</code></p>
<p><code>(Student stu, Object o) -&gt; stu.equals(o)</code></p>
</li>
</ol>
<p>假设已有对象 <code>Student stu = new Student("张三");</code></p>
<ol>
<li><p><code>stu::getName</code></p>
<p><code>()-&gt;stu.getName()</code></p>
</li>
<li><p><code>stu::setName</code></p>
<p><code>(String newName)-&gt;stu.setName(newName)</code></p>
</li>
<li><p><code>Student::new</code></p>
<p><code>(String name)-&gt;new Student(name)</code></p>
</li>
</ol>
<h3 id="3）使用函数接口解决问题"><a href="#3）使用函数接口解决问题" class="headerlink" title="3）使用函数接口解决问题"></a>3）使用函数接口解决问题</h3><p>把下列方法中，可能存在变化的部分，抽象为函数对象，从外界传递进来</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">filter</span><span class="params">(List&lt;Integer&gt; list)</span> {</span><br><span class="line">    List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer number : list) {</span><br><span class="line">        <span class="comment">// 筛选：判断是否是偶数，但以后可能改变判断规则</span></span><br><span class="line">        <span class="keyword">if</span>((number &amp; <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">            result.add(number);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;String&gt; <span class="title function_">map</span><span class="params">(List&lt;Integer&gt; list)</span> {</span><br><span class="line">    List&lt;String&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer number : list) {</span><br><span class="line">        <span class="comment">// 转换：将数字转为字符串，但以后可能改变转换规则</span></span><br><span class="line">        result.add(String.valueOf(number));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(List&lt;Integer&gt; list)</span> {</span><br><span class="line">    <span class="keyword">for</span> (Integer number : list) {</span><br><span class="line">        <span class="comment">// 消费：打印，但以后可能改变消费规则</span></span><br><span class="line">        System.out.println(number);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">supply</span><span class="params">(<span class="type">int</span> count)</span> {</span><br><span class="line">    List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">        <span class="comment">// 生成：随机数，但以后可能改变生成规则</span></span><br><span class="line">        result.add(ThreadLocalRandom.current().nextInt());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="4）写出等价的方法引用"><a href="#4）写出等价的方法引用" class="headerlink" title="4）写出等价的方法引用"></a>4）写出等价的方法引用</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Function&lt;String, Integer&gt; lambda = (String s) -&gt; Integer.parseInt(s);</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">BiPredicate&lt;List&lt;String&gt;, String&gt; lambda = (list, element) -&gt; list.contains(element);</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">BiPredicate&lt;Student, Object&gt; lambda = (stu, obj) -&gt; stu.equals(obj);</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Predicate&lt;File&gt; lambda = (file) -&gt; file.exists();</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"></span><br><span class="line">Supplier&lt;Long&gt; lambda = () -&gt; runtime.freeMemory();</span><br></pre></td></tr></tbody></table></figure>



<h3 id="5）补充代码"><a href="#5）补充代码" class="headerlink" title="5）补充代码"></a>5）补充代码</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Color</span><span class="params">(Integer red, Integer green, Integer blue)</span> { }</span><br></pre></td></tr></tbody></table></figure>

<p>如果想用 <code>Color::new</code> 来构造 Color 对象，还应当补充哪些代码</p>
<h3 id="6）实现需求"><a href="#6）实现需求" class="headerlink" title="6）实现需求"></a>6）实现需求</h3><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> { }</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">highOrder</span><span class="params">(Predicate&lt;Student&gt; predicate)</span> {</span><br><span class="line">    List&lt;Student&gt; list = List.of(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张三"</span>, <span class="number">18</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张三"</span>, <span class="number">17</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"张三"</span>, <span class="number">20</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">for</span> (Student stu : list) {</span><br><span class="line">        <span class="keyword">if</span> (predicate.test(stu)) {</span><br><span class="line">            System.out.println(<span class="string">"通过测试"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>传入参数时，分别用</p>
<ul>
<li>类名::静态方法名</li>
<li>类名::非静态方法名</li>
</ul>
<p>来表示【学生年龄大于等于18】的条件</p>
<h1 id="三-Stream-API"><a href="#三-Stream-API" class="headerlink" title="三. Stream API"></a>三. Stream API</h1><h2 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Fruit</span><span class="params">(String cname, String name, String category, String color)</span> { }</span><br><span class="line"></span><br><span class="line">Stream.of(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"草莓"</span>, <span class="string">"Strawberry"</span>, <span class="string">"浆果"</span>, <span class="string">"红色"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"桑葚"</span>, <span class="string">"Mulberry"</span>, <span class="string">"浆果"</span>, <span class="string">"紫色"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"杨梅"</span>, <span class="string">"Waxberry"</span>, <span class="string">"浆果"</span>, <span class="string">"红色"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"核桃"</span>, <span class="string">"Walnut"</span>, <span class="string">"坚果"</span>, <span class="string">"棕色"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"草莓"</span>, <span class="string">"Peanut"</span>, <span class="string">"坚果"</span>, <span class="string">"棕色"</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"蓝莓"</span>, <span class="string">"Blueberry"</span>, <span class="string">"浆果"</span>, <span class="string">"蓝色"</span>)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>



<p><img src="/img/load.gif" data-original="/images/programmer/Java/b/1.png"></p>
<p>找到所有浆果</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.filter(f -&gt; f.category.equals(<span class="string">"浆果"</span>))</span><br></pre></td></tr></tbody></table></figure>

<p>找到蓝色的浆果</p>
<p>方法1：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.filter(f -&gt; f.category().equals(<span class="string">"浆果"</span>) &amp;&amp; f.color().equals(<span class="string">"蓝色"</span>))</span><br></pre></td></tr></tbody></table></figure>



<p>方法2：让每个 lambda 只做一件事，两次 filter 相对于并且关系</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.filter(f -&gt; f.category.equals(<span class="string">"浆果"</span>))</span><br><span class="line">.filter(f -&gt; f.color().equals(<span class="string">"蓝色"</span>))</span><br></pre></td></tr></tbody></table></figure>



<p>方法3：让每个 lambda 只做一件事，不过比方法2强的地方可以 or，and，nagate 运算</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.filter(((Predicate&lt;Fruit&gt;) f -&gt; f.category.equals(<span class="string">"浆果"</span>)).and(f -&gt; f.color().equals(<span class="string">"蓝色"</span>)))</span><br></pre></td></tr></tbody></table></figure>





<h2 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h2><p><img src="/img/load.gif" data-original="/images/programmer/Java/b/2.png"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.map(f -&gt; f.cname() + <span class="string">"酱"</span>)</span><br></pre></td></tr></tbody></table></figure>



<h2 id="降维"><a href="#降维" class="headerlink" title="降维"></a>降维</h2><p>例1</p>
<p><img src="/img/load.gif" data-original="/images/programmer/Java/b/image-20240301105938703.png" alt="image-20240301105938703"></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.of(</span><br><span class="line">        List.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"草莓"</span>, <span class="string">"Strawberry"</span>, <span class="string">"浆果"</span>, <span class="string">"红色"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"桑葚"</span>, <span class="string">"Mulberry"</span>, <span class="string">"浆果"</span>, <span class="string">"紫色"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"杨梅"</span>, <span class="string">"Waxberry"</span>, <span class="string">"浆果"</span>, <span class="string">"红色"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"蓝莓"</span>, <span class="string">"Blueberry"</span>, <span class="string">"浆果"</span>, <span class="string">"蓝色"</span>)</span><br><span class="line">        ),</span><br><span class="line">        List.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"核桃"</span>, <span class="string">"Walnut"</span>, <span class="string">"坚果"</span>, <span class="string">"棕色"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">"草莓"</span>, <span class="string">"Peanut"</span>, <span class="string">"坚果"</span>, <span class="string">"棕色"</span>)</span><br><span class="line">        )</span><br><span class="line">)</span><br><span class="line">    </span><br><span class="line">.flatMap(Collection::stream)    </span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>这样把坚果和浆果两个集合变成了含六个元素的水果流</li>
</ul>
<p>例2：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.of(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="number">1</span>, List.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">6499</span>, <span class="number">1</span>, <span class="string">"HUAWEI MateBook 14s"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">6999</span>, <span class="number">1</span>, <span class="string">"HUAWEI Mate 60 Pro"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">1488</span>, <span class="number">1</span>, <span class="string">"HUAWEI WATCH GT 4"</span>)</span><br><span class="line">        )),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Order</span>(<span class="number">1</span>, List.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">8999</span>, <span class="number">1</span>, <span class="string">"Apple MacBook Air 13"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">7999</span>, <span class="number">1</span>, <span class="string">"Apple iPhone 15 Pro"</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">2999</span>, <span class="number">1</span>, <span class="string">"Apple Watch Series 9"</span>)</span><br><span class="line">        ))</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>想逐一处理每个订单中的商品</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.flatMap(order -&gt; order.items().stream())</span><br></pre></td></tr></tbody></table></figure>

<p>这样把一个有两个元素的订单流，变成了一个有六个元素的商品流</p>
<h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><p>根据已有的数组构建流</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Arrays.stream(array)</span><br></pre></td></tr></tbody></table></figure>

<p>根据已有的 Collection 构建流（包括 List，Set 等）</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">List.of(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>).stream()</span><br></pre></td></tr></tbody></table></figure>

<p>把一个对象变成流</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.of(<span class="string">"d"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>把多个对象变成流</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.of(<span class="string">"x"</span>, <span class="string">"y"</span>)</span><br></pre></td></tr></tbody></table></figure>



<h2 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h2><p>两个流拼接</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.concat(Stream.of(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>), Stream.of(<span class="string">"d"</span>))</span><br></pre></td></tr></tbody></table></figure>



<h2 id="截取"><a href="#截取" class="headerlink" title="截取"></a>截取</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.concat(Stream.of(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>), Stream.of(<span class="string">"d"</span>))</span><br><span class="line">    .skip(<span class="number">1</span>)</span><br><span class="line">    .limit(<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>skip 是跳过几个元素</p>
</li>
<li><p>limit 是限制处理的元素个数</p>
</li>
<li><p>dropWhile 是 drop 流中元素，直到条件不成立，留下剩余元素</p>
</li>
<li><p>takeWhile 是 take 流中元素，直到条件不成立，舍弃剩余元素</p>
</li>
</ul>
<h2 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h2><p>生成从 0 ~ 9 的数字</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">IntStream.range(<span class="number">0</span>, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">IntStream.rangeClosed(<span class="number">0</span>, <span class="number">9</span>)</span><br></pre></td></tr></tbody></table></figure>



<p>如果想订制，可以用 iterate 方法，例如下面生成奇数序列</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">IntStream.iterate(<span class="number">1</span>, x -&gt; x + <span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数1 是初始值</li>
<li>参数2 是一个特殊 Function，即参数类型与返回值相同，它会根据上一个元素 x 的值计算出当前元素</li>
<li>需要用 limit 限制元素个数</li>
</ul>
<p>也可以用 iterate 的重载方法</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">IntStream.iterate(<span class="number">1</span>, x -&gt; x &lt; <span class="number">10</span>, x -&gt; x + <span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>参数1 是初始值</li>
<li>参数2 用来限制元素个数，一旦不满足此条件，流就结束</li>
<li>参数3 相当于上个方法的参数2</li>
</ul>
<p>iterate 的特点是根据上一个元素计算当前元素，如果不需要依赖上一个元素，可以改用 generate 方法</p>
<p>例如下面是生成 5 个随机 int</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.generate(()-&gt; ThreadLocalRandom.current().nextInt()).limit(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>不过如果只是生成随机数的话，有更简单的办法</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ThreadLocalRandom.current().ints(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>如果要指定上下限，例如下面是生成从 0~9 的100个随机数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">ThreadLocalRandom.current().ints(<span class="number">100</span>, <span class="number">0</span>, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>



<h2 id="查找与判断"><a href="#查找与判断" class="headerlink" title="查找与判断"></a>查找与判断</h2><p>下面的代码找到流中任意（Any）一个偶数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span>[] array = {<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>};</span><br><span class="line"></span><br><span class="line">Arrays.stream(array)</span><br><span class="line">    .filter(x -&gt; (x &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">    .findAny()</span><br><span class="line">    .ifPresent(System.out::println);</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>注意 findAny 返回的是 OptionalInt 对象，因为可能流中不存在偶数</li>
<li>对于 OptionalInt 对象，一般需要用 ifPresent 或 orElse（提供默认值）来处理</li>
</ul>
<p>与 findAny 比较类似的是 firstFirst，它俩的区别</p>
<ul>
<li>findAny 是找在流中任意位置的元素，不需要考虑顺序，对于上例返回 6 也是可以的</li>
<li>findFirst 是找第一个出现在元素，需要考虑顺序，对于上例只能返回 4</li>
<li>findAny 在顺序流中与 findFirst 表现相同，区别在于并行流下会更快</li>
</ul>
<p>判断流中是否存在任意一个偶数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Arrays.stream(array).anyMatch(x -&gt; (x &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>它返回的是 boolean 值，可以直接用来判断</li>
</ul>
<p>判断流是否全部是偶数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Arrays.stream(array).allMatch(x -&gt; (x &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>同样，它返回的是 boolean 值，可以直接用来判断</li>
</ul>
<p>判断流是否全部不是偶数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Arrays.stream(array).noneMatch(x -&gt; (x &amp; <span class="number">1</span>) == <span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>noneMatch 与 allMatch 含义恰好相反</li>
</ul>
<h2 id="排序与去重"><a href="#排序与去重" class="headerlink" title="排序与去重"></a>排序与去重</h2><p>已知有数据</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Hero</span><span class="params">(String name, <span class="type">int</span> strength)</span> { }</span><br><span class="line"></span><br><span class="line">Stream.of(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"独孤求败"</span>, <span class="number">100</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"令狐冲"</span>, <span class="number">90</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"风清扬"</span>, <span class="number">98</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"东方不败"</span>, <span class="number">98</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"方证"</span>, <span class="number">92</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"任我行"</span>, <span class="number">92</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"冲虚"</span>, <span class="number">90</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"向问天"</span>, <span class="number">88</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Hero</span>(<span class="string">"不戒"</span>, <span class="number">88</span>)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>要求，首先按 strength 武力排序（逆序），武力相同的，按姓名长度排序（正序）</p>
<p>仅用 lambda 来解</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.sorted((a,b)-&gt; {</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> Integer.compare(b.strength(), a.strength());</span><br><span class="line">    <span class="keyword">return</span> (res == <span class="number">0</span>) ? Integer.compare(a.nameLength(), b.nameLength()) : res; </span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>方法引用改写</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.sorted(</span><br><span class="line">    Comparator.comparingInt(Hero::strength)</span><br><span class="line">      .reversed()</span><br><span class="line">      .thenComparingInt(Hero::nameLength)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>其中：</p>
<ul>
<li>comparingInt 接收一个 key 提取器（说明按对象中哪部分来比较），返回一个比较器</li>
<li>reversed 返回一个顺序相反的比较器</li>
<li>thenComparingInt 接收一个 key 提取器，返回一个新比较器，新比较器在原有比较器结果相等时执行新的比较逻辑</li>
</ul>
<p>增加一个辅助方法</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">record</span> <span class="title class_">Hero</span><span class="params">(String name, <span class="type">int</span> strength)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">nameLength</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name.length();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>原理：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.sorted((e, f) -&gt; {</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span></span><br><span class="line">        ((Comparator&lt;Hero&gt;) (c, d) -&gt;</span><br><span class="line">            ((Comparator&lt;Hero&gt;) (a, b) -&gt; Integer.compare(a.strength(), b.strength()))</span><br><span class="line">                .compare(d, c))</span><br><span class="line">            .compare(e, f);</span><br><span class="line">    <span class="keyword">return</span> (res == <span class="number">0</span>) ? Integer.compare(e.nameLength(), f.nameLength()) : res;</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>如果不好看，改成下面的代码</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">.sorted(step3(step2(step1())))</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Comparator&lt;Hero&gt; <span class="title function_">step1</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> (a, b) -&gt; Integer.compare(a.strength(), b.strength());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Comparator&lt;Hero&gt; <span class="title function_">step2</span><span class="params">(Comparator&lt;Hero&gt; step1)</span> {</span><br><span class="line">    <span class="keyword">return</span> (c, d) -&gt; step1.compare(d, c);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> Comparator&lt;Hero&gt; <span class="title function_">step3</span><span class="params">(Comparator&lt;Hero&gt; step2)</span> {</span><br><span class="line">    <span class="keyword">return</span> (e, f) -&gt; {</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> step2.compare(e, f);</span><br><span class="line">        <span class="keyword">return</span> (res == <span class="number">0</span>) ? Integer.compare(e.nameLength(), f.nameLength()) : res;</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="化简"><a href="#化简" class="headerlink" title="化简"></a>化简</h2><p><code>reduce(init, (p,x) -&gt; r)</code></p>
<ul>
<li>init 代表初始值</li>
<li><code>(p,x) -&gt; r</code> 是一个 BinaryOperator，作用是根据上次化简结果 p 和当前元素 x，得到本次化简结果 r</li>
</ul>
<p>这样两两化简，可以将流中的所有元素合并成一个结果</p>
<h2 id="收集"><a href="#收集" class="headerlink" title="收集"></a>收集</h2><p>collect( supplier, accumulator, combiner)</p>
<ul>
<li>supplier 是描述如何创建收集容器 c ：<code>()-&gt; c</code></li>
<li>accumulator 是描述如何向容器 c 添加元素 x：<code>(c, x) -&gt; void</code></li>
<li>combiner 是描述如何合并两个容器：<code>(c1, c2) -&gt; void</code><ul>
<li>串行流下不需要合并容器</li>
<li>并行流如果用的是并发容器，也不需要合并</li>
</ul>
</li>
</ul>
<h2 id="收集器"><a href="#收集器" class="headerlink" title="收集器"></a>收集器</h2><p>Collectors 类中提供了很多现成的收集器，详情见网页</p>
<h2 id="下游收集器"><a href="#下游收集器" class="headerlink" title="下游收集器"></a>下游收集器</h2><p>做 groupingBy 分组收集时，组内可能需要进一步的数据收集，称为下游收集器，详情见网页</p>
<h2 id="基本流"><a href="#基本流" class="headerlink" title="基本流"></a>基本流</h2><p>基本类型流指 IntStream、LongStream 和 DoubleStream，它们在做数值计算时有更好的性能。</p>
<p>转换成基本流</p>
<ul>
<li>mapToInt</li>
<li>mapToLong</li>
<li>mapToDouble</li>
<li>flatMapToInt</li>
<li>flatMapToLong</li>
<li>flatMapToDouble</li>
<li>mapMultiToInt</li>
<li>mapMultiToLong</li>
<li>mapMultiToDouble</li>
</ul>
<p>基本流转对象流</p>
<ul>
<li>mapToObj</li>
<li>boxed</li>
</ul>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ol>
<li>一次使用：流只能使用一次（终结方法只能调用一次）</li>
<li>两类操作：<ol>
<li>中间操作，lazy 懒惰的</li>
<li>终结操作，eager 迫切的</li>
</ol>
</li>
</ol>
<h2 id="并行"><a href="#并行" class="headerlink" title="并行"></a>并行</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    .parallel()</span><br><span class="line">    .collect(Collector.of(</span><br><span class="line">            () -&gt; {</span><br><span class="line">                System.out.printf(<span class="string">"%-12s %s%n"</span>,simple(),<span class="string">"create"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">            },</span><br><span class="line">            (list, x) -&gt; {</span><br><span class="line">                List&lt;Integer&gt; old = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list);</span><br><span class="line">                list.add(x);</span><br><span class="line">                System.out.printf(<span class="string">"%-12s %s.add(%d)=&gt;%s%n"</span>,simple(), old, x, list);</span><br><span class="line">            },</span><br><span class="line">            (list1, list2) -&gt; {</span><br><span class="line">                List&lt;Integer&gt; old = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list1);</span><br><span class="line">                list1.addAll(list2);</span><br><span class="line">                System.out.printf(<span class="string">"%-12s %s.add(%s)=&gt;%s%n"</span>, simple(),old, list2, list1);</span><br><span class="line">                <span class="keyword">return</span> list1;</span><br><span class="line">            },</span><br><span class="line">            list -&gt; list,</span><br><span class="line">            Collector.Characteristics.IDENTITY_FINISH</span><br><span class="line">    ));</span><br></pre></td></tr></tbody></table></figure>



<h2 id="效率"><a href="#效率" class="headerlink" title="效率"></a>效率</h2><h3 id="1-数组求和"><a href="#1-数组求和" class="headerlink" title="1) 数组求和"></a>1) 数组求和</h3><p>其中</p>
<ul>
<li>primitive 用 loop 循环对 int 求和</li>
<li>intStream 用 IntStream 对 int 求和</li>
<li>boxed 用 loop 循环对 Integer 求和</li>
<li>stream 用 Stream 对 Integer 求和</li>
</ul>
<p>元素个数 100</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T01Sum.primitive</td>
<td>avgt</td>
<td>5</td>
<td>25.424</td>
<td>± 0.782</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.intStream</td>
<td>avgt</td>
<td>5</td>
<td>47.482</td>
<td>± 1.145</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.boxed</td>
<td>avgt</td>
<td>5</td>
<td>72.457</td>
<td>± 4.136</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.stream</td>
<td>avgt</td>
<td>5</td>
<td>465.141</td>
<td>± 4.891</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 1000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T01Sum.primitive</td>
<td>avgt</td>
<td>5</td>
<td>270.556</td>
<td>± 1.277</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.intStream</td>
<td>avgt</td>
<td>5</td>
<td>292.467</td>
<td>± 10.987</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.boxed</td>
<td>avgt</td>
<td>5</td>
<td>583.929</td>
<td>± 57.338</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.stream</td>
<td>avgt</td>
<td>5</td>
<td>5948.294</td>
<td>± 2209.211</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 10000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T01Sum.primitive</td>
<td>avgt</td>
<td>5</td>
<td>2681.651</td>
<td>± 12.614</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.intStream</td>
<td>avgt</td>
<td>5</td>
<td>2718.408</td>
<td>± 52.418</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.boxed</td>
<td>avgt</td>
<td>5</td>
<td>6391.285</td>
<td>± 358.154</td>
<td>ns/op</td>
</tr>
<tr>
<td>T01Sum.stream</td>
<td>avgt</td>
<td>5</td>
<td>44414.884</td>
<td>± 3213.055</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>结论：</p>
<ul>
<li>做数值计算，优先挑选基本流（IntStream 等）在数据量较大时，它的性能已经非常接近普通 for 循环</li>
<li>做数值计算，应当避免普通流（Stream）性能与其它几种相比，慢一个数量级</li>
</ul>
<h3 id="2-求最大值"><a href="#2-求最大值" class="headerlink" title="2) 求最大值"></a>2) 求最大值</h3><p>其中（原始数据都是 int，没有包装类）</p>
<ul>
<li>custom 自定义多线程并行求最大值</li>
<li>parallel 并行流求最大值</li>
<li>sequence 串行流求最大值</li>
<li>primitive loop 循环求最大值</li>
</ul>
<p>元素个数 100</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T02Parallel.custom</td>
<td>avgt</td>
<td>5</td>
<td>39619.796</td>
<td>± 1263.036</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.parallel</td>
<td>avgt</td>
<td>5</td>
<td>6754.239</td>
<td>± 79.894</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.primitive</td>
<td>avgt</td>
<td>5</td>
<td>29.538</td>
<td>± 3.056</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.sequence</td>
<td>avgt</td>
<td>5</td>
<td>80.170</td>
<td>± 1.940</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 10000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T02Parallel.custom</td>
<td>avgt</td>
<td>5</td>
<td>41656.093</td>
<td>± 1537.237</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.parallel</td>
<td>avgt</td>
<td>5</td>
<td>11218.573</td>
<td>± 1994.863</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.primitive</td>
<td>avgt</td>
<td>5</td>
<td>2217.562</td>
<td>± 80.981</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.sequence</td>
<td>avgt</td>
<td>5</td>
<td>5682.482</td>
<td>± 264.645</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 1000000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>T02Parallel.custom</td>
<td>avgt</td>
<td>5</td>
<td>194984.564</td>
<td>± 25794.484</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.parallel</td>
<td>avgt</td>
<td>5</td>
<td>298940.794</td>
<td>± 31944.959</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.primitive</td>
<td>avgt</td>
<td>5</td>
<td>325178.873</td>
<td>± 81314.981</td>
<td>ns/op</td>
</tr>
<tr>
<td>T02Parallel.sequence</td>
<td>avgt</td>
<td>5</td>
<td>618274.062</td>
<td>± 5867.812</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>结论：</p>
<ul>
<li>并行流相对自己用多线程实现分而治之更简洁</li>
<li>并行流只有在数据量非常大时，才能充分发力，数据量少，还不如用串行流</li>
</ul>
<h3 id="3-并行-发-收集"><a href="#3-并行-发-收集" class="headerlink" title="3) 并行(发)收集"></a>3) 并行(发)收集</h3><p>元素个数 100</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>loop1</td>
<td>avgt</td>
<td>5</td>
<td>1312.389</td>
<td>±  90.683</td>
<td>ns/op</td>
</tr>
<tr>
<td>loop2</td>
<td>avgt</td>
<td>5</td>
<td>1776.391</td>
<td>± 255.271</td>
<td>ns/op</td>
</tr>
<tr>
<td>sequence</td>
<td>avgt</td>
<td>5</td>
<td>1727.739</td>
<td>±  28.821</td>
<td>ns/op</td>
</tr>
<tr>
<td>parallelNoConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>27654.004</td>
<td>± 496.970</td>
<td>ns/op</td>
</tr>
<tr>
<td>parallelConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>16320.113</td>
<td>± 344.766</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 10000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ns/op)</th>
<th>Error (ns/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>loop1</td>
<td>avgt</td>
<td>5</td>
<td>211526.546</td>
<td>± 13549.703</td>
<td>ns/op</td>
</tr>
<tr>
<td>loop2</td>
<td>avgt</td>
<td>5</td>
<td>203794.146</td>
<td>± 3525.972</td>
<td>ns/op</td>
</tr>
<tr>
<td>sequence</td>
<td>avgt</td>
<td>5</td>
<td>237688.651</td>
<td>±  7593.483</td>
<td>ns/op</td>
</tr>
<tr>
<td>parallelNoConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>527203.976</td>
<td>±  3496.107</td>
<td>ns/op</td>
</tr>
<tr>
<td>parallelConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>369630.728</td>
<td>± 20549.731</td>
<td>ns/op</td>
</tr>
</tbody></table>
<p>元素个数 1000000</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score (ms/op)</th>
<th>Error (ms/op)</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>loop1</td>
<td>avgt</td>
<td>5</td>
<td>69.154</td>
<td>± 3.456</td>
<td>ms/op</td>
</tr>
<tr>
<td>loop2</td>
<td>avgt</td>
<td>5</td>
<td>83.815</td>
<td>± 2.307</td>
<td>ms/op</td>
</tr>
<tr>
<td>sequence</td>
<td>avgt</td>
<td>5</td>
<td>103.585</td>
<td>± 0.834</td>
<td>ns/op</td>
</tr>
<tr>
<td>parallelNoConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>167.032</td>
<td>± 15.406</td>
<td>ms/op</td>
</tr>
<tr>
<td>parallelConcurrent</td>
<td>avgt</td>
<td>5</td>
<td>52.326</td>
<td>± 1.501</td>
<td>ms/op</td>
</tr>
</tbody></table>
<p>结论：</p>
<ul>
<li>sequence 是一个容器单线程收集，数据量少时性能占优</li>
<li>parallelNoConcurrent 是多个容器多线程并行收集，时间应该花费在合并容器上，性能最差</li>
<li>parallelConcurrent 是一个容器多线程并发收集，在数据量大时性能较优</li>
</ul>
<h3 id="4）MethodHandle-性能"><a href="#4）MethodHandle-性能" class="headerlink" title="4）MethodHandle 性能"></a>4）MethodHandle 性能</h3><p>正常方法调用、反射、MethodHandle、Lambda 的性能对比</p>
<table>
<thead>
<tr>
<th>Benchmark</th>
<th>Mode</th>
<th>Cnt</th>
<th>Score</th>
<th>Error</th>
<th>Units</th>
</tr>
</thead>
<tbody><tr>
<td>Sample2.lambda</td>
<td>thrpt</td>
<td>5</td>
<td>389307532.881</td>
<td>± 332213073.039</td>
<td>ops/s</td>
</tr>
<tr>
<td>Sample2.method</td>
<td>thrpt</td>
<td>5</td>
<td>157556577.611</td>
<td>± 4048306.620</td>
<td>ops/s</td>
</tr>
<tr>
<td>Sample2.origin</td>
<td>thrpt</td>
<td>5</td>
<td>413287866.949</td>
<td>± 65182730.966</td>
<td>ops/s</td>
</tr>
<tr>
<td>Sample2.reflection</td>
<td>thrpt</td>
<td>5</td>
<td>91640751.456</td>
<td>± 37969233.369</td>
<td>ops/s</td>
</tr>
</tbody></table>
<h2 id="综合练习-1"><a href="#综合练习-1" class="headerlink" title="综合练习"></a>综合练习</h2><ol>
<li><p>将 filter 的课堂例题修改为方法引用方式实现</p>
</li>
<li><p>takeWhile 与 filter 的区别</p>
</li>
<li><p>三级排序</p>
</li>
<li><p>包含 null 值的排序</p>
</li>
<li><p>二维流扁平映射</p>
</li>
<li><p>三维流扁平映射</p>
</li>
<li><p>用 stream 打印九九乘法表</p>
</li>
<li><p>用 stream 生成斐波那契数列的前 10 项</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Stream.iterate(<span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">1</span>, <span class="number">1</span>}, x -&gt; <span class="keyword">new</span> <span class="title class_">int</span>[]{x[<span class="number">1</span>], x[<span class="number">0</span>] + x[<span class="number">1</span>]})</span><br><span class="line">    .map(x -&gt; x[<span class="number">0</span>])</span><br><span class="line">    .limit(<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>自定义 Collector 求平均</p>
</li>
</ol>
<h1 id="四-实际应用"><a href="#四-实际应用" class="headerlink" title="四. 实际应用"></a>四. 实际应用</h1><h2 id="数据统计分析"><a href="#数据统计分析" class="headerlink" title="数据统计分析"></a>数据统计分析</h2><h3 id="1）每月的销售量"><a href="#1）每月的销售量" class="headerlink" title="1）每月的销售量"></a>1）每月的销售量</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1970-01 订单数1307</span><br><span class="line">2020-01 订单数14270</span><br><span class="line">2020-02 订单数17995</span><br><span class="line">2020-03 订单数18688</span><br><span class="line">2020-04 订单数11868</span><br><span class="line">2020-05 订单数40334</span><br><span class="line">2020-06 订单数41364</span><br><span class="line">2020-07 订单数76418</span><br><span class="line">2020-08 订单数100007</span><br><span class="line">2020-09 订单数70484</span><br><span class="line">2020-10 订单数104063</span><br><span class="line">2020-11 订单数66060</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>其中 1970-01 应该是数据的问题</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; YearMonth.from(formatter.parse(a[TIME])), </span><br><span class="line">                        TreeMap::<span class="keyword">new</span>, counting()))</span><br><span class="line">    .forEach((k, v) -&gt; {</span><br><span class="line">        System.out.println(k + <span class="string">" 订单数 "</span> + v);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>



<h3 id="2）销量最高的月份"><a href="#2）销量最高的月份" class="headerlink" title="2）销量最高的月份"></a>2）销量最高的月份</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1970-01 订单数1307</span><br><span class="line">2020-01 订单数14270</span><br><span class="line">2020-02 订单数17995</span><br><span class="line">2020-03 订单数18688</span><br><span class="line">2020-04 订单数11868</span><br><span class="line">2020-05 订单数40334</span><br><span class="line">2020-06 订单数41364</span><br><span class="line">2020-07 订单数76418</span><br><span class="line">2020-08 订单数100007</span><br><span class="line">2020-09 订单数70484</span><br><span class="line">2020-10 订单数104063  *</span><br><span class="line">2020-11 订单数66060</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; YearMonth.from(formatter.parse(a[TIME])), counting()))</span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .max(Comparator.comparingLong(Map.Entry::getValue))</span><br><span class="line">    <span class="comment">// 也可以用 Map.Entry.comparingByValue()</span></span><br><span class="line">    .orElse(<span class="literal">null</span>);</span><br></pre></td></tr></tbody></table></figure>



<h3 id="3）求销量最高的商品"><a href="#3）求销量最高的商品" class="headerlink" title="3）求销量最高的商品"></a>3）求销量最高的商品</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1515966223517846928=2746</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; a[PRODUCT_ID], counting()))</span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .max(Comparator.comparingLong(Map.Entry::getValue))</span><br><span class="line">    .orElse(<span class="literal">null</span>);</span><br></pre></td></tr></tbody></table></figure>



<h3 id="4）下单最多的前10用户"><a href="#4）下单最多的前10用户" class="headerlink" title="4）下单最多的前10用户"></a>4）下单最多的前10用户</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1.515915625512423e+18 订单数1092</span><br><span class="line">1.5159156255121183e+18 订单数1073</span><br><span class="line">1.515915625512378e+18 订单数1040</span><br><span class="line">1.515915625512377e+18 订单数1028</span><br><span class="line">1.5159156255136955e+18 订单数1002</span><br><span class="line">1.515915625512422e+18 订单数957</span><br><span class="line">1.515915625513446e+18 订单数957</span><br><span class="line">1.515915625513447e+18 订单数928</span><br><span class="line">1.515915625514598e+18 订单数885</span><br><span class="line">1.5159156255147195e+18 订单数869</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; a[USER_ID], counting()))</span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .sorted(Map.Entry.&lt;String, Long&gt;comparingByValue().reversed())</span><br><span class="line">    .limit(<span class="number">10</span>).forEach(e -&gt; {</span><br><span class="line">        System.out.println(e.getKey() + <span class="string">" 订单数 "</span> + e.getValue());</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>

<p>或者</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyQueue</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">PriorityQueue</span>&lt;E&gt; {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> max;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">(Comparator&lt;? <span class="built_in">super</span> E&gt; comparator, <span class="type">int</span> max)</span> {</span><br><span class="line">        <span class="built_in">super</span>(comparator);</span><br><span class="line">        <span class="built_in">this</span>.max = max;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E e)</span> {</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">r</span> <span class="operator">=</span> <span class="built_in">super</span>.offer(e);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.size() &gt; max) {</span><br><span class="line">            <span class="built_in">this</span>.poll();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; a[USER_ID], counting()))</span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .parallel()</span><br><span class="line">    .collect(</span><br><span class="line">            () -&gt; <span class="keyword">new</span> <span class="title class_">MyQueue</span>&lt;&gt;(Map.Entry.comparingByValue(), <span class="number">10</span>),</span><br><span class="line">            MyQueue::offer,</span><br><span class="line">            AbstractQueue::addAll</span><br><span class="line">    );</span><br></pre></td></tr></tbody></table></figure>



<h3 id="5-1）每个地区下单最多的用户"><a href="#5-1）每个地区下单最多的用户" class="headerlink" title="5.1）每个地区下单最多的用户"></a>5.1）每个地区下单最多的用户</h3><p>结果应为：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">上海=Optional[1.5159156255127636e+18=634]</span><br><span class="line">广东=Optional[1.515915625512377e+18=1028]</span><br><span class="line">天津=Optional[1.5159156255120858e+18=530]</span><br><span class="line">四川=Optional[1.5159156255121551e+18=572]</span><br><span class="line">浙江=Optional[1.5159156255121183e+18=564]</span><br><span class="line">重庆=Optional[1.515915625512764e+18=632]</span><br><span class="line">湖北=Optional[1.5159156255121183e+18=509]</span><br><span class="line">湖南=Optional[1.5159156255120548e+18=545]</span><br><span class="line">江苏=Optional[1.5159156255122386e+18=551]</span><br><span class="line">海南=Optional[1.5159156255121178e+18=556]</span><br><span class="line">北京=Optional[1.5159156255128172e+18=584]</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(line -&gt; line.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(array -&gt; array[USER_REGION], </span><br><span class="line">                        groupingBy(array -&gt; array[USER_ID], counting())))</span><br><span class="line">    .entrySet().stream()</span><br><span class="line">    .map(e -&gt; Map.entry(</span><br><span class="line">            e.getKey(),</span><br><span class="line">            e.getValue().entrySet().stream().max(Map.Entry.comparingByValue())</span><br><span class="line">    ))</span><br><span class="line">    .forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure>



<h3 id="5-2）每个地区下单最多的前3用户"><a href="#5-2）每个地区下单最多的前3用户" class="headerlink" title="5.2）每个地区下单最多的前3用户"></a>5.2）每个地区下单最多的前3用户</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">上海</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255127636e+18=634</span><br><span class="line">1.515915625512118e+18=583</span><br><span class="line">1.515915625512422e+18=561</span><br><span class="line">广东</span><br><span class="line">--------------------------</span><br><span class="line">1.515915625512377e+18=1028</span><br><span class="line">1.5159156255121544e+18=572</span><br><span class="line">1.5159156255120845e+18=571</span><br><span class="line">天津</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255120858e+18=530</span><br><span class="line">1.5159156255122383e+18=504</span><br><span class="line">1.5159156255123333e+18=481</span><br><span class="line">四川</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255121551e+18=572</span><br><span class="line">1.5159156255123768e+18=568</span><br><span class="line">1.515915625512055e+18=552</span><br><span class="line">浙江</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255121183e+18=564</span><br><span class="line">1.515915625513058e+18=520</span><br><span class="line">1.515915625512423e+18=513</span><br><span class="line">重庆</span><br><span class="line">--------------------------</span><br><span class="line">1.515915625512764e+18=632</span><br><span class="line">1.5159156255121188e+18=572</span><br><span class="line">1.515915625512085e+18=562</span><br><span class="line">湖北</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255121183e+18=509</span><br><span class="line">1.515915625512818e+18=508</span><br><span class="line">1.5159156255148017e+18=386</span><br><span class="line">湖南</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255120548e+18=545</span><br><span class="line">1.5159156255120855e+18=543</span><br><span class="line">1.5159156255134449e+18=511</span><br><span class="line">江苏</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255122386e+18=551</span><br><span class="line">1.5159156255122842e+18=541</span><br><span class="line">1.5159156255120842e+18=499</span><br><span class="line">海南</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255121178e+18=556</span><br><span class="line">1.5159156255128174e+18=547</span><br><span class="line">1.5159156255122022e+18=545</span><br><span class="line">北京</span><br><span class="line">--------------------------</span><br><span class="line">1.5159156255128172e+18=584</span><br><span class="line">1.515915625512423e+18=579</span><br><span class="line">1.5159156255123786e+18=558</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .collect(groupingBy(a -&gt; a[USER_REGION], groupingBy(a -&gt; a[USER_ID], counting())))</span><br><span class="line">    <span class="comment">/*.forEach((k,v)-&gt;{</span></span><br><span class="line"><span class="comment">        System.out.println(k);</span></span><br><span class="line"><span class="comment">        System.out.println("---------------");</span></span><br><span class="line"><span class="comment">        v.forEach((x,y)-&gt;{</span></span><br><span class="line"><span class="comment">            System.out.println(x + ":" + y);</span></span><br><span class="line"><span class="comment">        });</span></span><br><span class="line"><span class="comment">    });*/</span></span><br><span class="line">    .entrySet()</span><br><span class="line">    .stream()</span><br><span class="line">    .map(e -&gt;</span><br><span class="line">        Map.entry(</span><br><span class="line">            e.getKey(),</span><br><span class="line">            e.getValue().entrySet().stream()</span><br><span class="line">                .sorted(Map.Entry.&lt;String, Long&gt;comparingByValue().reversed())</span><br><span class="line">            	.limit(<span class="number">3</span>)</span><br><span class="line">            	.toList()</span><br><span class="line">        )</span><br><span class="line">    ).forEach(e -&gt; {</span><br><span class="line">        System.out.println(e.getKey());</span><br><span class="line">        System.out.println(<span class="string">"--------------------------"</span>);</span><br><span class="line">        e.getValue().forEach(System.out::println);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>



<h3 id="6-1）按类别统计销量"><a href="#6-1）按类别统计销量" class="headerlink" title="6.1）按类别统计销量"></a>6.1）按类别统计销量</h3><p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">accessories.bag 订单数 3063</span><br><span class="line">accessories.umbrella 订单数 33</span><br><span class="line">apparel.costume 订单数 2</span><br><span class="line">apparel.glove 订单数 1942</span><br><span class="line">apparel.shirt 订单数 235</span><br><span class="line">apparel.shoes 订单数 2</span><br><span class="line">apparel.sock 订单数 21</span><br><span class="line">apparel.trousers 订单数 99</span><br><span class="line">apparel.tshirt 订单数 372</span><br><span class="line">appliances.environment.air_conditioner 订单数 7379</span><br><span class="line">appliances.environment.air_heater 订单数 2599</span><br><span class="line">appliances.environment.climate 订单数 101</span><br><span class="line">appliances.environment.fan 订单数 3855</span><br><span class="line">appliances.environment.vacuum 订单数 15971</span><br><span class="line">appliances.environment.water_heater 订单数 3644</span><br><span class="line">appliances.iron 订单数 8249</span><br><span class="line">appliances.ironing_board 订单数 2128</span><br><span class="line">appliances.kitchen.blender 订单数 8672</span><br><span class="line">appliances.kitchen.coffee_grinder 订单数 811</span><br><span class="line">appliances.kitchen.coffee_machine 订单数 1250</span><br><span class="line">appliances.kitchen.dishwasher 订单数 2663</span><br><span class="line">appliances.kitchen.fryer 订单数 97</span><br><span class="line">appliances.kitchen.grill 订单数 1579</span><br><span class="line">appliances.kitchen.hood 订单数 9045</span><br><span class="line">appliances.kitchen.juicer 订单数 1187</span><br><span class="line">appliances.kitchen.kettle 订单数 12740</span><br><span class="line">appliances.kitchen.meat_grinder 订单数 4520</span><br><span class="line">appliances.kitchen.microwave 订单数 7615</span><br><span class="line">appliances.kitchen.mixer 订单数 2610</span><br><span class="line">appliances.kitchen.oven 订单数 4000</span><br><span class="line">appliances.kitchen.refrigerators 订单数 20259</span><br><span class="line">appliances.kitchen.steam_cooker 订单数 464</span><br><span class="line">appliances.kitchen.toster 订单数 1381</span><br><span class="line">appliances.kitchen.washer 订单数 14563</span><br><span class="line">appliances.personal.hair_cutter 订单数 2716</span><br><span class="line">appliances.personal.massager 订单数 1724</span><br><span class="line">appliances.personal.scales 订单数 6727</span><br><span class="line">appliances.sewing_machine 订单数 1576</span><br><span class="line">appliances.steam_cleaner 订单数 119</span><br><span class="line">auto.accessories.alarm 订单数 252</span><br><span class="line">auto.accessories.anti_freeze 订单数 109</span><br><span class="line">auto.accessories.compressor 订单数 276</span><br><span class="line">auto.accessories.player 订单数 117</span><br><span class="line">auto.accessories.radar 订单数 80</span><br><span class="line">auto.accessories.videoregister 订单数 533</span><br><span class="line">computers.components.cdrw 订单数 158</span><br><span class="line">computers.components.cooler 订单数 3377</span><br><span class="line">computers.components.cpu 订单数 4147</span><br><span class="line">computers.components.hdd 订单数 5054</span><br><span class="line">computers.components.memory 订单数 1597</span><br><span class="line">computers.components.motherboard 订单数 860</span><br><span class="line">computers.components.power_supply 订单数 986</span><br><span class="line">computers.components.sound_card 订单数 26</span><br><span class="line">computers.components.videocards 订单数 1190</span><br><span class="line">computers.desktop 订单数 1041</span><br><span class="line">computers.ebooks 订单数 397</span><br><span class="line">computers.gaming 订单数 164</span><br><span class="line">computers.network.router 订单数 6473</span><br><span class="line">computers.notebook 订单数 25866</span><br><span class="line">computers.peripherals.camera 订单数 1041</span><br><span class="line">computers.peripherals.joystick 订单数 1192</span><br><span class="line">computers.peripherals.keyboard 订单数 3803</span><br><span class="line">computers.peripherals.monitor 订单数 3272</span><br><span class="line">computers.peripherals.mouse 订单数 12664</span><br><span class="line">computers.peripherals.printer 订单数 3458</span><br><span class="line">computers.peripherals.scanner 订单数 74</span><br><span class="line">construction.components.faucet 订单数 133</span><br><span class="line">construction.tools.drill 订单数 622</span><br><span class="line">construction.tools.generator 订单数 46</span><br><span class="line">construction.tools.heater 订单数 348</span><br><span class="line">construction.tools.light 订单数 10</span><br><span class="line">construction.tools.pump 订单数 65</span><br><span class="line">construction.tools.saw 订单数 169</span><br><span class="line">construction.tools.screw 订单数 2408</span><br><span class="line">construction.tools.welding 订单数 183</span><br><span class="line">country_yard.cultivator 订单数 33</span><br><span class="line">country_yard.lawn_mower 订单数 111</span><br><span class="line">country_yard.watering 订单数 5</span><br><span class="line">country_yard.weather_station 订单数 53</span><br><span class="line">electronics.audio.acoustic 订单数 438</span><br><span class="line">electronics.audio.dictaphone 订单数 12</span><br><span class="line">electronics.audio.headphone 订单数 20084</span><br><span class="line">electronics.audio.microphone 订单数 1062</span><br><span class="line">electronics.audio.subwoofer 订单数 70</span><br><span class="line">electronics.calculator 订单数 35</span><br><span class="line">electronics.camera.photo 订单数 348</span><br><span class="line">electronics.camera.video 订单数 133</span><br><span class="line">electronics.clocks 订单数 6474</span><br><span class="line">electronics.smartphone 订单数 102365</span><br><span class="line">electronics.tablet 订单数 6395</span><br><span class="line">electronics.telephone 订单数 2437</span><br><span class="line">electronics.video.projector 订单数 114</span><br><span class="line">electronics.video.tv 订单数 17618</span><br><span class="line">furniture.bathroom.bath 订单数 232</span><br><span class="line">furniture.bathroom.toilet 订单数 44</span><br><span class="line">furniture.bedroom.bed 订单数 451</span><br><span class="line">furniture.bedroom.blanket 订单数 68</span><br><span class="line">furniture.bedroom.pillow 订单数 1882</span><br><span class="line">furniture.kitchen.chair 订单数 3084</span><br><span class="line">furniture.kitchen.table 订单数 11260</span><br><span class="line">furniture.living_room.cabinet 订单数 3117</span><br><span class="line">furniture.living_room.chair 订单数 1439</span><br><span class="line">furniture.living_room.shelving 订单数 2572</span><br><span class="line">furniture.living_room.sofa 订单数 401</span><br><span class="line">furniture.universal.light 订单数 22</span><br><span class="line">kids.bottles 订单数 63</span><br><span class="line">kids.carriage 订单数 41</span><br><span class="line">kids.dolls 订单数 379</span><br><span class="line">kids.fmcg.diapers 订单数 11</span><br><span class="line">kids.skates 订单数 1159</span><br><span class="line">kids.swing 订单数 8</span><br><span class="line">kids.toys 订单数 643</span><br><span class="line">medicine.tools.tonometer 订单数 1106</span><br><span class="line">sport.bicycle 订单数 569</span><br><span class="line">sport.diving 订单数 10</span><br><span class="line">sport.ski 订单数 17</span><br><span class="line">sport.snowboard 订单数 3</span><br><span class="line">sport.tennis 订单数 87</span><br><span class="line">sport.trainer 订单数 210</span><br><span class="line">stationery.battery 订单数 5210</span><br><span class="line">stationery.cartrige 订单数 2473</span><br><span class="line">stationery.paper 订单数 1085</span><br><span class="line">stationery.stapler 订单数 97</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">       .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">       .filter(a -&gt; !a[CATEGORY_CODE].isEmpty())</span><br><span class="line">       .collect(groupingBy(a -&gt; a[CATEGORY_CODE], TreeMap::<span class="keyword">new</span>, counting()))</span><br><span class="line">       .forEach((k, v) -&gt; {</span><br><span class="line">           System.out.println(k + <span class="string">" 订单数 "</span> + v);</span><br><span class="line">       });</span><br></pre></td></tr></tbody></table></figure>



<h3 id="6-2）按一级类别统计销量"><a href="#6-2）按一级类别统计销量" class="headerlink" title="6.2）按一级类别统计销量"></a>6.2）按一级类别统计销量</h3><p>结果应为</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">accessories 订单数 3096</span><br><span class="line">apparel 订单数 2673</span><br><span class="line">appliances 订单数 150244</span><br><span class="line">auto 订单数 1367</span><br><span class="line">computers 订单数 76840</span><br><span class="line">construction 订单数 3984</span><br><span class="line">country_yard 订单数 202</span><br><span class="line">electronics 订单数 157585</span><br><span class="line">furniture 订单数 24572</span><br><span class="line">kids 订单数 2304</span><br><span class="line">medicine 订单数 1106</span><br><span class="line">sport 订单数 896</span><br><span class="line">stationery 订单数 8865</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(l -&gt; l.split(<span class="string">","</span>))</span><br><span class="line">    .filter(a -&gt; !a[CATEGORY_CODE].isEmpty())</span><br><span class="line">    .collect(groupingBy(TestData::firstCategory, TreeMap::<span class="keyword">new</span>, counting()))</span><br><span class="line">    .forEach((k, v) -&gt; {</span><br><span class="line">        System.out.println(k + <span class="string">" 订单数 "</span> + v);</span><br><span class="line">    });</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> String <span class="title function_">firstCategory</span><span class="params">(String[] a)</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">category</span> <span class="operator">=</span> a[CATEGORY_CODE];</span><br><span class="line">    <span class="type">int</span> <span class="variable">dot</span> <span class="operator">=</span> category.indexOf(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">return</span> category.substring(<span class="number">0</span>, dot);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="7）按价格区间统计销量"><a href="#7）按价格区间统计销量" class="headerlink" title="7）按价格区间统计销量"></a>7）按价格区间统计销量</h3><ul>
<li>p &lt;100</li>
<li>100&lt;= p &lt;500</li>
<li>500&lt;=p&lt;1000</li>
<li>1000&lt;=p</li>
</ul>
<p>结果应为</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[0,100)=291624</span><br><span class="line">[1000,∞)=14514</span><br><span class="line">[500,1000)=52857</span><br><span class="line">[100,500)=203863</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> String <span class="title function_">priceRange</span><span class="params">(Double price)</span> {</span><br><span class="line">    <span class="keyword">if</span> (price &lt; <span class="number">100</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[0,100)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (price &gt;= <span class="number">100</span> &amp;&amp; price &lt; <span class="number">500</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[100,500)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (price &gt;= <span class="number">500</span> &amp;&amp; price &lt; <span class="number">1000</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[500,1000)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[1000,∞)"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(line -&gt; line.split(<span class="string">","</span>))</span><br><span class="line">    .map(array -&gt; Double.parseDouble(array[PRICE]))</span><br><span class="line">    .collect(groupingBy(TestData::priceRange, counting()))</span><br></pre></td></tr></tbody></table></figure>



<h3 id="8）不同年龄段女性所下不同类别订单"><a href="#8）不同年龄段女性所下不同类别订单" class="headerlink" title="8）不同年龄段女性所下不同类别订单"></a>8）不同年龄段女性所下不同类别订单</h3><ul>
<li>a &lt; 18</li>
<li>18 &lt;= a &lt; 30</li>
<li>30 &lt;= a &lt; 50</li>
<li>50 &lt;= a</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">[0,18)       accessories      81</span><br><span class="line">[0,18)       apparel          60</span><br><span class="line">[0,18)       appliances       4326</span><br><span class="line">[0,18)       computers        1984</span><br><span class="line">...</span><br><span class="line">[18,30)      accessories      491</span><br><span class="line">[18,30)      apparel          488</span><br><span class="line">[18,30)      appliances       25240</span><br><span class="line">[18,30)      computers        13076</span><br><span class="line">...</span><br><span class="line">[30,50)      accessories      890</span><br><span class="line">[30,50)      apparel          893</span><br><span class="line">[30,50)      appliances       42755</span><br><span class="line">[30,50)      computers        21490</span><br><span class="line">...</span><br><span class="line">[50,∞)       accessories      41</span><br><span class="line">[50,∞)       apparel          41</span><br><span class="line">[50,∞)       appliances       2255</span><br><span class="line">[50,∞)       computers        1109</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> String <span class="title function_">ageRange</span><span class="params">(String[] array)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> Double.valueOf(array[USER_AGE]).intValue();</span><br><span class="line">    <span class="keyword">if</span> (age &lt; <span class="number">18</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[0,18)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (age &lt; <span class="number">30</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[18,30)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (age &lt; <span class="number">50</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[30,50)"</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"[50,∞)"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">lines.skip(<span class="number">1</span>)</span><br><span class="line">    .map(line -&gt; line.split(<span class="string">","</span>))</span><br><span class="line">    .filter(array -&gt; !array[CATEGORY_CODE].isEmpty())</span><br><span class="line">    .filter(array -&gt; array[USER_SEX].equals(<span class="string">"女"</span>))</span><br><span class="line">    .collect(groupingBy(TestData::ageRange, </span><br><span class="line">                        groupingBy(TestData::firstCategory, TreeMap::<span class="keyword">new</span>, counting())))</span><br></pre></td></tr></tbody></table></figure>



<h2 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h2><p>例子 1: 使用<code>ExecutorService</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">"Test"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>)) {</span><br><span class="line">        logger.info(<span class="string">"开始统计"</span>);</span><br><span class="line">        service.submit(() -&gt; monthlySalesReport(map-&gt;map.entrySet().forEach(e-&gt;logger.info(e.toString()))));</span><br><span class="line">        logger.info(<span class="string">"执行其它操作"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">monthlySalesReport</span><span class="params">(Consumer&lt;Map&lt;YearMonth, Long&gt;&gt; consumer)</span> {</span><br><span class="line">    <span class="keyword">try</span> (Stream&lt;String&gt; lines = Files.lines(Path.of(<span class="string">"./data.txt"</span>))) {</span><br><span class="line">        Map&lt;YearMonth, Long&gt; collect = lines.skip(<span class="number">1</span>)</span><br><span class="line">                .map(line -&gt; line.split(<span class="string">","</span>))</span><br><span class="line">                .collect(groupingBy(array -&gt; YearMonth.from(formatter.parse(array[TIME])), TreeMap::<span class="keyword">new</span>, counting()));</span><br><span class="line">        consumer.accept(collect);</span><br><span class="line">    } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>例子 2: 使用<code>CompletableFuture</code></p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">"Test"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException {</span><br><span class="line">    logger.info(<span class="string">"开始统计"</span>);</span><br><span class="line">    CompletableFuture</span><br><span class="line">        	.supplyAsync(() -&gt; monthlySalesReport())</span><br><span class="line">            .thenAccept(map -&gt; map.entrySet().forEach(e -&gt; logger.info(e.toString())));</span><br><span class="line">    logger.info(<span class="string">"执行其它操作"</span>);</span><br><span class="line">    Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;YearMonth, Long&gt; <span class="title function_">monthlySalesReport</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">try</span> (Stream&lt;String&gt; lines = Files.lines(Path.of(<span class="string">"./data.txt"</span>))) {</span><br><span class="line">        Map&lt;YearMonth, Long&gt; collect = lines.skip(<span class="number">1</span>)</span><br><span class="line">                .map(line -&gt; line.split(<span class="string">","</span>))</span><br><span class="line">                .collect(groupingBy(array -&gt; YearMonth.from(formatter.parse(array[TIME])), TreeMap::<span class="keyword">new</span>, counting()));</span><br><span class="line">        <span class="keyword">return</span> collect;</span><br><span class="line">    } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="框架设计"><a href="#框架设计" class="headerlink" title="框架设计"></a>框架设计</h2><ul>
<li>什么是框架？<ul>
<li>半成品软件，帮助开发者快速构建应用程序</li>
<li>框架提供的都是固定<strong>不变的</strong>、<strong>已知的</strong>、可以重用的代码</li>
<li>而那些每个应用不同的业务逻辑，<strong>变化的</strong>、<strong>未知的</strong>部分，则在框架外由开发者自己实现</li>
</ul>
</li>
</ul>
<h3 id="将未知交给子类"><a href="#将未知交给子类" class="headerlink" title="将未知交给子类"></a>将未知交给子类</h3><p>Spring 延迟创建 bean</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">classDiagram</span><br><span class="line"></span><br><span class="line">class DefaultSingletonBeanRegistry {</span><br><span class="line">   - singletonObjects: Map</span><br><span class="line">   + getSingleton(name, factory)</span><br><span class="line">}</span><br><span class="line">class AbstractAutowireCapableBeanFactory {</span><br><span class="line">   # createBean(name, definition, args)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">DefaultSingletonBeanRegistry &lt;|-- AbstractAutowireCapableBeanFactory</span><br></pre></td></tr></tbody></table></figure>



<p>Spring 中的很多类有非常复杂的继承关系，并且它们分工明确，你做什么，我做什么，职责是划分好的。例如：</p>
<ul>
<li>DefaultSingletonBeanRegistry 是父类，它有个职责是缓存单例 bean，用下面方法实现</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; factory)</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>但如何创建 bean，这个父类是不知道的，创建 bean 是子类 AbstractAutowireCapableBeanFactory 的职责</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Object <span class="title function_">createBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span> {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>父类中 getSingleton 的内部就要使用 singletonFactory 函数对象来获得创建好的对象</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">    <span class="keyword">if</span>(singletonObject == <span class="literal">null</span>) {</span><br><span class="line">        ...</span><br><span class="line">        singletonObject = singletonFactory.getObject();</span><br><span class="line">        addSingleton(beanName, singletonObject);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>最后子类创建单例 bean 时，会把 ObjectFactory 这个函数对象传进去<ul>
<li>创建其它 scope bean，不需要用 getSingleton 缓存</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(...)</span> {</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> (mbd.isSingleton()) {</span><br><span class="line">        sharedInstance = getSingleton(beanName, () -&gt; {</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">        }); </span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="将未知交给用户"><a href="#将未知交给用户" class="headerlink" title="将未知交给用户"></a>将未知交给用户</h3><p>JdbcTemplate</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">   id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">   name <span class="type">varchar</span>(<span class="number">16</span>),</span><br><span class="line">   sex <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student <span class="keyword">values</span></span><br><span class="line">	(<span class="number">1</span>, <span class="string">'赵一伤'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">2</span>, <span class="string">'钱二败'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">3</span>, <span class="string">'孙三毁'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">4</span>, <span class="string">'李四摧'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">5</span>, <span class="string">'周五输'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">6</span>, <span class="string">'吴六破'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">7</span>, <span class="string">'郑七灭'</span>, <span class="string">'男'</span>),</span><br><span class="line">	(<span class="number">8</span>, <span class="string">'王八衰'</span>, <span class="string">'男'</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>spring 中 JdbcTemplate 代码</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJdbc</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">HikariDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">        dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/test"</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(dataSource);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select id,name,sex from student"</span>;</span><br><span class="line">        template.query(sql, (rs, index) -&gt; {</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">"name"</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">sex</span> <span class="operator">=</span> rs.getString(<span class="string">"sex"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Student</span>(id, name, sex);</span><br><span class="line">        }).forEach(System.out::println);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(<span class="type">int</span> id, String name, String sex)</span> {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>对 query 来讲，建立数据库连接，创建 Statement 对象，执行查询这些步骤都是固定的</li>
<li>而结果要如何用 java 对象封装，这对框架代码是未知的，用 RowMapper 接口代表，将来它的 lambda 实现将结果转换成需要的 java 对象</li>
</ul>
<p>ApplicationListener</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyEvent</span><span class="params">(Object source)</span> {</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestExtend</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> </span><br><span class="line">            <span class="operator">=</span> SpringApplication.run(TestExtend.class, args);</span><br><span class="line">        context.publishEvent(<span class="keyword">new</span> <span class="title class_">MyEvent</span>(<span class="string">"context"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ApplicationListener&lt;MyEvent&gt; <span class="title function_">myListener</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> (event -&gt; System.out.println(<span class="string">"收到事件:"</span> + event));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RestController</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyController</span> {</span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@GetMapping("/hello")</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> {</span><br><span class="line">            context.publishEvent(<span class="keyword">new</span> <span class="title class_">MyEvent</span>(<span class="string">"controller"</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>对 spring 来讲，它并不知道如何处理事件</li>
<li>因此可以提供一个类型为 ApplicationListener 的 lambda 对象</li>
</ul>
<h3 id="延迟拼接条件"><a href="#延迟拼接条件" class="headerlink" title="延迟拼接条件"></a>延迟拼接条件</h3><p>Mybatis-Plus</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMyBatisPlus</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> </span><br><span class="line">            <span class="operator">=</span> SpringApplication.run(TestMyBatisPlus.class, args);</span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> context.getBean(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">        test(mapper, List.of(<span class="string">"赵一伤"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(StudentMapper mapper, List&lt;String&gt; names)</span> {</span><br><span class="line">        LambdaQueryWrapper&lt;Student&gt; query = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        query.in(!names.isEmpty(), Student::getName, names);</span><br><span class="line">        System.out.println(mapper.selectList(query));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>比较典型的用法有两处：</p>
<p>第一，在调用 in 等方法添加条件时，第一个参数是 boolean 为 true 才会拼接 SQL 条件，否则不拼接</p>
<p>如何实现的呢？用 DoSomething 类型的 lambda 对象来延迟拼接操作</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DoSomething</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doIt</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Children <span class="title function_">maybeDo</span><span class="params">(<span class="type">boolean</span> condition, DoSomething something)</span> {</span><br><span class="line">    <span class="keyword">if</span> (condition) {</span><br><span class="line">        something.doIt();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> typedThis;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>然而，它在实现 <code>()-&gt;appendSqlSegments(...)</code> 拼接时，是不断修改一个 expression 状态变量，为函数编程所不齿</li>
</ul>
<h3 id="偏门用法"><a href="#偏门用法" class="headerlink" title="偏门用法"></a>偏门用法</h3><p>第二，如果用 LambdaQueryWrapper 拼接 sql 条件时，<strong>为了取得列名</strong>，采用了这个办法</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Student::getName</span><br></pre></td></tr></tbody></table></figure>

<p>它要做的事很简单，但内部实现却比较复杂</p>
<ol>
<li>必须用 <code>Student::getName</code> 方法引用，而不能用其它 Lambda 对象</li>
<li>它会实现 Serializable 接口，序列化时会把它变成 SerializedLambda</li>
<li>想办法拿到 SerializedLambda 对象（反射调用 writeReplace）</li>
<li>通过 SerializedLambda 能够获得它对应的实际方法，也就是 String getName() 和所在类 Student</li>
<li>再通过方法名推导得到属性名（去掉 is，get）即 name</li>
<li>所在类 Student 知道了，属性名 name 也有了，就可以进一步确定列名<ol>
<li>属性上的 @TableField 指定的列名优先</li>
<li>没有 @TableField，把属性名当作列名</li>
</ol>
</li>
</ol>
<blockquote>
<p><em><strong>P.S.</strong></em></p>
<ul>
<li>不是很喜欢这种做法，比较恶心</li>
<li>但它确实是想做这么一件事：在代码中全面使用 java 的字段名，避免出现数据库的列名</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line"><span class="comment">//        Type1 lambda = (Type1 &amp; Serializable) (a, b) -&gt; a + b;</span></span><br><span class="line">    <span class="type">Type2</span> <span class="variable">lambda</span> <span class="operator">=</span> (Type2 &amp; Serializable) Student::getName;</span><br><span class="line">    <span class="comment">// 将 lambda 对象序列化</span></span><br><span class="line">    <span class="type">Method</span> <span class="variable">writeReplace</span> <span class="operator">=</span> lambda.getClass().getDeclaredMethod(<span class="string">"writeReplace"</span>);</span><br><span class="line">    <span class="type">SerializedLambda</span> <span class="variable">serializedLambda</span> <span class="operator">=</span> (SerializedLambda) writeReplace.invoke(lambda);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 得到 lambda 对象使用类、所属类和实现方法名</span></span><br><span class="line">    System.out.println(serializedLambda.getCapturingClass());</span><br><span class="line">    System.out.println(serializedLambda.getImplClass());</span><br><span class="line">    System.out.println(serializedLambda.getImplMethodName());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Type2</span> {</span><br><span class="line">    String <span class="title function_">get</span><span class="params">(Student student)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Type1</span> {</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="并行计算"><a href="#并行计算" class="headerlink" title="并行计算"></a>并行计算</h2><p>统计页面的访问次数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelTest</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Pattern</span> <span class="variable">reg</span> <span class="operator">=</span> Pattern.compile(<span class="string">"(\\S+) - \\[(.+)] (.+) (.+)"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FILES</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">            sequence();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sequence</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException {</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        Map&lt;String, Long&gt; m0 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; FILES; i++) {</span><br><span class="line">            Map&lt;String, Long&gt; mi = one(i);</span><br><span class="line">            m0 = Stream.of(m0, mi)</span><br><span class="line">                    .flatMap(m -&gt; m.entrySet().stream())</span><br><span class="line">                    .collect(toMap(Map.Entry::getKey, Map.Entry::getValue, Long::sum));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Long&gt; e : m0.entrySet()) {</span><br><span class="line"><span class="comment">//            System.out.println(e);</span></span><br><span class="line">            sum += e.getValue();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        System.out.println(<span class="string">"cost: "</span> + (System.currentTimeMillis() - start));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Long&gt; <span class="title function_">one</span><span class="params">(<span class="type">int</span> i)</span> {</span><br><span class="line">        <span class="keyword">try</span> (Stream&lt;String&gt; lines = Files.lines(Path.of(String.format(<span class="string">"web_server_access_%d.log"</span>, i)))) {</span><br><span class="line">            <span class="keyword">return</span> lines</span><br><span class="line"><span class="comment">//                            .limit(10)</span></span><br><span class="line">                    .map(reg::matcher)</span><br><span class="line">                    .filter(Matcher::find)</span><br><span class="line">                    .map(matcher -&gt; matcher.group(<span class="number">3</span>))</span><br><span class="line">                    .collect(groupingBy(identity(), counting()));</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parallel</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException {</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        List&lt;CompletableFuture&lt;Map&lt;String, Long&gt;&gt;&gt; futures = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; FILES; i++) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i;</span><br><span class="line">            CompletableFuture&lt;Map&lt;String, Long&gt;&gt; future = CompletableFuture.supplyAsync(() -&gt; one(k));</span><br><span class="line">            futures.add(future);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Map&lt;String, Long&gt;&gt; f0 = futures.getFirst();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; futures.size(); i++) {</span><br><span class="line">            f0 = f0.thenCombine(futures.get(i), (m1, m2) -&gt;</span><br><span class="line">                    Stream.of(m1, m2)</span><br><span class="line">                            .flatMap(m -&gt; m.entrySet().stream())</span><br><span class="line">                            .collect(toMap(Map.Entry::getKey, Map.Entry::getValue, Long::sum))</span><br><span class="line">            );</span><br><span class="line">        }</span><br><span class="line">        Map&lt;String, Long&gt; map = f0.get();</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Long&gt; e : map.entrySet()) {</span><br><span class="line"><span class="comment">//            System.out.println(e);</span></span><br><span class="line">            sum += e.getValue();</span><br><span class="line">        }</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        System.out.println(<span class="string">"cost: "</span> + (System.currentTimeMillis() - start));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="UI-事件"><a href="#UI-事件" class="headerlink" title="UI 事件"></a>UI 事件</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestUIEvent</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">"Lambda Example"</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">"Click me"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Lambda表达式定义按钮的点击事件处理程序</span></span><br><span class="line">        button.addActionListener(e -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"Button clicked!"</span>);</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        frame.add(button);</span><br><span class="line">        frame.setSize(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h1 id="五-实现原理"><a href="#五-实现原理" class="headerlink" title="五. 实现原理"></a>五. 实现原理</h1><h2 id="lambda-原理"><a href="#lambda-原理" class="headerlink" title="lambda 原理"></a>lambda 原理</h2><p>以下面代码为例</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        test((a, b) -&gt; a + b);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(BinaryOperator&lt;Integer&gt; lambda)</span> {</span><br><span class="line">        System.out.println(lambda.apply(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>执行结果</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">3</span><br></pre></td></tr></tbody></table></figure>



<h3 id="第一步，生成静态方法"><a href="#第一步，生成静态方法" class="headerlink" title="第一步，生成静态方法"></a>第一步，生成静态方法</h3><p>如何证明？用反射</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Method method : TestLambda.class.getDeclaredMethods()) {</span><br><span class="line">    System.out.println(method);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>输出为（去掉了包名，容易阅读）</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> TestLambda.main(java.lang.String[])</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> TestLambda.test(BinaryOperator)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> java.lang.Integer TestLambda.lambda$main$<span class="number">0</span>(Integer,Integer)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>可以看到除了我们自己写的 main 和 test 以外，多出一个名为 <code>lambda$main$0</code> 的方法</p>
</li>
<li><p>这个方法是在编译期间由编译器生成的方法，是 synthetic（合成）方法</p>
</li>
<li><p>它的参数、内容就是 lambda 表达式提供的参数和内容，如下面代码片段所示</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer lambda$main$<span class="number">0</span>(Integer a, Integer b) {</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="第二步，生成实现类字节码"><a href="#第二步，生成实现类字节码" class="headerlink" title="第二步，生成实现类字节码"></a>第二步，生成实现类字节码</h3><p>如果是我自己造一个对象包含此方法，可以这么做</p>
<p>先创建一个类</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LambdaObject</span> <span class="keyword">implements</span> <span class="title class_">BinaryOperator</span>&lt;Integer&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">apply</span><span class="params">(Integer a, Integer b)</span> {</span><br><span class="line">        <span class="keyword">return</span> TestLambda.lambda$main$<span class="number">0</span>(a, b);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>将来使用时，创建对象</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">test(<span class="keyword">new</span> <span class="title class_">LambdaObject</span>());</span><br></pre></td></tr></tbody></table></figure>

<p>只不过，jvm 是在运行期间造出的这个类以及对象而已，要想查看这个类</p>
<p>在 jdk 21 中运行时添加虚拟机参数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">-Djdk.invoke.LambdaMetafactory.dumpProxyClassFiles</span><br></pre></td></tr></tbody></table></figure>

<p>早期 jdk 添加的参数是（没有去进行版本比对了）</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">-Djdk.internal.lambda.dumpProxyClasses</span><br></pre></td></tr></tbody></table></figure>



<p>若想实现在运行期间生成上述 class 字节码，有两种手段</p>
<ul>
<li>一是动态代理，jdk 并没有采用这种办法来生成 Lambda 类</li>
<li>二是用 LambdaMetaFactory，它配合 MethodHandle API 在执行时更具性能优势</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda1</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        test((a, b) -&gt; a + b);</span><br><span class="line"></span><br><span class="line">        MethodHandles.<span class="type">Lookup</span> <span class="variable">lookup</span> <span class="operator">=</span> MethodHandles.lookup();</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">factoryType</span> <span class="operator">=</span> MethodType.methodType(BinaryOperator.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">interfaceMethodType</span> <span class="operator">=</span> MethodType.methodType(Object.class, Object.class, Object.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">implementsMethodType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, Integer.class, Integer.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">implementsMethod</span> <span class="operator">=</span> lookup.findStatic(TestLambda1.class, <span class="string">"lambda$main$1"</span>, implementsMethodType);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">lambdaType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, Integer.class, Integer.class);</span><br><span class="line">        <span class="type">CallSite</span> <span class="variable">callSite</span> <span class="operator">=</span> LambdaMetafactory.metafactory(lookup,</span><br><span class="line">                <span class="string">"apply"</span>, factoryType, interfaceMethodType,</span><br><span class="line">                implementsMethod,</span><br><span class="line">                lambdaType);</span><br><span class="line"></span><br><span class="line">        BinaryOperator&lt;Integer&gt; lambda = (BinaryOperator) callSite.getTarget().invoke();</span><br><span class="line">        test(lambda);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Integer lambda$main$<span class="number">1</span>(Integer a, Integer b) {</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(BinaryOperator&lt;Integer&gt; lambda)</span> {</span><br><span class="line">        System.out.println(lambda.apply(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其中</p>
<ul>
<li><p>“apply” 是接口方法名</p>
</li>
<li><p>factoryType 是工厂方法长相</p>
</li>
<li><p>interfaceMethodType 是接口方法长相</p>
</li>
<li><p>implementsMethod 是实现方法</p>
<ul>
<li>implementsMethodType 是实现方法长相</li>
</ul>
</li>
<li><p>lambdaType 是实际函数对象长相</p>
</li>
<li><p>callSite.getTarget() 实际是调用实现类的构造方法对应的 mh，最后 invoke 返回函数对象</p>
</li>
</ul>
<h2 id="方法引用原理"><a href="#方法引用原理" class="headerlink" title="方法引用原理"></a>方法引用原理</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda3</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">		test(String::toLowerCase);</span><br><span class="line">        </span><br><span class="line">        MethodHandles.<span class="type">Lookup</span> <span class="variable">lookup</span> <span class="operator">=</span> MethodHandles.lookup();</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">factoryType</span> <span class="operator">=</span> MethodType.methodType(Function.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">interfaceMethodType</span> <span class="operator">=</span> MethodType.methodType(Object.class, Object.class);</span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">implementsMethod</span> <span class="operator">=</span> lookup.findVirtual(String.class, <span class="string">"toLowerCase"</span>, MethodType.methodType(String.class));</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">lambdaType</span> <span class="operator">=</span> MethodType.methodType(String.class, String.class);</span><br><span class="line">        <span class="type">CallSite</span> <span class="variable">callSite</span> <span class="operator">=</span> LambdaMetafactory.metafactory(lookup,</span><br><span class="line">                <span class="string">"apply"</span>, factoryType, interfaceMethodType,</span><br><span class="line">                implementsMethod,</span><br><span class="line">                lambdaType);</span><br><span class="line"></span><br><span class="line">        Function&lt;String, String&gt; lambda = (Function&lt;String, String&gt;) callSite.getTarget().invoke();</span><br><span class="line">        System.out.println(lambda.apply(<span class="string">"Tom"</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(Function&lt;String,String&gt; lambda)</span> {</span><br><span class="line">        System.out.println(lambda.apply(<span class="string">"Tom"</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h2 id="闭包原理"><a href="#闭包原理" class="headerlink" title="闭包原理"></a>闭包原理</h2><p>捕获基本类型变量</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">test((a, b) -&gt; a + b + c);</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(BinaryOperator&lt;Integer&gt; lambda)</span> {</span><br><span class="line">    System.out.println(lambda.apply(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>生成一个带 3 个参数的方法，但它和 BinaryOperator 还差一个 int 参数</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> Integer lambda$main$<span class="number">1</span>(<span class="type">int</span> c, Integer a, Integer b) {</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda2</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line"><span class="comment">//        int c = 10;</span></span><br><span class="line"><span class="comment">//        test((a, b) -&gt; a + b + c);</span></span><br><span class="line"></span><br><span class="line">        MethodHandles.<span class="type">Lookup</span> <span class="variable">lookup</span> <span class="operator">=</span> MethodHandles.lookup();</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">factoryType</span> <span class="operator">=</span> MethodType.methodType(BinaryOperator.class, <span class="type">int</span>.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">interfaceMethodType</span> <span class="operator">=</span> MethodType.methodType(Object.class, Object.class, Object.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">implementsMethodType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, <span class="type">int</span>.class, Integer.class, Integer.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">implementsMethod</span> <span class="operator">=</span> lookup.findStatic(TestLambda2.class, <span class="string">"lambda$main$1"</span>, implementsMethodType);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">lambdaType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, Integer.class, Integer.class);</span><br><span class="line">        <span class="type">CallSite</span> <span class="variable">callSite</span> <span class="operator">=</span> LambdaMetafactory.metafactory(lookup,</span><br><span class="line">                <span class="string">"apply"</span>, factoryType, interfaceMethodType,</span><br><span class="line">                implementsMethod,</span><br><span class="line">                lambdaType);</span><br><span class="line"></span><br><span class="line">        BinaryOperator&lt;Integer&gt; lambda = (BinaryOperator) callSite.getTarget().invoke(<span class="number">10</span>);</span><br><span class="line">        test(lambda);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Integer lambda$main$<span class="number">1</span>(<span class="type">int</span> c, Integer a, Integer b) {</span><br><span class="line">        <span class="keyword">return</span> a + b + c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(BinaryOperator&lt;Integer&gt; lambda)</span> {</span><br><span class="line">        System.out.println(lambda.apply(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>不同之处</p>
<ul>
<li>factoryType，除了原本的接口类型之外，多了实现方法第一个参数的类型</li>
<li>产生 lambda 对象的时候，通过 invoke 把这个参数的实际值传进去</li>
</ul>
<p>这样产生的 LambdaType 就是这样，并且生成 Lambda 对象时，c 的值被固定为 10</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LambdaType</span> <span class="keyword">implements</span> <span class="title class_">BinaryOperator</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TestLambda2$$Lambda(<span class="type">int</span> c) {</span><br><span class="line">        <span class="built_in">this</span>.c = c;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">apply</span><span class="params">(Object a, Object b)</span> {</span><br><span class="line">        <span class="keyword">return</span> TestLambda2.lambda$main$<span class="number">1</span>(<span class="built_in">this</span>.c, (Integer)a, (Integer)b);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>捕获引用类型变量</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda4</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyRef</span> {</span><br><span class="line">        <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MyRef</span><span class="params">(<span class="type">int</span> age)</span> {</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        <span class="comment">/*MyRef ref = new MyRef(10);</span></span><br><span class="line"><span class="comment">        test((a, b) -&gt; a + b + ref.age);*/</span></span><br><span class="line"></span><br><span class="line">        MethodHandles.<span class="type">Lookup</span> <span class="variable">lookup</span> <span class="operator">=</span> MethodHandles.lookup();</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">factoryType</span> <span class="operator">=</span> MethodType.methodType(BinaryOperator.class, MyRef.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">interfaceMethodType</span> <span class="operator">=</span> MethodType.methodType(Object.class, Object.class, Object.class);</span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">implementsMethodType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, MyRef.class, Integer.class, Integer.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">implementsMethod</span> <span class="operator">=</span> lookup.findStatic(TestLambda4.class, <span class="string">"lambda$main$1"</span>, implementsMethodType);</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodType</span> <span class="variable">lambdaType</span> <span class="operator">=</span> MethodType.methodType(Integer.class, Integer.class, Integer.class);</span><br><span class="line">        <span class="type">CallSite</span> <span class="variable">callSite</span> <span class="operator">=</span> LambdaMetafactory.metafactory(lookup,</span><br><span class="line">                <span class="string">"apply"</span>, factoryType, interfaceMethodType,</span><br><span class="line">                implementsMethod,</span><br><span class="line">                lambdaType);</span><br><span class="line"></span><br><span class="line">        BinaryOperator&lt;Integer&gt; lambda = (BinaryOperator) callSite.getTarget().bindTo(<span class="keyword">new</span> <span class="title class_">MyRef</span>(<span class="number">20</span>)).invoke();</span><br><span class="line">        test(lambda);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Integer lambda$main$<span class="number">1</span>(MyRef c, Integer a, Integer b) {</span><br><span class="line">        <span class="keyword">return</span> a + b + c.age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(BinaryOperator&lt;Integer&gt; lambda)</span> {</span><br><span class="line">        System.out.println(lambda.apply(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>与捕获基本类型变量类似，不过</p>
<p>除了</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">callSite.getTarget().invoke(<span class="keyword">new</span> <span class="title class_">MyRef</span>(<span class="number">20</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>还可以</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">callSite.getTarget().bindTo(<span class="keyword">new</span> <span class="title class_">MyRef</span>(<span class="number">20</span>)).invoke();</span><br></pre></td></tr></tbody></table></figure>



<h2 id="Stream-构建"><a href="#Stream-构建" class="headerlink" title="Stream 构建"></a>Stream 构建</h2><p>自定义可切分迭代器</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSpliterator</span> {</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MySpliterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Spliterator</span>&lt;T&gt; {</span><br><span class="line">        T[] array;</span><br><span class="line">        <span class="type">int</span> begin;</span><br><span class="line">        <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MySpliterator</span><span class="params">(T[] array, <span class="type">int</span> begin, <span class="type">int</span> end)</span> {</span><br><span class="line">            <span class="built_in">this</span>.array = array;</span><br><span class="line">            <span class="built_in">this</span>.begin = begin;</span><br><span class="line">            <span class="built_in">this</span>.end = end;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAdvance</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action)</span> {</span><br><span class="line">            <span class="keyword">if</span> (begin &gt; end) {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">            action.accept(array[begin++]);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Spliterator&lt;T&gt; <span class="title function_">trySplit</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">if</span> (estimateSize() &gt; <span class="number">5</span>) {</span><br><span class="line">                <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (begin + end) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">                MySpliterator&lt;T&gt; res = <span class="keyword">new</span> <span class="title class_">MySpliterator</span>&lt;&gt;(array, begin, mid);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">"=&gt;"</span> + res);</span><br><span class="line">                begin = mid + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> Arrays.toString(Arrays.copyOfRange(array, begin, end + <span class="number">1</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">estimateSize</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> end - begin + <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">characteristics</span><span class="params">()</span> {</span><br><span class="line">            <span class="keyword">return</span> Spliterator.SUBSIZED | Spliterator.ORDERED;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        Integer[] all = <span class="keyword">new</span> <span class="title class_">Integer</span>[]{<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>};</span><br><span class="line">        MySpliterator&lt;Integer&gt; spliterator = <span class="keyword">new</span> <span class="title class_">MySpliterator</span>&lt;&gt;(all, <span class="number">0</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        StreamSupport.stream(spliterator, <span class="literal">false</span>)</span><br><span class="line">                .parallel()</span><br><span class="line">                .forEach(x -&gt; System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + x));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>练习：按每次切分固定大小来实现</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="/img/basic/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="/img/basic/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">violet</div><div class="post-copyright__author_desc">生活明朗，万物可爱</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/posts/1690d21b.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/posts/1690d21b.html')">函数式编程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" target="_blank"><img class="post-qr-code-img" src="https://c-ssl.dtstatic.com/uploads/blog/202304/15/20230415081411_9a88c.thumb.400_0.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" target="_blank"><img class="post-qr-code-img" src="https://tupian.qqw21.com/article/UploadPic/2020-6/20206416212275003.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/posts/1690d21b.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=函数式编程&amp;url=http://example.com/posts/1690d21b.html&amp;pic=https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Violet博客屋</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Java%E7%A8%8B%E5%BA%8F%E5%91%98/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Java程序员<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/d06fc5d7.html"><img class="prev-cover" src="https://boosterminiclass.com/wp-content/uploads/2023/07/intellij_idea_git_2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">IDEA 使用 Git 详解(三)</div></div></a></div><div class="next-post pull-right"><a href="/posts/fe850976.html"><img class="next-cover" src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SaToken鉴权框架</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/6ed5eebe.html" title="SpringCloud微服务项目"><img class="cover" src="https://img.bjsxt.com/uploadfile/2018/08/Spring-Cloud-2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-23</div><div class="title">SpringCloud微服务项目</div></div></a></div><div><a href="/posts/621998ca.html" title="Java架构师成长路径图"><img class="cover" src="https://www.javaweb.cc/zb_users/upload/editor/water/2022-12-01/63887b9fdbaf2.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-23</div><div class="title">Java架构师成长路径图</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="/img/basic/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">violet</h1><div class="author-info__desc">生活明朗，万物可爱</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Violetlx" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E9%81%93%E4%B9%8B%E4%BC%8A%E5%A7%8B"><span class="toc-number">1.</span> <span class="toc-text">一. 道之伊始</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">什么是函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E9%81%93%E6%97%A0%E6%83%85"><span class="toc-number">1.2.</span> <span class="toc-text">大道无情</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%83%85"><span class="toc-number">1.2.1.</span> <span class="toc-text">无情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9B%E7%A5%96%E6%88%90%E9%81%93"><span class="toc-number">1.2.2.</span> <span class="toc-text">佛祖成道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.3.</span> <span class="toc-text">函数与方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%8F%98%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.2.4.</span> <span class="toc-text">不变的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E6%A0%BC%E7%9A%84%E5%87%BD%E6%95%B0%E6%97%A0%E7%8A%B6%E6%80%81"><span class="toc-number">1.2.5.</span> <span class="toc-text">合格的函数无状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E9%81%93%E6%97%A0%E5%BD%A2"><span class="toc-number">1.3.</span> <span class="toc-text">大道无形</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">函数化对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%8F%82%E6%95%B0%E5%8C%96"><span class="toc-number">1.3.2.</span> <span class="toc-text">行为参数化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.3.</span> <span class="toc-text">延迟执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.4.</span> <span class="toc-text">函数对象的不同类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E5%87%BD%E6%95%B0%E7%BC%96%E7%A8%8B%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">二. 函数编程语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">表现形式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">函数类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8"><span class="toc-number">2.3.</span> <span class="toc-text">六种方法引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E7%B1%BB%E5%90%8D-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">2.3.1.</span> <span class="toc-text">1）类名::静态方法名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E7%B1%BB%E5%90%8D-%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">2.3.2.</span> <span class="toc-text">2）类名::非静态方法名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E5%AF%B9%E8%B1%A1-%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">2.3.3.</span> <span class="toc-text">3）对象::非静态方法名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E7%B1%BB%E5%90%8D-new"><span class="toc-number">2.3.4.</span> <span class="toc-text">4）类名::new</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89this-%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">2.3.5.</span> <span class="toc-text">5）this::非静态方法名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89super-%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%90%8D"><span class="toc-number">2.3.6.</span> <span class="toc-text">6）super::非静态方法名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%89%E7%89%B9%E4%BE%8B"><span class="toc-number">2.3.7.</span> <span class="toc-text">7）特例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AD%E5%8C%85%EF%BC%88Closure%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">闭包（Closure）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%AF%E9%87%8C%E5%8C%96%EF%BC%88Carrying%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">柯里化（Carrying）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%EF%BC%88Higher-Order-Functions%EF%BC%89"><span class="toc-number">2.6.</span> <span class="toc-text">高阶函数（Higher-Order Functions）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%86%85%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.6.1.</span> <span class="toc-text">1) 内循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%81%8D%E5%8E%86%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="toc-number">2.6.2.</span> <span class="toc-text">2) 遍历二叉树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%AE%80%E5%8D%95%E6%B5%81"><span class="toc-number">2.6.3.</span> <span class="toc-text">3) 简单流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%AE%80%E5%8D%95%E6%B5%81-%E5%8C%96%E7%AE%80"><span class="toc-number">2.6.4.</span> <span class="toc-text">4) 简单流-化简</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%AE%80%E5%8D%95%E6%B5%81-%E6%94%B6%E9%9B%86"><span class="toc-number">2.6.5.</span> <span class="toc-text">5) 简单流-收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E7%BB%83%E4%B9%A0"><span class="toc-number">2.7.</span> <span class="toc-text">综合练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%88%A4%E6%96%AD%E8%AF%AD%E6%B3%95%E6%AD%A3%E7%A1%AE%E6%80%A7"><span class="toc-number">2.7.1.</span> <span class="toc-text">1）判断语法正确性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%86%99%E5%87%BA%E7%AD%89%E4%BB%B7%E7%9A%84-lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.7.2.</span> <span class="toc-text">2）写出等价的 lambda 表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">2.7.3.</span> <span class="toc-text">3）使用函数接口解决问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%86%99%E5%87%BA%E7%AD%89%E4%BB%B7%E7%9A%84%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8"><span class="toc-number">2.7.4.</span> <span class="toc-text">4）写出等价的方法引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E8%A1%A5%E5%85%85%E4%BB%A3%E7%A0%81"><span class="toc-number">2.7.5.</span> <span class="toc-text">5）补充代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E5%AE%9E%E7%8E%B0%E9%9C%80%E6%B1%82"><span class="toc-number">2.7.6.</span> <span class="toc-text">6）实现需求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89-Stream-API"><span class="toc-number">3.</span> <span class="toc-text">三. Stream API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">3.2.</span> <span class="toc-text">映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%8D%E7%BB%B4"><span class="toc-number">3.3.</span> <span class="toc-text">降维</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA"><span class="toc-number">3.4.</span> <span class="toc-text">构建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5"><span class="toc-number">3.5.</span> <span class="toc-text">拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%AA%E5%8F%96"><span class="toc-number">3.6.</span> <span class="toc-text">截取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90"><span class="toc-number">3.7.</span> <span class="toc-text">生成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E4%B8%8E%E5%88%A4%E6%96%AD"><span class="toc-number">3.8.</span> <span class="toc-text">查找与判断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%8E%BB%E9%87%8D"><span class="toc-number">3.9.</span> <span class="toc-text">排序与去重</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%96%E7%AE%80"><span class="toc-number">3.10.</span> <span class="toc-text">化简</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E9%9B%86"><span class="toc-number">3.11.</span> <span class="toc-text">收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">3.12.</span> <span class="toc-text">收集器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E6%B8%B8%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">3.13.</span> <span class="toc-text">下游收集器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B5%81"><span class="toc-number">3.14.</span> <span class="toc-text">基本流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">3.15.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C"><span class="toc-number">3.16.</span> <span class="toc-text">并行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E7%8E%87"><span class="toc-number">3.17.</span> <span class="toc-text">效率</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E7%BB%84%E6%B1%82%E5%92%8C"><span class="toc-number">3.17.1.</span> <span class="toc-text">1) 数组求和</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B1%82%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="toc-number">3.17.2.</span> <span class="toc-text">2) 求最大值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B9%B6%E8%A1%8C-%E5%8F%91-%E6%94%B6%E9%9B%86"><span class="toc-number">3.17.3.</span> <span class="toc-text">3) 并行(发)收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89MethodHandle-%E6%80%A7%E8%83%BD"><span class="toc-number">3.17.4.</span> <span class="toc-text">4）MethodHandle 性能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E7%BB%83%E4%B9%A0-1"><span class="toc-number">3.18.</span> <span class="toc-text">综合练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B-%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">四. 实际应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">数据统计分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%AF%8F%E6%9C%88%E7%9A%84%E9%94%80%E5%94%AE%E9%87%8F"><span class="toc-number">4.1.1.</span> <span class="toc-text">1）每月的销售量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E9%94%80%E9%87%8F%E6%9C%80%E9%AB%98%E7%9A%84%E6%9C%88%E4%BB%BD"><span class="toc-number">4.1.2.</span> <span class="toc-text">2）销量最高的月份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%B1%82%E9%94%80%E9%87%8F%E6%9C%80%E9%AB%98%E7%9A%84%E5%95%86%E5%93%81"><span class="toc-number">4.1.3.</span> <span class="toc-text">3）求销量最高的商品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E4%B8%8B%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%89%8D10%E7%94%A8%E6%88%B7"><span class="toc-number">4.1.4.</span> <span class="toc-text">4）下单最多的前10用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%EF%BC%89%E6%AF%8F%E4%B8%AA%E5%9C%B0%E5%8C%BA%E4%B8%8B%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-number">4.1.5.</span> <span class="toc-text">5.1）每个地区下单最多的用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%EF%BC%89%E6%AF%8F%E4%B8%AA%E5%9C%B0%E5%8C%BA%E4%B8%8B%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%89%8D3%E7%94%A8%E6%88%B7"><span class="toc-number">4.1.6.</span> <span class="toc-text">5.2）每个地区下单最多的前3用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%EF%BC%89%E6%8C%89%E7%B1%BB%E5%88%AB%E7%BB%9F%E8%AE%A1%E9%94%80%E9%87%8F"><span class="toc-number">4.1.7.</span> <span class="toc-text">6.1）按类别统计销量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%EF%BC%89%E6%8C%89%E4%B8%80%E7%BA%A7%E7%B1%BB%E5%88%AB%E7%BB%9F%E8%AE%A1%E9%94%80%E9%87%8F"><span class="toc-number">4.1.8.</span> <span class="toc-text">6.2）按一级类别统计销量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%89%E6%8C%89%E4%BB%B7%E6%A0%BC%E5%8C%BA%E9%97%B4%E7%BB%9F%E8%AE%A1%E9%94%80%E9%87%8F"><span class="toc-number">4.1.9.</span> <span class="toc-text">7）按价格区间统计销量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%89%E4%B8%8D%E5%90%8C%E5%B9%B4%E9%BE%84%E6%AE%B5%E5%A5%B3%E6%80%A7%E6%89%80%E4%B8%8B%E4%B8%8D%E5%90%8C%E7%B1%BB%E5%88%AB%E8%AE%A2%E5%8D%95"><span class="toc-number">4.1.10.</span> <span class="toc-text">8）不同年龄段女性所下不同类别订单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">异步处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.</span> <span class="toc-text">框架设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%9C%AA%E7%9F%A5%E4%BA%A4%E7%BB%99%E5%AD%90%E7%B1%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">将未知交给子类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%9C%AA%E7%9F%A5%E4%BA%A4%E7%BB%99%E7%94%A8%E6%88%B7"><span class="toc-number">4.3.2.</span> <span class="toc-text">将未知交给用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E6%8B%BC%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.3.3.</span> <span class="toc-text">延迟拼接条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%8F%E9%97%A8%E7%94%A8%E6%B3%95"><span class="toc-number">4.3.4.</span> <span class="toc-text">偏门用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97"><span class="toc-number">4.4.</span> <span class="toc-text">并行计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI-%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">UI 事件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">五. 实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">lambda 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%8C%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.1.</span> <span class="toc-text">第一步，生成静态方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%8C%E7%94%9F%E6%88%90%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">5.1.2.</span> <span class="toc-text">第二步，生成实现类字节码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">方法引用原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AD%E5%8C%85%E5%8E%9F%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">闭包原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stream-%E6%9E%84%E5%BB%BA"><span class="toc-number">5.4.</span> <span class="toc-text">Stream 构建</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/fe850976.html" title="SaToken鉴权框架"><img src="https://picx.zhimg.com/v2-fa9bc3ed9d6f65d08873fc8cd2eec058_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SaToken鉴权框架"></a><div class="content"><a class="title" href="/posts/fe850976.html" title="SaToken鉴权框架">SaToken鉴权框架</a><time datetime="2024-09-27T08:32:20.000Z" title="发表于 2024-09-27 16:32:20">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1690d21b.html" title="函数式编程"><img src="https://tse2-mm.cn.bing.net/th/id/OIP-C.I-2ZrXHR3fZtG0pUgdqymQHaEL?rs=1&amp;pid=ImgDetMain" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="函数式编程"></a><div class="content"><a class="title" href="/posts/1690d21b.html" title="函数式编程">函数式编程</a><time datetime="2024-09-27T06:01:27.000Z" title="发表于 2024-09-27 14:01:27">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d06fc5d7.html" title="IDEA 使用 Git 详解(三)"><img src="https://boosterminiclass.com/wp-content/uploads/2023/07/intellij_idea_git_2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IDEA 使用 Git 详解(三)"></a><div class="content"><a class="title" href="/posts/d06fc5d7.html" title="IDEA 使用 Git 详解(三)">IDEA 使用 Git 详解(三)</a><time datetime="2024-09-25T06:45:04.000Z" title="发表于 2024-09-25 14:45:04">2024-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ae9ce5fc.html" title="IDEA 使用 Git 详解(二)"><img src="https://boosterminiclass.com/wp-content/uploads/2023/07/intellij_idea_git_2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IDEA 使用 Git 详解(二)"></a><div class="content"><a class="title" href="/posts/ae9ce5fc.html" title="IDEA 使用 Git 详解(二)">IDEA 使用 Git 详解(二)</a><time datetime="2024-09-25T06:45:03.000Z" title="发表于 2024-09-25 14:45:03">2024-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7f7493d0.html" title="IDEA 使用 Git 详解(一)"><img src="https://boosterminiclass.com/wp-content/uploads/2023/07/intellij_idea_git_2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IDEA 使用 Git 详解(一)"></a><div class="content"><a class="title" href="/posts/7f7493d0.html" title="IDEA 使用 Git 详解(一)">IDEA 使用 Git 详解(一)</a><time datetime="2024-09-25T06:45:02.000Z" title="发表于 2024-09-25 14:45:02">2024-09-25</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://mail.qq.com/" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src="https://media.giphy.com/media/zymjdD521GHBu/giphy.gif" size="50px"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.bilibili.com/" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.douyin.com/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">©2024 By <a class="footer-bar-link" href="/" title="violet" target="_blank">violet</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://violet.zeabur.app/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/" title="Github"><img class="back-menu-item-icon" src="https://pic4.zhimg.com/v2-341e1d3b2845db15bceeff70d3fe228b_r.jpg" alt="Github"><span class="back-menu-item-text">Github</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博文</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/shuoshuo/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 分享</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/photos/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1994908354&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 影视</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文档</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 随机文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/document/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 文档页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itbaima/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 柏码</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/runoob/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 菜鸟教程</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/itheima/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 黑马程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/SpringCloudAlibaba/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> 阿里微服务</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友人帐</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友链</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站导航</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/front/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 前端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/back-end/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 后端</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/programmer/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 程序员</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/ai/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> AI</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><span> 关于笔者</span></a></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Docker/" style="font-size: 0.88rem; color: rgb(34, 149, 42);">Docker<sup>2</sup></a><a href="/tags/IDEA/" style="font-size: 0.88rem; color: rgb(99, 162, 54);">IDEA<sup>4</sup></a><a href="/tags/Java%E7%A8%8B%E5%BA%8F%E5%91%98/" style="font-size: 0.88rem; color: rgb(81, 16, 76);">Java程序员<sup>3</sup></a><a href="/tags/MybatisPlus/" style="font-size: 0.88rem; color: rgb(158, 158, 18);">MybatisPlus<sup>1</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem; color: rgb(62, 42, 9);">SQL<sup>1</sup></a><a href="/tags/SaToken/" style="font-size: 0.88rem; color: rgb(170, 32, 79);">SaToken<sup>1</sup></a><a href="/tags/VMware/" style="font-size: 0.88rem; color: rgb(193, 39, 95);">VMware<sup>1</sup></a><a href="/tags/VsCode/" style="font-size: 0.88rem; color: rgb(98, 131, 141);">VsCode<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem; color: rgb(171, 86, 57);">git<sup>1</sup></a><a href="/tags/nacos/" style="font-size: 0.88rem; color: rgb(119, 107, 90);">nacos<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem; color: rgb(164, 109, 34);">redis<sup>1</sup></a></div></div><hr></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button type="button" title="切换背景" onclick="toggleWinbox()"><i class="anzhiyufont anzhiyu-icon-images"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async="" src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 violet 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async="" src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="" src="/live2d-widget-master/autoload.js"></script><script src="https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script src="/js/xxx.js?1"></script><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.2.3/js/index.js"></script><style>#widget-tree-button{opacity:0}</style><div id="widget-tree">
      <ul>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">
          程序员
        </a>
      <span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/6ed5eebe.html" title="SpringCloud微服务项目"><i class="post-icon gg-file-document"></i>SpringCloud微服务项目</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/621998ca.html" title="Java架构师成长路径图"><i class="post-icon gg-file-document"></i>Java架构师成长路径图</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/1690d21b.html" title="函数式编程"><i class="post-icon gg-file-document"></i>函数式编程</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">
          工具
        </a>
      <span class="tree-list-count">6</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/7f7493d0.html" title="IDEA 使用 Git 详解(一)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(一)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/ae9ce5fc.html" title="IDEA 使用 Git 详解(二)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(二)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/d06fc5d7.html" title="IDEA 使用 Git 详解(三)"><i class="post-icon gg-file-document"></i>IDEA 使用 Git 详解(三)</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/97a0a1c6.html" title="Idea下载安装"><i class="post-icon gg-file-document"></i>Idea下载安装</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/c68db7e6.html" title="VsCode下载安装"><i class="post-icon gg-file-document"></i>VsCode下载安装</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/545a6120.html" title="VMware"><i class="post-icon gg-file-document"></i>VMware</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/SpringCloud/">
          SpringCloud
        </a>
      <span class="tree-list-count">3</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/f5f9fa9b.html" title="安装Docker"><i class="post-icon gg-file-document"></i>安装Docker</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/cd988ed5.html" title="Docker使用"><i class="post-icon gg-file-document"></i>Docker使用</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/8af9e237.html" title="MybatisPlus"><i class="post-icon gg-file-document"></i>MybatisPlus</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
          环境搭建
        </a>
      <span class="tree-list-count">4</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/f5f9fa9b.html" title="安装Docker"><i class="post-icon gg-file-document"></i>安装Docker</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/386349fe.html" title="Git 安装与使用"><i class="post-icon gg-file-document"></i>Git 安装与使用</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/95afb97c.html" title="Nacos 安装与使用"><i class="post-icon gg-file-document"></i>Nacos 安装与使用</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/6b830637.html" title="Redis安装说明"><i class="post-icon gg-file-document"></i>Redis安装说明</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">
          开发框架
        </a>
      <span class="tree-list-count">2</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/8af9e237.html" title="MybatisPlus"><i class="post-icon gg-file-document"></i>MybatisPlus</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/fe850976.html" title="SaToken鉴权框架"><i class="post-icon gg-file-document"></i>SaToken鉴权框架</a></li></ul></li>
      <li class="tree-list-item">
        <i class="toggle-post-icon gg-folder-add"></i>
        <a class="tree-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E6%B3%95/">
          编程语法
        </a>
      <span class="tree-list-count">1</span><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/posts/5d06cb2d.html" title="SQL使用教程"><i class="post-icon gg-file-document"></i>SQL使用教程</a></li></ul></li></ul>
        <div id="widget-tree-button">
          <i class="gg-chevron-right"></i>
        </div>
      </div><!-- hexo injector body_end end -->
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: true,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>